<html>
	<head>
		<title>N charges inside a boundary</title>
		<meta http-equiv="content-type" content="text/html; charset=utf-8" />

		<link href="https://fonts.googleapis.com/css?family=Josefin+Sans&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Calibri:400,700,400italic,700italic" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Quattrocento+Sans&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Nunito&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Raleway:100,200,300,400,500,600,700,800,900&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Alegreya+Sans&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css?family=Roboto&display=swap" rel="stylesheet">
<!-- 
		<link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous"> -->

		<link rel="icon" href="../square.png">

		<style id='sliderstyles' type="text/css">

		</style>

		<style type="text/css">
			:root {
				--themeblue: hsla(196, 100%, 50%,  1);
				--themeviolet: hsla(280, 100%, 50%,  1);
				--themeorange: hsla(32, 100%, 50%,  1);
				--boundaryorange: hsla(32, 100%, 50%, 0.6);
				--themegrey: hsla(32, 0%, 70%, 0.6);
			}

			.inputButDiv:focus {
				outline: none !important;
				border: 0px solid black;
			}

		</style>

		<style type="text/css">
			a {
				cursor: pointer;
			}

			.standardSlider {
				-webkit-appearance: none;
				border-radius: 5px;
				outline: none;
				opacity: 0.7;
				-webkit-transition: .2s;
				transition: opacity .2s;
			}
			.standardSlider::-webkit-slider-thumb {
				-webkit-appearance: none;
				appearance: none;
				width: 10px;
				height: 10px;
				border-radius: 50%; 
				background: hsla(200, 100%, 50%, 1);
				cursor: pointer;
			}

			#algorithmdescriptiontext::-webkit-scrollbar {
				width: 1.1%;
			}

			#algorithmdescriptiontext::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.2);
				border-radius: 20px;
			}

			#algorithmdescriptiontext::-webkit-scrollbar-thumb {
				background-color: var(--themeviolet);
				border-radius: 20px;
				/*outline: 1px solid slategrey;*/
			}

			#algorithmdescriptiontext {
				scrollbar-color: hsla(0, 100%, 100%, 1);
				scrollbar-width: 1.1%;
			}

			#algorithmedit::-webkit-scrollbar {
				width: 1.1%;
			}

			#algorithmedit::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.2);
				border-radius: 20px;
			}

			#algorithmedit::-webkit-scrollbar-thumb {
				background-color: var(--themeviolet);
				border-radius: 20px;
				/*outline: 1px solid slategrey;*/
			}

			#pointBlocksH::-webkit-scrollbar {
				width: 1.1%;
			}

			#pointBlocksH::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.2);
				border-radius: 20px;
			}

			#pointBlocksH::-webkit-scrollbar-thumb {
				background-color: var(--themeorange);
				border-radius: 20px;
				/*outline: 1px solid slategrey;*/
			}

			#chargePropsBlocksH::-webkit-scrollbar {
				width: 1.1%;
			}

			#chargePropsBlocksH::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.2);
				border-radius: 20px;
			}

			#chargePropsBlocksH::-webkit-scrollbar-thumb {
				background-color: var(--themeblue);
				border-radius: 20px;
				/*outline: 1px solid slategrey;*/
			}

			#optionsDisplayPanel::-webkit-scrollbar {
				width: 0%;
			}

			#optionsDisplayPanel::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0);
				border-radius: 30px;
			}

			#optionsDisplayPanel::-webkit-scrollbar-thumb {
				background-color: var(--themegrey);
				border-radius: 50px;
				/*outline: 1px solid slategrey;*/
			}

			body::-webkit-scrollbar {
				width: 5px;
			}

			body::-webkit-scrollbar-track {
				-webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.5);
				border-radius: 30px;
			}

			body::-webkit-scrollbar-thumb {
				background-color: black;
				border-radius: 50px;
				/*outline: 1px solid slategrey;*/
			}

			#fileinputBack::focus {
				outline: none;
			}

			#savebutton::focus {
				outline: none;
			}

			#savebuttonH::focus {
				outline: none;
			}

			input:invalid {
				box-shadow:0 0 0px hsla(0,0%,0%,0);
			}

		
		</style>
		
<!-- Google tag (gtag.js) -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-MNFFCG66EJ"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-MNFFCG66EJ');
        </script>

		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/6.6.1/math.min.js"></script> -->

		
		<script type="application/ld+json">
			{
			  "@type": "Simulation",
			  "name": "N Charges inside a boundary",
			  "author": "Prajwal DSouza, Manas Shetty",
			  "description": "An optimization problem involving finding minimum energy configurations of n charges inside a given boundary."
			  }
		</script>

		  <meta charset="UTF-8">
		  <meta name="description" content="An optimization problem involving finding minimum energy configurations of n charges inside a given boundary.">
		  <meta name="keywords" content="charges, boundary, thompson problem.">
		  <meta name="author" content="Prajwal DSouza">
		  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	</head>
	<body style='margin:0px; display: block; background: hsla(0, 0%, 92%, 1);'>
		<div id="containAll" style='margin:0px;width:100%; height: 100%; font-size: 0; display: inline-block; position: fixed; background: hsla(0, 0%, 92%, 1);'>
			<div id="scroller" style='margin:0px;width:3%; height: 100%;overflow: hidden;position: relative; z-index: 1;display: inline-block; background: grey; '>
				<div id="scrollerH" style='margin:0px;width:100%; height: 35%;overflow: hidden;position: absolute; z-index: 1;display: inline-block; background: black; border: 0px solid black; border-radius: 20px; border-top-left-radius: 0px;border-top-right-radius: 0px;'>
				</div>
				<div id="labmenuH" style='margin:0px;width:100%; height: 35%;overflow: hidden;position: relative; z-index: 1;display: inline-block;'>
					<div id="labmenutext" style='margin:0px;width:100%; height: 100%;overflow: hidden; position: absolute; z-index: 1; top:0; left: 0; transform-origin: 0 0; transform:rotate(-90deg) translate(-300%, 4%) ; color: white; font-size: 1.3vmax; font-family: Alegreya Sans; font-weight: lighter;'>
						LAB
					</div>
				</div>
				<div id="aboutH" style='margin:0px;width:100%; height: 65%;overflow: hidden;position: relative; z-index: 1;display: inline-block;'>
					<div id="aboutmenutext" style='margin:0px;width:400%; height: 100%;overflow: hidden; position: absolute; z-index: 1; top:0; left: 0; transform-origin: 0 0; transform:rotate(-90deg) translate(-130%, 2%) ; color: white; font-size: 1.3vmax; font-family: Alegreya Sans; font-weight: lighter; word-wrap: unset;'>What's this about?
					</div>
				</div>
			</div>
			<div id="noscroller" style='margin:0px;width:97%; height: 100%;overflow: hidden;position: relative; z-index: 1;display: inline-block;'>
				<div id="verticalspacerA" style='margin:0px;width:0%; height: 100%; display: inline-block;'></div>
				<div id="middlepanel" style='margin:0px;width:36%; height: 100%;overflow: hidden;position: relative; z-index: 1;display: inline-block; '>
					<div id="optionsDisplayPanel" style='margin:0px;width:100%; height: 90%;position: relative; z-index: 1;display: inline-block; overflow-y:auto; '>
						<div id="verticalspacer1" style='margin:0px;width:8%; height: 100%; display: inline-block;'></div>
						<div id="labpanel" style='margin:0px;width:84%; height: 100%;position: relative; z-index: 1;display: inline-block; '>
							<div id="boundaryoptionspanel" style='margin:0px;width:100%; height: 88%;position: relative; z-index: 1;display: inline-block; visibility: hidden; pointer-events: none; position: absolute;'>
								<div id="spacerBD1" style='margin:0px;width:100%; height: 30%; display: inline-block;'></div>
								<div id="boundaryChoicePanel" style='margin:0px;width:100%; height: 10%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
									<div id="spacerB1D1" style='margin:0px;width:100%; height: 25%; display: inline-block;'></div>
									<div id="spacerB1D2" style='margin:0px;width:5%; height: 50%; display: inline-block;'></div>
									<div id="boundaryTypeTile" style='margin:0px;width:25%; height: 50%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none; '>
										<input value='BOUNDARY TYPE' id="bdtypename" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: right;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0, 0%, 40%, 1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
									</div>
									<div id="spacerB1D3" style='margin:0px;width:5%; height: 50%; display: inline-block;'></div>
									<div id="ellipseoptiontile" style='margin:0px;width:25%; height: 50%; display: inline-block; overflow: hidden;'>
										<input class="inputButDiv" onclick="toggleBoundaryType(event)" id='ellipseoptiontilebutton' value='Ellipse' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: 0.9vmax; background: hsla(32,100%,50%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none; pointer-events: none; border-color: hsla(0, 0%, 70%, 1);" readonly></input>
									</div>
									<div id="polyoptiontile" style='margin:0px;width:25%; height: 50%; display: inline-block; overflow: hidden;'>
										<input class="inputButDiv" onclick="toggleBoundaryType(event)" id='polyoptiontilebutton' value='Polygon' list="brow" style="border: 1px solid hsla(0, 0%, 70%, 1); border-color: hsla(0, 0%, 70%, 1); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: 0.9vmax; background: hsla(32,100%,50%,0); color: hsla(0, 0%, 70%, 1); cursor: pointer; user-select: none;" readonly></input>
									</div>
									<div id="spacerB1D4" style='margin:0px;width:15%; height: 50%; display: inline-block;'></div>
									<div id="spacerB1D5" style='margin:0px;width:100%; height: 25%; display: inline-block;'></div>
									
								</div>
								<div id="spacerBD3" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div>
								<div id="boundaryInfoPanel" style='margin:0px;width:100%; height: 12%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
									<div id="spacerB2D11" style='margin:0px;width:100%; height: 25%; display: inline-block;'></div>
									<div id="spacerB2D12" style='margin:0px;width:5%; height: 60%; display: inline-block;'></div>
									<div id="boundaryadditionalinfo" style='margin:0px;width:90%; height: 60%; display: inline-block;font-size: 0.8vmax; font-family: Nunito; color: hsla(0, 0%, 50%, 1); overflow-y: auto;'>
										For a circular boundary, set both the axis lengths to same value which is the radius.
									</div>
									<div id="spacerB2D13" style='margin:0px;width:5%; height: 60%; display: inline-block;'></div>
								</div>
								<div id="spacerBD7" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div><br/>
								<div id="polyPanel" style='margin:0px;width:100%; height: 70%; display: inline-block; position: absolute; visibility: hidden; pointer-events: none;'>
									<div id="boundaryTypeOptionsPanelPolygon" style='margin:0px;width:100%; height: 15%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
										<div id="spacerB1D55" style='margin:0px;width:100%; height: 30%; display: inline-block;'></div>
										<div id="spacerB1D6" style='margin:0px;width:5%; height: 40%; display: inline-block;'></div>
										<div id="sidesTile" style='margin:0px;width:35%; height: 40%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none; '>
											<input value='SIDES' id="sidesname" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: right;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0, 0%, 40%, 1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
										</div>
										<div id="spacerB1D7" style='margin:0px;width:5%; height: 40%; display: inline-block;'></div>
										<div id="sidesTileInputH" style='margin:0px;width:25%; height: 40%; display: inline-block; overflow: hidden; border-radius: 5px;'>
											<input type="number" min="3" step="1"  oninput="polysidesChange()" id='sidesTileInput' value='6' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: 0.9vmax; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none;"></input>
										</div>
										<div id="spacerB1D8" style='margin:0px;width:30%; height: 40%; display: inline-block;'></div>
										<div id="spacerB1D9" style='margin:0px;width:100%; height: 30%; display: inline-block;'></div>
									</div>
									<div id="spacerBDHidden1" style='margin:0px;width:100%; height: 5%; display: inline-block;'></div>
									<div id="boundaryPointsPanel" style='margin:0px;width:100%; height: 50%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
										<div id="gradfillbp" style='margin:0px;width:100%; height: 100%; display: inline-block; position: absolute; pointer-events: none; background: linear-gradient(to bottom,hsla(0, 0%, 0%, 0), hsla(0, 100%, 100%, 0) 32%, hsla(0, 100%, 100%, 1) 33%, hsla(0, 100%, 100%, 0) 38%, hsla(0, 0%, 0%, 0) 80%,hsla(0, 100%, 100%, 1) 90%,hsla(0, 100%, 100%, 0) 91%,hsla(0, 100%, 100%, 0)); z-index: 2;'></div>
										<div id="spacerBPD81" style='margin:0px;width:100%; height:9%; display: inline-block;'></div>
										<div id="spacerBPD82" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
										<div id="boundarypointseditortext" style='margin:0px;width:90%; height: 10%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none;'>BOUNDARY POINTS</div>
										<div id="spacerBPD83" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
										<div id="spacerBPD84" style='margin:0px;width:100%; height: 1%; display: inline-block;'></div>
										<div id="spacerBPD85" style='margin:0px;width:5%; height:10%; display: inline-block;'></div>
										<div id="pointeditNameBlock" style='margin:0px;width:90%; height:10%; display: inline-block;font-size: 0.85vmax; font-family: Source Sans Pro; overflow:hidden; color: hsla(0, 0%, 50%, 1); position: relative; '>
											<input value='Point' id="bdptNameID" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 22%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: var(--themeorange); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
											<div id="pbspacer" style='margin:0px;width:5%; height:100%; display: inline-block;'></div>
											<input value='X co-ordinate' id="XcorBDName" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 30%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0,0%,50%,1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
											<div id="pbspacer" style='margin:0px;width:5%; height:100%; display: inline-block;'></div>
											<input value='Y co-ordinate' id="YcorBDName" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 30%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0,0%,50%,1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
										</div>
										<div id="spacerBPD86" style='margin:0px;width:5%; height:10%; display: inline-block;'></div>
										<div id="spacerBPD87" style='margin:0px;width:100%; height:3%; display: inline-block;'></div>
										<div id="spacerBPD88" style='margin:0px;width:5%; height:57%; display: inline-block;'></div>
										<div id="pointBlocksH" style='margin:0px;width:90%; height:57%; display: inline-block;font-size: 0.85vmax; font-family: Source Sans Pro; color: hsla(0, 0%, 50%, 1); position: relative; overflow-y: scroll; '>
											<div id="pbVfinalspacer" style='margin:0px;width:100%; height:20%; display: inline-block;'></div>
										</div>
										<div id="spacerBPD89" style='margin:0px;width:5%; height:57%; display: inline-block;'></div>
										<div id="spacerBPD810" style='margin:0px;width:100%; height: 5%; display: inline-block;'></div>
									</div>
									<div id="spacerBD4" style='margin:0px;width:100%; height: 5%; display: inline-block;'></div>
								</div>
								<div id="ellipsePanel" style='margin:0px;width:100%; height: 45%; display: inline-block;'>
									<div id="boundaryTypeOptionsPanelEllipse" style='margin:0px;width:100%; height: 40%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
										<div id="spacerB1D55" style='margin:0px;width:100%; height: 15%; display: inline-block;'></div>
										<div id="spacerB1D6" style='margin:0px;width:5%; height: 30%; display: inline-block;'></div>
										<div id="semiMajorTile" style='margin:0px;width:35%; height: 25%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none; '>
											<input value='SEMI MAJOR AXIS' id="semiMajorAxName" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: right;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0, 0%, 40%, 1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
										</div>
										<div id="spacerB1D7" style='margin:0px;width:5%; height: 25%; display: inline-block;'></div>
										<div id="semiMajorTileInputH" style='margin:0px;width:25%; height: 25%; display: inline-block; overflow: hidden; border-radius: 5px;'>
											<input oninput="updateMajorAxis(event)" type="number" min="0" step="0.01"  onclick="" id='semiMajorTileInput' value='1' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: 0.9vmax; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none;"></input>
										</div>
										<div id="spacerB1D8" style='margin:0px;width:30%; height: 25%; display: inline-block;'></div>
										<div id="spacerB1D9" style='margin:0px;width:100%; height: 10%; display: inline-block;'></div>
										<div id="spacerB1D10" style='margin:0px;width:5%; height: 25%; display: inline-block;'></div>
										<div id="semiMinorTile" style='margin:0px;width:35%; height: 25%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none; '>
											<input value='SEMI MINOR AXIS' id="semiMinorAxName" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: right;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0, 0%, 40%, 1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
										</div>
										<div id="spacerB1D11" style='margin:0px;width:5%; height: 25%; display: inline-block;'></div>
										<div id="semiMinorTileInputH" style='margin:0px;width:25%; height: 25%; display: inline-block; overflow: hidden; border-radius: 5px;'>
											<input oninput="updateMinorAxis(event)" type="number" min="0" step="0.01" onclick="" id='semiMinorTileInput' value='1' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: 0.9vmax; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none;"></input>
										</div>
										<div id="spacerB1D1" style='margin:0px;width:30%; height: 25%; display: inline-block;'></div>
									</div>
									<div id="spacerBD4" style='margin:0px;width:100%; height: 5%; display: inline-block;'></div>
								</div>

							</div>
							<div id="chargesoptionspanel" style='margin:0px;width:100%; height: 88%;position: relative; z-index: 1;display: inline-block; visibility: hidden; pointer-events: none; position: absolute;'>
								<div id="spacerCH1" style='margin:0px;width:100%; height: 20%; display: inline-block;'></div>
								<div id="chargePropsPanelH" style='margin:0px;width:100%; height: 40%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
									<div id="chargePropsPanel" style='margin:0px;width:100%; height: 100%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
										<div id="gradfillchp" style='margin:0px;width:100%; height: 100%; display: inline-block; position: absolute; pointer-events: none; background: linear-gradient(to bottom,hsla(0, 0%, 0%, 0), hsla(0, 100%, 100%, 0) 32%, hsla(0, 100%, 100%, 1) 33%, hsla(0, 100%, 100%, 0) 38%, hsla(0, 0%, 0%, 0) 80%,hsla(0, 100%, 100%, 1) 90%,hsla(0, 100%, 100%, 0) 91%,hsla(0, 100%, 100%, 0)); z-index: 2;'></div>
										<div id="spacerCH1sub1" style='margin:0px;width:100%; height:9%; display: inline-block;'></div>
										<div id="spacerCH1sub2" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
										<div id="chargepropertiestext" style='margin:0px;width:40%; height: 10%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none;'>
											<input value='CHARGE PROPERTIES' id="chargepropName" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: left;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0, 0%, 40%, 1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
										</div>
										<div id="spacerCH1sub3" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
										<div id="addchargeblock" style='margin:0px;width:35%; height:10%; display: inline-block; border-radius: 4px; border: 0px solid hsla(0,0%,0%,0.5); position: relative; overflow: hidden;'>
											<input onclick="addchargeblock()" id='addchargeText' value='Add Charge' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); height: 100%; width: 100%; text-align: center; font-family: Roboto; font-size: 0.85vmax; font-weight: lighter; color:  black; background: var(--themeblue); color: white; cursor: pointer;" readonly></input>
										</div>
										<div id="addchargeblockspacer" style='margin:0px;width:10%; height:10%; display: inline-block;'></div>
										<div id="spacerCH1sub4" style='margin:0px;width:100%; height: 1%; display: inline-block;'></div>
										<div id="spacerCH1sub5" style='margin:0px;width:5%; height:10%; display: inline-block;'></div>
										<div id="chargeeditNameBlock" style='margin:0px;width:90%; height:10%; display: inline-block;font-size: 0.85vmax; font-family: Source Sans Pro;  color: hsla(0, 0%, 50%, 1); position: relative; '>
											<input value='No' id="chNumberTopHead" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 5%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: var(--themeblue); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
											<div id="pbspacer" style='margin:0px;width:4%; height:100%; display: inline-block;'></div>
											<input value='X' id="chargeXLabelN" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 22%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0,0%,50%,1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
											<div id="pbspacer" style='margin:0px;width:4%; height:100%; display: inline-block;'></div>
											<input value='Y' id="chargeYLabelN" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 22%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0,0%,50%,1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
											<div id="pbspacer" style='margin:0px;width:4%; height:100%; display: inline-block;'></div>
											<input value='Charge' id="chargeWLabelN" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 13%; height: 100%; text-align: center;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0,0%,50%,1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>

										</div>
										<div id="spacerCH1sub6" style='margin:0px;width:5%; height:10%; display: inline-block;'></div>
										<div id="spacerCH1sub7" style='margin:0px;width:100%; height:3%; display: inline-block;'></div>
										<div id="spacerCH1sub8" style='margin:0px;width:5%; height:57%; display: inline-block;'></div>
										<div id="chargePropsBlocksH" style='margin:0px;width:90%; height:57%; display: inline-block;font-size: 0.85vmax; font-family: Source Sans Pro; color: hsla(0, 0%, 50%, 1); position: relative; overflow-y: scroll; '>
											<div id="topspacer" style='margin:0px;width:100%; height:6%; display: inline-block;'></div>
											<div id="chfinalspacer" style='margin:0px;width:100%; height:20%; display: inline-block;'></div>
										</div>
										<div id="spacerCH1sub9" style='margin:0px;width:5%; height:57%; display: inline-block;'></div>
										<div id="spacerCH1sub10" style='margin:0px;width:100%; height: 5%; display: inline-block;'></div>
									</div>
								</div>
								<div id="spacerCH2" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div>
								<div id="energyFuncPanel" style='margin:0px;width:100%; height: 27%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
									<div id="spacerE1sub1" style='margin:0px;width:100%; height:10%; display: inline-block;'></div>
									<div id="spacerE1sub2" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
									<div id="energyfunctext" style='margin:0px;width:88%; height: 10%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none;'>
										<input value='ENERGY FUNCTION' id="egfuncTextID" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: left;font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: hsla(0, 0%, 40%, 1); cursor: auto; pointer-events: none; user-select: none;" readonly></input>
									</div>
									<div id="spacerE1sub3" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
									<div id="spacerE1sub4" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div>
									<div id="efspacer" style='margin:0px;width:5%; height:25%; display: inline-block;'></div>
									<input  oninput="handleEnergyFInput(event)" id='energyFInput' value='p*q/d' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 88%; height: 25%; text-align: center; font-family: Source Sans Pro; font-weight: bold; font-size: 1.2vmax; background: hsla(0,0%,80%,1); color: hsla(0, 0%, 0%, 1); cursor: auto; user-select: none; border-radius: 5px;"></input>
									<div id="efspacer" style='margin:0px;width:5%; height:25%; display: inline-block;'></div>
									<div id="energyFuncInfoPanel" style='margin:0px;width:100%; height: 30%; display: inline-block; overflow: hidden; position: relative;'>
										<div id="spacerfunc1" style='margin:0px;width:100%; height: 25%; display: inline-block;'></div>
										<div id="spacerfunc2" style='margin:0px;width:5%; height: 60%; display: inline-block;'></div>
										<div id="energyinfodata" style='margin:0px;width:90%; height: 60%; display: inline-block;font-size: 0.8vmax; font-family: Nunito; color: hsla(0, 0%, 50%, 1); '>
											The energy between two charges of p and q units, separated by a distance d. Please stick to using p, q and d while modifying this function.
										</div>
										<div id="spacerfunc3" style='margin:0px;width:5%; height: 60%; display: inline-block;'></div>
									</div>
								</div>
								<div id="spacerCH3" style='margin:0px;width:100%; height: 10%; display: inline-block;'></div>
							</div>
							<div id="settingsoptionspanel" style='margin:0px;width:100%; height: 88%;position: relative; z-index: 1;display: inline-block; visibility: hidden; pointer-events: none; position: absolute;'>
								
							</div>
							<div id="algooptionspanel" style='margin:0px;width:100%; height: 88%; position: relative; z-index: 1;display: inline-block; visibility: visible; pointer-events: auto;'>
								<div id="spacerD1" style='margin:0px;width:100%; height: 8%; display: inline-block;'></div>
								<div id="algorithmdescription" style='margin:0px;width:100%; height: 25%; display: inline-block; background: white; border-radius: 10px; overflow: hidden; position: relative;'>
									<div id="gradfill1" style='margin:0px;width:100%; height: 100%; display: inline-block; position: absolute; pointer-events: none; background: linear-gradient(to bottom,hsla(0, 0%, 0%, 0), hsla(0, 100%, 100%, 0) 30%, hsla(0, 100%, 100%, 1) 33%, hsla(0, 100%, 100%, 0) 40%, hsla(0, 0%, 0%, 0) 60%,hsla(0, 100%, 100%, 1) 80%,hsla(0, 100%, 100%, 1));'></div>
									<div id="spacerD51" style='margin:0px;width:100%; height: 12%; display: inline-block;'></div>
									<div id="spacerD52" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
									<div id="algorithmnametext" style='margin:0px;width:90%; height: 10%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1);'>ELECTROSTATIC WALK</div>
									<div id="spacerD53" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
									<div id="spacerD54" style='margin:0px;width:100%; height: 10%; display: inline-block;'></div>
									<div id="spacerD55" style='margin:0px;width:5%; height: 53%; display: inline-block;'></div>
									
									<div id="algorithmdescriptiontext" style='margin:0px;width:90%; height: 53%; display: inline-block;font-size: 0.85vmax; font-family: Nunito; overflow-y: auto; color: hsla(0, 0%, 50%, 1);'>
										Move the <font style="color: var(--themeblue);">nth charge</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">d</font> in the direction of electrostatic force, if the new location is within the <font style="color: var(--themeorange);">boundary</font>. <br/>
										<font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : electrostaticForce(<font style="color: var(--themeblue);">n</font>, <font style="color: hsla(210, 100%, 50%, 1);">d</font>)</font> <br/><br/> 

										Pick a random <font style="color: var(--themeblue);">charge</font> <br/> 
										<font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : pickCharge()</font>
										<br/><br/> <br/> 
									</div>
									<div id="spacerD56" style='margin:0px;width:5%; height: 53%; display: inline-block;'></div>
									<div id="spacerD57" style='margin:0px;width:100%; height: 10%; display: inline-block;'></div>
								</div>
								<div id="spacerD7" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div>
								<div id="algorithmeditor" style='margin:0px;width:100%; height: 48%; display: inline-block; background: white; border-radius: 10px; position: relative; overflow: hidden;'>
									<div id="gradfill2" style='margin:0px;width:100%; height: 100%; display: inline-block; position: absolute; pointer-events: none; background: linear-gradient(to bottom,hsla(0, 0%, 0%, 0), hsla(0, 100%, 100%, 0) 15%, hsla(0, 100%, 100%, 1) 17%, hsla(0, 100%, 100%, 0) 19%, hsla(0, 0%, 0%, 0) 50%,hsla(0, 100%, 100%, 1) 80%,hsla(0, 100%, 100%, 0) 81%,hsla(0, 100%, 100%, 0)); z-index: 2;'></div>
									<div id="spacerD81" style='margin:0px;width:100%; height:7%; display: inline-block;'></div>
									<div id="spacerD82" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
									<div id="algorithmeditortext" style='margin:0px;width:60%; height: 10%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden; user-select: none;'>ALGORITHM</div>
									<div onclick="playpauseAlgo()" id="algoplaytext" style='margin:0px;width:10%; height: 10%; display: inline-block; font-size: 0.75vmax; font-family: Source Sans Pro; font-weight: bold; letter-spacing: 1px; text-align: center; color: hsla(0, 0%, 40%, 1); overflow: hidden;cursor: pointer; user-select: none;'>PLAY</div>
									<div onclick="stepAlgo()" id="algosteptext" style='margin:0px;width:10%; height: 10%; display: inline-block; font-size: 0.75vmax; font-family: Source Sans Pro; font-weight: bold; letter-spacing: 1px; text-align: center; color: hsla(0, 0%, 40%, 1); overflow: hidden; cursor: pointer; user-select: none;'>STEP</div>
									<div onclick="resetAlgo()" id="algoresettext" style='margin:0px;width:10%; height: 10%; display: inline-block; font-size: 0.75vmax; font-family: Source Sans Pro; font-weight: bold; letter-spacing: 1px; text-align: center; color: hsla(0, 0%, 40%, 1); overflow: hidden; cursor: pointer; user-select: none;'>RESET</div>
									<div id="spacerD83" style='margin:0px;width:5%; height: 10%; display: inline-block;'></div>
									<div id="spacerD84" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div>
									<div id="spacerD85" style='margin:0px;width:5%; height:57%; display: inline-block;'></div>
									
									<div id="algorithmedit" style='margin:0px;width:90%; height:57%; display: inline-block;font-size: 0.85vmax; font-family: Source Sans Pro; overflow-y: auto; color: hsla(0, 0%, 50%, 1); position: relative; '>
										
										<div id="codeblock1" class="codeblock" style='margin:0px;width:80%; height:23%; display: inline-block; border-radius: 4px; border: 1px solid hsla(0,0%,0%,0.5); position: relative; overflow: auto;'>
											<input oninput="changedCodeBlock(event)" id='codeblock1text' value='charge = pickCharge()' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); height: 100%; width: 100%; text-align: center; font-family: Nunito; font-size: 0.9vmax; font-weight: lighter; color:  black; border-radius: 4px;" class="codeblockText"></input>
										</div>
										<div id="codeblock1tile" style='margin:0px;width:15%; height:23%; display: inline-block;  text-align: center; overflow: hidden;'>
											<input onclick="removeCodeBlock(event)" id='codeblockremove-1' value='Remove' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-size: 0.8vmax; font-weight: lighter; color:  black; background: hsla(0,0%,0%,0); color: var(--themeviolet); cursor: pointer; user-select: none;" readonly></input>
										</div>
										<div id="codeblock1spacer" style='margin:0px;width:100%; height:4%; display: inline-block;'></div>
										
										<div id="codeblock2" class="codeblock" style='margin:0px;width:80%; height:23%; display: inline-block; border-radius: 4px; border: 1px solid hsla(0,0%,0%,0.5); position: relative; overflow: auto;'>
											<input oninput="changedCodeBlock(event)" id='codeblock2text' value='electrostaticWalk(charge, 0.008)' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); height: 100%; width: 100%; text-align: center; font-family: Nunito; font-size: 0.9vmax; font-weight: lighter; color:  black;"  class="codeblockText"></input>
										</div>
										
										<div id="codeblock2tile" style='margin:0px;width:15%; height:23%; display: inline-block;  text-align: center; overflow: hidden;'>
											<input onclick="removeCodeBlock(event)" id='codeblockremove-2' value='Remove' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-size: 0.8vmax; font-weight: lighter; color:  black; background: hsla(0,0%,0%,0); color: var(--themeviolet); cursor: pointer; user-select: none;" readonly></input>
										</div>
										<div id="codeblock2spacer" style='margin:0px;width:100%; height:4%; display: inline-block;'></div>

										<div id="addcodeblock" style='margin:0px;width:80%; height:23%; display: inline-block; border-radius: 4px; border: 0px solid hsla(0,0%,0%,0.5); position: relative; overflow: auto;'>
											<input onclick="addNewCodeBlock()" id='addcodeText' value='Add Code Block' list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); height: 100%; width: 100%; text-align: center; font-family: Roboto; font-size: 0.85vmax; font-weight: lighter; color:  black; background: var(--themeviolet); color: white; cursor: pointer;" readonly></input>
										</div>
										<div id="addcodeblockspacer" style='margin:0px;width:100%; height:13%; display: inline-block;'></div>
									</div>
									<div id="spacerD86" style='margin:0px;width:5%; height:57%; display: inline-block;'></div>
									<div id="spacerD87" style='margin:0px;width:100%; height: 5%; display: inline-block;'></div>
									<div id="spacerD88" style='margin:0px;width:5%; height: 12%; display: inline-block;'></div>
									<div id="errorAndInfodisplay" style='margin:0px;width:90%; height: 12%; display: inline-block; font-size: 0.8vmax; color: red; font-family: Source Sans Pro; z-index: 3; overflow: auto; pointer-events: none;'>
										<font style="color: hsla(0, 0%, 0%, 0.7)">The code is written in Javascript and exact function names have to followed since they are case sensitive.</font>
									</div>
									<div id="spacerD89" style='margin:0px;width:5%; height: 12%; display: inline-block;'></div>
									<div id="spacerD90" style='margin:0px;width:100%; height: 6%; display: inline-block;'></div>
								</div>
								<div id="spacerD10" style='margin:0px;width:100%; height: 3%; display: inline-block;'></div>
								<div id="algorithmchoice" style='margin:0px;width:100%; height: 19%; display: inline-block; background: white; border-radius: 10px;'>
									<div id="spacerD111" style='margin:0px;width:100%; height: 25%; display: inline-block;'></div>
									<div id="spacerD112" style='margin:0px;width:5%; height: 30%; display: inline-block;'></div>
									<div id="algorithmchoosetext" style='margin:0px;width:35%; height: 30%; display: inline-block; font-size: 0.9vmax; font-family: Source Sans Pro; letter-spacing: 1px; color: hsla(0, 0%, 40%, 1); overflow: hidden;'>CHOOSE ALGORITHM</div>
									<div id="spacerD113" style='margin:0px;width:5%; height: 30%; display: inline-block;'></div>
									<div id="choosealgorithmdrop" style='margin:0px;width:50%; height: 30%; display: inline-block; overflow: hidden;'>
										<select onchange="chooseAlgo(event)" id="algorithmsToChoose" style="font-family: Roboto; font-size: 0.75vmax;">
											<option value="electrostaticwalkAlgo">ELECTROSTATIC WALK</option>
											<option value="moveIfMinimumAlgo">MOVE IF MINIMUM</option>
											<option value="electrostaticwithRandomnessAlgo">ELECTROSTATIC AND  RANDOMNESS</option>
											<option value="electrostaticForceAlgo">ELECTROSTATIC FORCE</option>
											<option value="randomPositionAlgo">RANDOM POSITION</option>
											<option value="randomSearchAlgo">RANDOM SEARCH</option>
											<option value="geneticAlgo">GENETIC</option>
										</select>
									</div>
									<div id="spacerD114" style='margin:0px;width:5%; height: 30%; display: inline-block;'></div>
									<div id="spacerD115" style='margin:0px;width:100%; height: 0%; display: inline-block;'></div>
									<div id="spacerD115" style='margin:0px;width:5%; height: 20%; display: inline-block;'></div>
									
									<div id="algoadditionalinfo" style='margin:0px;width:90%; height: 20%; display: inline-block;font-size: 0.62vmax; font-family: Nunito; color: hsla(0, 0%, 50%, 1);'>
										The goal is to attain minimum energy configurations. Some algorithms should work for certain cases. 
									</div>
									<div id="spacerD116" style='margin:0px;width:5%; height: 20%; display: inline-block;'></div>
									<div id="spacerD117" style='margin:0px;width:100%; height: 20%; display: inline-block;'></div>

								</div>
								<div id="spacerD13" style='margin:0px;width:100%; height: 19%; display: inline-block;'></div>

							</div>
							
						</div>
						<div id="verticalspacer2" style='margin:0px;width:8%; height: 100%; display: inline-block;'></div>
					</div>
					<div id="menuDisplayPanel" style='margin:0px;width:100%; height: 10%;position: relative; z-index: 1;display: inline-block; '>
						<div id="verticalspacer1" style='margin:0px;width:8%; height: 100%; display: inline-block;'></div>
						<div id="menupanel" style='margin:0px;width:84%; height: 100%; overflow: hidden;position: relative; z-index: 1;display: inline-block; '>
							<div id="topspacerMenu" style='margin:0px;width:100%; height: 10%; display: inline-block; overflow: hidden;'></div>
							<div id="algorithmoptionH" style='margin:0px;width:25%; height: 45%; display: inline-block; overflow: hidden;'>
								<input onclick="handlePanel(event)" id='algorithmoption' value='ALGORITHM' list="brow" style="width: 100%; height: 100%;  font-family: Source Sans Pro; font-weight: bold; text-align: center;font-size: 0.93vmax; letter-spacing: 0.8px; color: hsla(0, 100%, 0%, 1); cursor: auto; user-select: none; border-color: hsla(0, 0%, 70%, 1); outline: none; vertical-align: middle; border-top-left-radius: 20px; border-bottom-left-radius: 20px; background: hsla(280,100%,50%,1); border: 1px solid hsla(0, 0%, 60%, 1);" readonly></input>
							</div>
							<div id="boundaryoptionH" style='margin:0px;width:25%; height: 45%; display: inline-block; overflow: hidden;'>
								<input onclick="handlePanel(event)" id='boundaryoption' value='BOUNDARY' list="brow" style="width: 100%; height: 100%;  font-family: Source Sans Pro; font-weight: bold; text-align: center;font-size: 0.93vmax; letter-spacing: 0.8px; color: grey; cursor: pointer; user-select: none; border-color: hsla(0, 0%, 70%, 1); outline: none; vertical-align: middle;  background: hsla(280,100%,50%,0); border: 1px solid hsla(0, 0%, 60%, 1);" readonly></input>
							</div>
							<div id="chargesoptionH" style='margin:0px;width:25%; height: 45%; display: inline-block; overflow: hidden;'>
								<input onclick="handlePanel(event)" id='chargesoption' value='CHARGE' list="brow" style="width: 100%; height: 100%;  font-family: Source Sans Pro; font-weight: bold; text-align: center;font-size: 0.93vmax; letter-spacing: 0.8px; color: grey; cursor: pointer; user-select: none; border-color: hsla(0, 0%, 70%, 1); outline: none; vertical-align: middle; background: hsla(280,100%,50%,0); border: 1px solid hsla(0, 0%, 60%, 1);" readonly></input>
							</div>
							<div id="settingsoptionH" style='margin:0px;width:25%; height: 45%; display: inline-block; overflow: hidden;'>
								<input onclick="handlePanel(event)" id='settingsoption' value='SETTINGS' list="brow" style="width: 100%; height: 100%;  font-family: Source Sans Pro; font-weight: bold; text-align: center;font-size: 0.93vmax; letter-spacing: 0.8px; color: grey; cursor: pointer; user-select: none; border-color: hsla(0, 0%, 70%, 1); outline: none; vertical-align: middle; border-top-right-radius: 20px; border-bottom-right-radius: 20px; background: hsla(280,100%,50%,0); border: 1px solid hsla(0, 0%, 60%, 1);" readonly></input>
							</div>
						</div>
						<div id="verticalspacer2" style='margin:0px;width:8%; height: 100%; display: inline-block;'></div>
					</div>
				</div>
				<div id="verticalspacerB" style='margin:0px;width:2%; height: 100%; display: inline-block;'></div>
				<div id="interactionAndTitle" style='margin:0px;width:62%; height: 100%;overflow: hidden;position: relative; z-index: 1;display: inline-block; '>
					<div id="titleH" style='margin:0px;width:100%; height: 20%;overflow: hidden;position: relative; z-index: 1;display: inline-block; '>
						<div id="titletext" style='margin:0px;width: 100%; height: 100%;overflow: hidden; position: absolute; z-index: 1; font-size: 3vmax; font-family: Raleway; font-weight: normal;'>
							<table width="100%" height='100%' style="border: 0px solid black; border-collapse: collapse; table-layout: fixed;">
								<tr>
									<td colspan="8" id='maintitle' style="text-align: right; vertical-align: middle; font-size: 2.2vmax; color: hsla(190, 0%, 0%, 1);">
										N <font style="color: var(--themeblue);">Charges</font> inside a <font style="color: var(--themeorange);">boundary</font> <br/><font style="font-size: 1.1vmax; font-family: Nunito; font-weight: normal; color: hsla(190, 0%, 30%, 1);">
										Finding Minimum Energy Configurations </font><br/><font style="font-size: 1vmax; font-weight: normal; font-family: Nunito; color: hsla(260, 100%, 30%, 1);">
										Vinton Adrian Rebello, Manas Shetty and Prajwal DSouza </font><br/>
										<font style="font-size: 1vmax;">inspired by the <a href="https://iopscience.iop.org/article/10.1088/0305-4470/31/3/014/meta" style="text-decoration: none;" target="_blank"><font style="color: hsla(190, 40%, 40%, 1);">work</font></a> of Kari J Nurmela</font>
									</td>
									<td colspan="1"></td>
								</tr>
							</table>
							
						</div>
					</div><br/>
					<div id="simulationDetailAndButtonsH" style='margin:0px;width:100%; height: 80%;overflow: hidden;position: absolute; z-index: 10;display: inline-block; background: none; box-shadow: inset 0px 0px 50px 50px hsla(32, 100%,100%, 1); border: 0px solid black; border-radius: 0px; border-top-left-radius: 60px; pointer-events: none;'>
						<div id="spacerSD1" style='margin:0px;width:100%; height: 6%; display: inline-block;'></div>
						<div id="spacerSD2" style='margin:0px;width:7%; height: 20%; display: inline-block;'></div>
						<div id="energyinfo" style='margin:0px;width:65%; height: 20%; display: inline-block; text-align: left; font-size: 0.8vmax; font-family: Source Sans Pro; color: black; font-weight: bold; overflow: hidden;'>
							<font style="color: hsla(0, 0%, 0%, 0.5); font-weight: normal;">Lowest Energy</font>  25.134 <br/> <font style="color: hsla(0, 0%, 0%, 0.5); font-weight: normal;">Current Energy</font> 28.11
						</div>
						<div id="spacerSD4" style='margin:0px;width:28%; height: 20%; display: inline-block;'></div>
						<div id="spacerSD5" style='margin:0px;width:88%; height: 7%; display: inline-block;'></div>
						<div id="saveButtonH" style='margin:0px;width:8%; height: 7%; display: inline-block; overflow: hidden; user-select: none;'>
							<input onclick="handleSave(event)" id='savebutton' class="sidebuttons" value='SAVE' list="brow" style="border: 1px solid hsla(0, 0%, 70%, 1);  border-radius: 10px; width: 100%; height: 100%; text-align: center; font-family: Source Sans Pro; font-weight: normal; font-size: 0.9vmax; background: hsla(32,100%,100%,1); color: hsla(0, 0%, 0%, 1); cursor: pointer; user-select: none; pointer-events: auto; overflow: hidden; outline: none;" readonly></input>
						</div>
						<div id="spacerSD6" style='margin:0px;width:4%; height: 7%; display: inline-block;'></div>
						<div id="spacerbuttonGap1" style='margin:0px;width:100%; height: 2%; display: inline-block;'></div>
						<div id="spacerSD7" style='margin:0px;width:88%; height: 7%; display: inline-block;'></div>
						<div id="loadButtonH" style='margin:0px;width:8%; height: 7%; display: inline-block; overflow: hidden; position: relative; cursor: pointer;'>
							<input id='loadbutton' value='OPEN' list="brow" style="border: 1px solid hsla(0, 0%, 70%, 1);  border-radius: 10px; width: 100%; height: 100%; text-align: center; font-family: Source Sans Pro; font-weight: normal; font-size: 0.9vmax; background: hsla(32,100%,100%,1); color: hsla(0, 0%, 0%, 1); position: absolute; cursor: pointer; user-select: none; pointer-events:none; outline: none;" readonly></input>
							<input id="fileinputBack" accept='text/plain' onchange="handleOpen(event)" onclick="stopAlgorithm()" type="file" style="border: 0px solid hsla(0, 0%, 70%, 1);  border-radius: 10px; width: 100%; height: 100%; text-align: center; font-family: Source Sans Pro; font-weight: normal; font-size: 0.9vmax; background: hsla(32,100%,100%,1); color: hsla(0, 0%, 0%, 1); cursor: pointer; pointer-events: auto; outline: none;"></input>

						</div>
						<div id="spacerSD8" style='margin:0px;width:4%; height: 7%; display: inline-block;'></div>
						<div id="spacerbuttonGap2" style='margin:0px;width:100%; height: 2%; display: inline-block;'></div>
						<div id="spacerSD9" style='margin:0px;width:88%; height: 7%; display: inline-block;'></div>
						<div id="homeButtonH" style='margin:0px;width:8%; height: 7%; display: inline-block; overflow: hidden;'>
							<input onclick="handleHome(event)" id='homebutton' value='HOME' list="brow" style="border: 1px solid hsla(0, 0%, 70%, 1);  border-radius: 10px; width: 100%; height: 100%; text-align: center; font-family: Source Sans Pro; font-weight: normal; font-size: 0.9vmax; background: hsla(32,100%,100%,1); color: hsla(0, 0%, 0%, 1); cursor: pointer; user-select: none; pointer-events: auto; outline: none;" readonly></input>
						</div>
						<div id="spacerSD11" style='margin:0px;width:4%; height: 7%; display: inline-block;'></div>
					</div>
					<div id="labH" style='margin:0px;width:100%; height: 80%;overflow: hidden;position: relative; z-index: 1;display: inline-block; background: white; border: 0px solid black; border-radius: 0px; border-top-left-radius: 60px; '>

					</div>
				</div>
			</div>
				
		</div>
		<div id="space1Div" style='margin:0px;width:100%; height: 100%; font-size: 0; display: inline-block; position: relative; pointer-events: none;'>
		</div>
		<div id="space2Div" style='margin:0px;width:100%; height: 100%; font-size: 0; display: inline-block; position: relative; pointer-events: none; '>
		</div>
		<div id="space3Div" style='margin:0px;width:100%; height: 100%; font-size: 0; display: inline-block; position: relative; pointer-events: none;'>
		</div>
		<div id="space4Div" style='margin:0px;width:100%; height: 100%; font-size: 0; display: inline-block; position: relative; pointer-events: none;'>
		</div>
		<div id="space5Div" style='margin:0px;width:100%; height: 100%; font-size: 0; display: inline-block; position: relative; pointer-events: none;'>
		</div>

		<script type="text/javascript">

		function infodisplay(infoobject) {
			if (infoobject == 'normal') {
				document.getElementById('info').innerHTML = 'A simulation based on a <font style="cursor: pointer;font-weight: lighter; color: hsla(210, 100%, 60%, 1);z-index: 5;" onclick="window.open("https://www.youtube.com/watch?v=vF_-ob9vseM")">Numberphile video</font>. Please watch the video to understand the problem simulated here.'
			}
			else if (infoobject == 'up') {
				document.getElementById('info').innerHTML = 'Moves the mouse upward. Keyboard shortcut is the <b> up </b> key.'
			}
			else if (infoobject == 'down') {
				document.getElementById('info').innerHTML = 'Moves the mouse downward. Keyboard shortcut is the <b> down </b> key.'
			}
			else if (infoobject == 'left') {
				document.getElementById('info').innerHTML = 'Moves the mouse left. Keyboard shortcut is the <b> left </b> key.'
			}
			else if (infoobject == 'right') {
				document.getElementById('info').innerHTML = 'Moves the mouse right. Keyboard shortcut is the <b> right </b> key.'
			}
			else if (infoobject == 'northeast') {
				document.getElementById('info').innerHTML = 'Moves the mouse north-east. Keyboard shortcut involves </br>holding <b> right </b> and <b> up </b> keys together.'
			}
			else if (infoobject == 'southeast') {
				document.getElementById('info').innerHTML = 'Moves the mouse south-east. Keyboard shortcut involves </br>holding <b> right </b> and <b> down </b> keys together.'
			}
			else if (infoobject == 'northwest') {
				document.getElementById('info').innerHTML = 'Moves the mouse north-west. Keyboard shortcut involves </br>holding <b> left </b> and <b> up </b> keys together.'
			}
			else if (infoobject == 'southwest') {
				document.getElementById('info').innerHTML = 'Moves the mouse south-west. Keyboard shortcut involves </br>holding <b> left </b> and <b> down </b> keys together.'
			}
			else if (infoobject == 'rotate') {
				document.getElementById('info').innerHTML = 'Mouse rotates about the center anti-clockwise. </br>Keyboard shortcut is the <b> R </b> key.'
			}
			else if (infoobject == 'rotateclockwise') {
				document.getElementById('info').innerHTML = 'Mouse rotates about the center clockwise. </br>Keyboard shortcut is the <b> E </b> key.'
			}
			else if (infoobject == 'outward') {
				document.getElementById('info').innerHTML = 'Mouse moves outward away from the center. </br>Keyboard shortcut is the <b> O </b> key.'
			}
			else if (infoobject == 'playpause') {
				document.getElementById('info').innerHTML = 'Play/Pause the simulation. </br>Keyboard shortcut is the <b> Spacebar </b> key.'
			}
		}

		function setDarkMode() {
			if (darkmode) {
				darkmode = false
				document.getElementById('darkmodeoption').style.backgroundColor = 'hsla(190, 100%, 0%, 0.2)'
				document.getElementById('darkmodeoption').style.color = 'hsla(190, 100%, 100%, 1)'
				document.getElementById('darkmodeoption').style.fontWeight = 'normal'

				document.body.style.background = 'white'

				document.getElementById('maintitle').style.color = 'hsla(190, 100%, 0%, 1)'
				document.getElementById('websitelink').style.color = 'hsla(260, 100%, 60%, 1)'
				document.getElementById('asimulationtext').style.color = 'hsla(190, 100%, 60%, 1)'

				document.getElementById('info').style.color = 'hsla(190, 100%, 0%, 1)'

				options = {}
				options.pointcolor = 'hsla(260, 100%, 50%, 1)'
				updatePoint('simulationgraph', 'cat', options)

				options = {}
				options.textcolor = 'hsla(260, 0%, 0%, 1)'
				updateText('simulationgraph', 'cattext', options)

				options = {}
				options.pointcolor = 'hsla(260, 0%, 0%, 1)'
				updatePoint('simulationgraph', 'mouse', options)

				options = {}
				options.textcolor = 'hsla(260, 0%, 0%, 1)'
				updateText('simulationgraph', 'mousetext', options)

				options = {}
				options.textcolor = 'hsla(260, 0%, 0%, 1)'
				document.getElementById('mousestatusdisplay').style.color = options.textcolor
				
				document.getElementById('darkback').style.backgroundColor = 'transparent'

				document.getElementById('controltab').style.backgroundColor = "hsla(260, 100%, 50%, 0.4)"
				document.getElementById('strategytab').style.backgroundColor = "hsla(260, 100%, 50%, 0.4)"
				document.getElementById('settingtab').style.backgroundColor = "hsla(260, 100%, 50%, 0.4)"

				document.getElementById('controltab').style.color = "black"
				document.getElementById('strategytab').style.color = "black"
				document.getElementById('settingtab').style.color = "black"

				if (currenttab == 'controltab') {
					document.getElementById('controltab').style.color = "white"
					for (bn = 1; bn < 13; bn++) {
						document.getElementById('cbtn' + bn).style.color = "black"
						document.getElementById('cbtn' + bn).style.backgroundColor = "transparent"
					}
				}
				else if (currenttab == 'strategytab') {
					document.getElementById('strategytab').style.color = "white"
				}
				else if (currenttab == 'settingtab') {
					document.getElementById('settingtab').style.color = "white"
				}

				for (m = 0; m < strategies.length; m++) {
					if (statname == strategies[m]) {
						document.getElementById(strategies[m]).style.color = 'hsla(190, 100%, 50%, 1)'
						document.getElementById(strategies[m] + '-box').style.color = 'black'
					}
					else {
						document.getElementById(strategies[m]).style.color = 'black'
						document.getElementById(strategies[m] + '-box').style.color = 'black'
					}
				}


				document.getElementById('catspeedtext').style.color = "black"
				document.getElementById('catspeedinput').style.color = "black"
				document.getElementById('catspeedinput').style.backgroundColor = "transparent"
				document.getElementById('mousespeedtext').style.color = "black"
				document.getElementById('mousespeedinput').style.color = "black"
				document.getElementById('mousespeedinput').style.backgroundColor = "transparent"

				for (st = 0; st < 5; st++) {
					if (settingstatus[st]) {
						document.getElementById(settingslist[st]).style.color = "hsla(190, 100%, 50%, 1)"
						document.getElementById(settingslist[st] + '-box').style.color = "hsla(190, 100%, 0%, 1)"
					}
					else {
						document.getElementById(settingslist[st]).style.color = "hsla(190, 100%, 0%, 1)"
						document.getElementById(settingslist[st] + '-box').style.color = "hsla(190, 100%, 0%, 1)"
					}
				}

				options = {}
				options.circlecolor = 'hsla(190, 100%, 50%, 1)'
				updateCircle('simulationgraph', 'pond', options)

				options = {}
				options.pointcolor = 'hsla(200, 100%, 0%, 0.5)'
				updatePoint('simulationgraph', 'oppositePoint', options)

				if (mode != 'portrait') {
					for (stg = 0; stg < strategies.length; stg++) {
						document.getElementById(strategies[stg]).style.backgroundColor = 'hsla(190, 100%, 0%, 0.1)'
					}
				}
					

			}
			else {
				darkmode = true
				document.getElementById('darkmodeoption').style.backgroundColor = 'hsla(190, 100%, 50%, 1)'
				document.getElementById('darkmodeoption').style.color = 'hsla(190, 100%, 100%, 1)'
				document.getElementById('darkmodeoption').style.fontWeight = 'bold'

				document.body.style.background = 'black'

				document.getElementById('maintitle').style.color = 'hsla(190, 100%, 100%, 1)'

				document.getElementById('maintitle').style.color = 'hsla(190, 100%, 100%, 1)'
				document.getElementById('websitelink').style.color = 'hsla(260, 100%, 80%, 1)'
				document.getElementById('asimulationtext').style.color = 'hsla(190, 100%, 80%, 1)'

				document.getElementById('info').style.color = 'hsla(190, 0%, 90%, 1)'

				


				options = {}
				options.pointcolor = 'hsla(260, 100%, 100%, 1)'
				updatePoint('simulationgraph', 'cat', options)

				options = {}
				options.textcolor = 'hsla(260, 0%, 100%, 1)'
				updateText('simulationgraph', 'cattext', options)

				options = {}
				options.pointcolor = 'hsla(260, 0%, 100%, 1)'
				updatePoint('simulationgraph', 'mouse', options)

				options = {}
				options.textcolor = 'hsla(260, 0%, 100%, 1)'
				updateText('simulationgraph', 'mousetext', options)


				options = {}
				options.textcolor = 'hsla(260, 0%, 100%, 1)'
				document.getElementById('mousestatusdisplay').style.color = options.textcolor

				document.getElementById('darkback').style.backgroundColor = 'hsla(190, 0%, 10%, 1)'

				if (currenttab == 'controltab') {
					document.getElementById('controltab').style.backgroundColor = "hsla(260, 0%, 20%, 1)"
					document.getElementById('controltab').style.color = "white"
					for (k = 1; k < 13; k++) {
						document.getElementById('cbtn' + k).style.backgroundColor = "hsla(190, 100%, 0%, 1)"
						document.getElementById('cbtn' + k).style.color = "hsla(190, 100%, 50%, 1)"
					}

				}
				else {
					document.getElementById('controltab').style.backgroundColor = "hsla(260, 0%, 0%, 1)"
					document.getElementById('controltab').style.color = "hsla(100, 0%, 55%, 1)"
				}

				if (currenttab == 'strategytab') {
					document.getElementById('strategytab').style.backgroundColor = "hsla(260, 0%, 20%, 1)"
					document.getElementById('strategytab').style.color = "white"
				}
				else {
					document.getElementById('strategytab').style.backgroundColor = "hsla(260, 0%, 0%, 1)"
					document.getElementById('strategytab').style.color = "hsla(100, 0%, 55%, 1)"
				}

				if (currenttab == 'settingtab') {
					document.getElementById('settingtab').style.backgroundColor = "hsla(260, 0%, 20%, 1)"
					document.getElementById('settingtab').style.color = "white"
				}
				else {
					document.getElementById('settingtab').style.backgroundColor = "hsla(260, 0%, 0%, 1)"
					document.getElementById('settingtab').style.color = "hsla(100, 0%, 55%, 1)"
				}

				statname = tactic

				for (m = 0; m < strategies.length; m++) {
					if (statname == strategies[m]) {
						document.getElementById(strategies[m]).style.color = 'hsla(190, 100%, 50%, 1)'
						document.getElementById(strategies[m] + '-box').style.color = 'white'
					}
					else {
						document.getElementById(strategies[m]).style.color = 'white'
						document.getElementById(strategies[m] + '-box').style.color = 'white'
					}
				}

				document.getElementById('catspeedtext').style.color = "white"
				document.getElementById('catspeedinput').style.color = "white"
				document.getElementById('catspeedinput').style.backgroundColor = "black"
				document.getElementById('mousespeedtext').style.color = "white"
				document.getElementById('mousespeedinput').style.color = "white"
				document.getElementById('mousespeedinput').style.backgroundColor = "black"

				for (st = 0; st < 5; st++) {
					if (settingstatus[st]) {
						document.getElementById(settingslist[st]).style.color = "hsla(190, 100%, 50%, 1)"
						document.getElementById(settingslist[st] + '-box').style.color = "hsla(190, 100%, 100%, 1)"
					}
					else {
						document.getElementById(settingslist[st]).style.color = "hsla(190, 100%, 100%, 1)"
						document.getElementById(settingslist[st] + '-box').style.color = "hsla(190, 100%, 100%, 1)"
					}
				}

				options = {}
				options.circlecolor = 'hsla(200, 100%, 50%, 1)'
				updateCircle('simulationgraph', 'pond', options)

				options = {}
				options.pointcolor = 'hsla(200, 100%, 100%, 0.5)'
				updatePoint('simulationgraph', 'oppositePoint', options)

				if (mode != 'portrait') {
					for (stg = 0; stg < strategies.length; stg++) {
						document.getElementById(strategies[stg]).style.backgroundColor = 'black'
					}
				}
			}
		}

		darkmode = false

		if (darkmode) {
			document.body.style.background = 'black'
		}

		function graphToSvgY(value, graphymin, graphymax) {
			if (graphymin == graphymax) {
				graphymin = graphymin - 1
				graphymax = graphymax + 1
				console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphymax + ' and Min value : ' + graphymin)
			}
			if (graphymin > graphymax) {
				temp = graphymin
				graphymin = graphymax
				graphymax = temp
				console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphymax + ' and Min value : ' + graphymin)
			}
			y = ((-80)/(graphymax - graphymin))*(value - graphymin) + 90
			return y
		}

		function graphToScaledY(value, graphymin, graphymax, aspectratio) {
			if(aspectratio > 1) {
				if (graphymin == graphymax) {
					graphymin = graphymin - 1
					graphymax = graphymax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				if (graphymin > graphymax) {
					temp = graphymin
					graphymin = graphymax
					graphymax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				y = ((-80)/(graphymax - graphymin))*(value - graphymin) + 90
				
			}
			else {
				if (graphymin == graphymax) {
					graphymin = graphymin - 1
					graphymax = graphymax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				if (graphymin > graphymax) {
					temp = graphymin
					graphymin = graphymax
					graphymax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				aspectratio = 1/aspectratio
				vl = (100*(1 - aspectratio)/2) + (10*aspectratio)
				vh = (100*(aspectratio + 1)/2) - (10*aspectratio)
				y = ((vl - vh)/(graphymax - graphymin))*(value - graphymin) + vh
				// console.log(x)
				// console.log(v1, v2)
				// y = (((v2 - v1)/(100))*(y)) + v1
			}

			return y
		}

		function svgToGraphY(percentvalue, graphymin, graphymax, aspectratio) {
			if(aspectratio > 1) {
				if (graphymin == graphymax) {
					graphymin = graphymin - 1
					graphymax = graphymax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				if (graphymin > graphymax) {
					temp = graphymin
					graphymin = graphymax
					graphymax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}

				y = ((percentvalue - 90)*(graphymax - graphymin)/((-1)*80)) + graphymin
				
			}
			else {
				if (graphymin == graphymax) {
					graphymin = graphymin - 1
					graphymax = graphymax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				if (graphymin > graphymax) {
					temp = graphymin
					graphymin = graphymax
					graphymax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphymax + ' and Min value : ' + graphymin)
				}
				aspectratio = 1/aspectratio
				vl = (100*(1 - aspectratio)/2) + (10*aspectratio)
				vh = (100*(aspectratio + 1)/2) - (10*aspectratio)

				// y = ((vl - vh)/(graphymax - graphymin))*(value - graphymin) + vh
				y = (((percentvalue - vh)*(graphymax - graphymin))/(vl - vh)) + graphymin
				// console.log(x)
				// console.log(v1, v2)
				// y = (((v2 - v1)/(100))*(y)) + v1
			}

			return y
		}

		function graphToSvgX(value, graphxmin, graphxmax) {
			if (graphxmin == graphxmax) {
				graphxmin = graphxmin - 1
				graphxmax = graphxmax + 1
				console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
			}
			if (graphxmin > graphxmax) {
				temp = graphxmin
				graphxmin = graphxmax
				graphxmax = temp
				console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
			}
			x = ((80)/(graphxmax - graphxmin))*(value - graphxmin) + 10
			return x
		}

		function graphToScaledX(value, graphxmin, graphxmax, aspectratio) {
			if (aspectratio <= 1) {
				if (graphxmin == graphxmax) {
					graphxmin = graphxmin - 1
					graphxmax = graphxmax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				if (graphxmin > graphxmax) {
					temp = graphxmin
					graphxmin = graphxmax
					graphxmax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				x = ((80)/(graphxmax - graphxmin))*(value - graphxmin) + 10
			}
			else {
				if (graphxmin == graphxmax) {
					graphxmin = graphxmin - 1
					graphxmax = graphxmax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				if (graphxmin > graphxmax) {
					temp = graphxmin
					graphxmin = graphxmax
					graphxmax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				vl = (100*(1 - aspectratio)/2) + (10*aspectratio)
				vh = (100*(aspectratio + 1)/2) - (10*aspectratio)
				x = ((vh - vl)/(graphxmax - graphxmin))*(value - graphxmin) + vl
				// console.log(x)
				// console.log(v1, v2)
				// y - y1 = (y2 - y1)/(x2 - x1) * (x - x1)
				// x = (((v2 - v1)/(90))*(x - 10)) + v1
				// console.log(x)
				// console.log('_') 
			}
			return x
		}

		function svgToGraphX(percentvalue, graphxmin, graphxmax, aspectratio) {
			if (aspectratio <= 1) {
				if (graphxmin == graphxmax) {
					graphxmin = graphxmin - 1
					graphxmax = graphxmax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				if (graphxmin > graphxmax) {
					temp = graphxmin
					graphxmin = graphxmax
					graphxmax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}

				x = ((percentvalue - 10)*(graphxmax - graphxmin)/80) + graphxmin
			}
			else {
				if (graphxmin == graphxmax) {
					graphxmin = graphxmin - 1
					graphxmax = graphxmax + 1
					console.log('Conversion error, maximum value is equal to minimum value. Max value was raised by 1 and Min value was reduced by 1. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				if (graphxmin > graphxmax) {
					temp = graphxmin
					graphxmin = graphxmax
					graphxmax = temp
					console.log('Conversion error, maximum value less than minimum value. Values were swapped. Max value : ' + graphxmax + ' and Min value : ' + graphxmin)
				}
				vl = (100*(1 - aspectratio)/2) + (10*aspectratio)
				vh = (100*(aspectratio + 1)/2) - (10*aspectratio)

				// x = ((vh - vl)/(graphxmax - graphxmin))*(value - graphxmin) + vl

				x = ((percentvalue - vl)*(graphxmax - graphxmin)/(vh - vl)) + graphxmin

				// y - y1 = (y2 - y1)/(x2 - x1) * (x - x1)
				// x = (((v2 - v1)/(90))*(x - 10)) + v1
				 
			}
			return x
		}

		function isInt(n){
			return Number(n) === n && n % 1 === 0;
		}

		function isFloat(n){
			return Number(n) === n && n % 1 !== 0;
		}

		function gridtickvalues(valmin, valmax, ticksexpected) {
			expstring = ((valmax - valmin)/ticksexpected).toExponential()
			majorgridorder = parseFloat(Math.pow(10 , expstring.slice(expstring.indexOf('e') + 1)))
			
			if (expstring.indexOf('.') != -1) {
				majorgriddivision = parseFloat(expstring.slice(0, expstring.indexOf('.'))*majorgridorder)	
			}
			else {
				majorgriddivision = parseFloat(expstring.slice(0, expstring.indexOf('e'))*majorgridorder)
			}
			

			integerchoices = [1,2,5,10]
			for(choice = 0; choice < integerchoices.length - 1; choice++) {
				if (majorgriddivision < integerchoices[choice + 1]*majorgridorder) {
					majorgriddivisionchoice = majorgridorder*integerchoices[choice]
					break
				}
			}

			if(valmin > 0) {
				majorgridstart = Math.ceil(valmin/majorgriddivisionchoice)*majorgriddivisionchoice;
				majorgridstart = majorgridstart - majorgriddivisionchoice
			}
			else if(valmin < 0) {
				majorgridstart = Math.floor(valmin/majorgriddivisionchoice)*majorgriddivisionchoice;
			}
			else{
				majorgridstart = majorgriddivisionchoice;
			}

			// majorgridstart = majorgridstart - majorgriddivisionchoice
			// console.log(majorgridstart, (valmax + majorgriddivisionchoice), majorgriddivisionchoice)

			majortickvalues = []
			for(majoraxispoint = majorgridstart; majoraxispoint < (valmax + majorgriddivisionchoice); majoraxispoint = majoraxispoint + majorgriddivisionchoice) {
				majortickvalues.push(majoraxispoint)
			}

			return majortickvalues
		}

		function updateGraphZoom(graphname, newMinMax) {
			gdata = graphData[graphname]

			svgElement = gdata.svgElement

			if (newMinMax.xmin != 0) {
				gdata.xmin = newMinMax.xmin || gdata.xmin
			}
			else {
				gdata.xmin = 0
			}

			if (newMinMax.xmax != 0) {
				gdata.xmax = newMinMax.xmax || gdata.xmax
			}
			else {
				gdata.xmax = 0
			}

			if (newMinMax.ymin != 0) {
				gdata.ymin = newMinMax.ymin || gdata.ymin
			}
			else {
				gdata.ymin = 0
			}

			if (newMinMax.ymax != 0) {
				gdata.ymax = newMinMax.ymax || gdata.ymax
			}
			else {
				gdata.ymax = 0
			}

			aratio = gdata.aspectratio

			if (gdata.unitAspectRatio == 'yes') {
				if (gdata.fixAxis == 'yaxis') {
					if (gdata.fixAxisStretchCentrally == 'yes') {
						centre = (gdata.xmax + gdata.xmin)/2
						gdata.xmin = centre - ((gdata.ymax - gdata.ymin)*aratio/2)
						gdata.xmax = centre + ((gdata.ymax - gdata.ymin)*aratio/2)
					}
					else {
						gdata.xmax = gdata.xmin + (gdata.ymax - gdata.ymin)*aratio
					}
					
				}
				else {
					if (gdata.fixAxisStretchCentrally == 'yes') {
						centre = (gdata.ymax + gdata.ymin)/2
						gdata.ymin = centre - ((gdata.xmax - gdata.xmin)*aratio/2)
						gdata.ymax = centre + ((gdata.xmax - gdata.xmin)*aratio/2)
					}
					else {
						gdata.ymax = gdata.ymin + (gdata.xmax - gdata.xmin)*aratio	
					}
					
				}
			}

			if (gdata.yaxisvisibility == 'yes') {
				var lineElement = gdata.yaxisElement
				lineElement.setAttribute('x1', graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) + '%');
				lineElement.setAttribute('y1', graphToScaledY(gdata.ymax, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('x2', graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) + '%')
				lineElement.setAttribute('y2', graphToScaledY(gdata.ymin, gdata.ymin, gdata.ymax, aratio) + '%');
				if (darkmode == false) {
					lineElement.style.stroke = gdata.yaxiscolor
				}
				else {
					lineElement.style.stroke = 'hsla(0, 0%, 100%, 1)'
				}
				gdata.yaxisElement = lineElement
			}

			if (gdata.xaxisvisibility == 'yes') {
				var lineElement = gdata.xaxisElement
				lineElement.setAttribute('x1', graphToScaledX(gdata.xmin, gdata.xmin, gdata.xmax, aratio) + '%');
				lineElement.setAttribute('y1', graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('x2', graphToScaledX(gdata.xmax, gdata.xmin, gdata.xmax, aratio) + '%')
				lineElement.setAttribute('y2', graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) + '%');
				if (darkmode == false) {
					lineElement.style.stroke = gdata.xaxiscolor
				}
				else {
					lineElement.style.stroke = 'hsla(0, 0%, 100%, 1)'
				}
				gdata.xaxisElement = lineElement
			}

			deleteSegments(gdata.xmajorgridElements)

			if (gdata.xmajorgridlinesvisibility == 'yes') {
				xmajortickvalues = gridtickvalues(gdata.xmin, gdata.xmax, ticks)
				gdata.xmajorgridElements = []
				for (m = 0; m < xmajortickvalues.length; m++) {
					ticklocation = xmajortickvalues[m]
					var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
					ylength = (gdata.ymax - gdata.ymin)
					if (gdata.xmajorgridlinesextension == 'yes') {
						lineElement.setAttribute('x1', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(gdata.ymin - (ylength)/2, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(gdata.ymax + (ylength)/2, gdata.ymin, gdata.ymax, aratio) + '%');
						
					}
					else {
						lineElement.setAttribute('x1', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(gdata.ymin, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(gdata.ymax, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('id', gdata.name + '-xmajorgridline-' + m)
					}
					if (darkmode == false) {
						lineElement.style.stroke = gdata.xmajorgridcolor
					}
					else {
						lineElement.style.stroke = 'hsla(0, 0%, 100%, 1)'
					}
					lineElement.setAttribute('id', gdata.name + '-xmajorgridline-' + m)	
					lineElement.style.strokeWidth = gdata.xmajorgridthickness + '%';
					gdata.xmajorgridElements.push(lineElement)
					svgElement.appendChild(lineElement);
				}
				gdata.xmajorgridticks = xmajortickvalues
			}

			deleteSegments(gdata.ymajorgridElements)

			if (gdata.ymajorgridlinesvisibility == 'yes') {
				ymajortickvalues = gridtickvalues(gdata.ymin, gdata.ymax, ticks)
				gdata.ymajorgridElements = []
				for (m = 0; m < ymajortickvalues.length; m++) {
					ticklocation = ymajortickvalues[m]
					var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
					xlength = (gdata.xmax - gdata.xmin)
					if (gdata.ymajorgridlinesextension == 'yes') {
						lineElement.setAttribute('x1', graphToScaledX((gdata.xmin) - xlength/2, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(gdata.xmax + (xlength/2), gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
					}
					else {
						lineElement.setAttribute('x1', graphToScaledX(gdata.xmin, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(gdata.xmax, gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
					}
					lineElement.setAttribute('id', gdata.name + '-ymajorgridline-' + m)
					if (darkmode == false) {
						lineElement.style.stroke = gdata.ymajorgridcolor
					}
					else {
						lineElement.style.stroke = 'hsla(0, 0%, 100%, 1)'
					}
					lineElement.setAttribute('id', gdata.name + '-ymajorgridline-' + m)
					lineElement.style.strokeWidth = gdata.ymajorgridthickness + '%';
					gdata.ymajorgridElements.push(lineElement)
					svgElement.appendChild(lineElement);
				}
				gdata.ymajorgridticks = ymajortickvalues
			}

			deleteSegments(gdata.ymajorlabelsElements)

			if (gdata.ymajorgridlabelvisibility == 'yes') {
				gdata.ymajorlabelsElements = []
				ymajortickvalues = gridtickvalues(gdata.ymin, gdata.ymax, ticks)
				scale = gdata.ymax - gdata.ymin
				expstring = scale.toExponential().toString()
				order = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
				labelylocationX = gdata.axislocationX
				if (graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) < 0) {
					labelylocationX = gdata.xmin
				}
				if (graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) > 100) {
					labelylocationX = gdata.xmax
				}
				for (m = gdata.ylabelexclusionsstart; m < ymajortickvalues.length - gdata.ylabelexclusionsend; m++) {
					ticklocation = ymajortickvalues[m]

					
					var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');
					

					if(isInt(ticklocation)) {
						if (gdata.isComplexPlane == 'yes') {
							textElement.innerHTML = ticklocation + 'i'
						}
						else {
							textElement.innerHTML = ticklocation
						}
					}
					else {
						
						if (Math.abs(ticklocation) < 0.01 && order > 2) {
							ticklocation = ticklocation.toExponential(order)
								
						}
						else {
							ticklocation = ticklocation.toFixed(order + 1)
						}
						if (gdata.isComplexPlane == 'yes') {
							textElement.innerHTML = ticklocation + 'i'
						}
						else {
							textElement.innerHTML = ticklocation	
						}
						if(ticklocation == 0) {
							textElement.innerHTML = 0
						}

					}


					textElement.setAttribute('x', graphToScaledX(labelylocationX, gdata.xmin, gdata.xmax, aratio) + 0.5 + gdata.ymajorgridlabelshift + '%');
					textElement.setAttribute('y',graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + 0.5 + '%');
					textElement.setAttribute('id',gdata.name + '-yticklabel-' + m)
					textElement.style.fontSize = gdata.fontSize
					textElement.style.fontFamily = 'Source Sans Pro'
					textElement.style.userSelect = 'none'
					// textElement.setAttribute('text-anchor', 'middle')
					textElement.style.fill = gdata.ymajorgridlabelcolor
					if (darkmode == false) {
						textElement.style.fill = gdata.ymajorgridlabelcolor
					}
					else {
						textElement.style.fill = 'hsla(0, 0%, 100%, 1)'
					}	
					svgElement.appendChild(textElement);

					gdata.ymajorlabelsElements.push(textElement)
					
				}
			}


			deleteSegments(gdata.xmajorlabelsElements)

			if (gdata.xmajorgridlabelvisibility == 'yes') {
				gdata.xmajorlabelsElements = []
				xmajortickvalues = gridtickvalues(gdata.xmin, gdata.xmax, ticks)
				scale = gdata.xmax - gdata.xmin
				expstring = scale.toExponential().toString()
				order = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
				
				labelxlocationY = gdata.axislocationY
				if (graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) < 0) {
					labelxlocationY = gdata.ymax
				}
				if (graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) > 100) {
					labelxlocationY = gdata.ymin
				}


				for (m = gdata.xlabelexclusionsstart; m < xmajortickvalues.length - gdata.xlabelexclusionsend; m++) {
					ticklocation = xmajortickvalues[m]

					var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');

					if(isInt(ticklocation)) {
						textElement.innerHTML = ticklocation
					}
					else {
						
						if (Math.abs(ticklocation) < 0.01 && order > 2) {
							ticklocation = ticklocation.toExponential(order)
							
							
						}
						else {
							ticklocation = ticklocation.toFixed(order + 1)
						}
						textElement.innerHTML = ticklocation	
						
						if(ticklocation == 0) {
							textElement.innerHTML = 0
						}

					}

					transformedXval = graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) - 1
					textElement.setAttribute('x', transformedXval + '%');
					transformedYval = graphToScaledY(labelxlocationY, gdata.ymin, gdata.ymax, aratio) + 2 + gdata.xmajorgridlabelshift
					textElement.setAttribute('y', transformedYval + '%');
					textElement.setAttribute('id',gdata.name + '-xticklabel-' + m)
					textElement.style.fontSize = gdata.fontSize
					textElement.style.userSelect = 'none'
					textElement.setAttribute('text-anchor', 'middle')
					if (parseFloat(order) >= 2) {
						textElement.setAttribute('transform', 'rotate(90, ' + transformedXval + ', ' + transformedYval + ')')	
					}
					textElement.style.fontFamily = 'Source Sans Pro'
					if (darkmode == false) {
						textElement.style.fill = gdata.xmajorgridlabelcolor
					}
					else {
						textElement.style.fill = 'hsla(0, 0%, 100%, 1)'
					}
					svgElement.appendChild(textElement);
					
					gdata.xmajorlabelsElements.push(textElement)
					
				}
			}


			if (gdata.xaxislabelvisibility == 'yes') {
				var textElement = gdata.xaxislabelElement 
				textElement.setAttribute('x', graphToScaledX(gdata.xmax, gdata.xmin, gdata.xmax, aratio) + gdata.xaxislabelshift + '%');
				textElement.setAttribute('y',graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) + 1 + '%');
				gdata.xaxislabelElement = textElement
			}


			if (gdata.yaxislabelvisibility == 'yes') {
				var textElement = gdata.yaxislabelElement
				textElement.setAttribute('x', graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) + 0 + '%');
				textElement.setAttribute('y',graphToScaledY(gdata.ymax, gdata.ymin, gdata.ymax, aratio) - gdata.yaxislabelshift + '%');
				gdata.yaxislabelElement = textElement
				
			}


			for (var key in gdata.lineData) {
				lineElement = gdata.lineData[key][0]
				lineoptions = gdata.lineData[key][1]

				lineElement.setAttribute('x1', graphToScaledX(lineoptions.x1, gdata.xmin, gdata.xmax, aratio) + '%');
				lineElement.setAttribute('y1', graphToScaledY(lineoptions.y1, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('x2', graphToScaledX(lineoptions.x2, gdata.xmin, gdata.xmax, aratio) + '%')
				lineElement.setAttribute('y2', graphToScaledY(lineoptions.y2, gdata.ymin, gdata.ymax, aratio) + '%');
			}

			for (var key in gdata.circleData) {
				circleElement = gdata.circleData[key][0]
				circleoptions = gdata.circleData[key][1]
				rx = distanceBTWgraphToSvg([0,0],[circleoptions.radius, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
				ry = distanceBTWgraphToSvg([0,0],[0,circleoptions.radius], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
				circleElement.setAttribute('cx', graphToScaledX(circleoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
				circleElement.setAttribute('cy', graphToScaledY(circleoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
				circleElement.setAttribute('rx', rx + '%')
				circleElement.setAttribute('ry', ry + '%');
				
			}

			for (var key in gdata.pathData) {
				pathElement = gdata.pathData[key][0]
				pathoptions = gdata.pathData[key][1]
				pathstring = 'M'
				for (pth = 0; pth < pathoptions.points.length; pth++) {
					if (pth == 0) {
						pathstring = pathstring + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
					}
					else {
						pathstring = pathstring + 'L' + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
					}
				}
				pathElement.setAttribute('d', pathstring);

			}

			for (var key in gdata.ellipseData) {
				ellipseElement = gdata.ellipseData[key][0]
				ellipseoptions = gdata.ellipseData[key][1]
				rx = distanceBTWgraphToSvg([0,0],[ellipseoptions.rx, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
				ry = distanceBTWgraphToSvg([0,0],[0, ellipseoptions.ry], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
				ellipseElement.setAttribute('cx', graphToScaledX(ellipseoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
				ellipseElement.setAttribute('cy', graphToScaledY(ellipseoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
				ellipseElement.setAttribute('rx', rx + '%')
				ellipseElement.setAttribute('ry', ry + '%');
				
			}

			for (var key in gdata.textData) {
				textElement = gdata.textData[key][0]
				textoptions = gdata.textData[key][1]
				textElement.setAttribute('x', graphToScaledX(textoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
				textElement.setAttribute('y', graphToScaledY(textoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			
			}

			for (var key in gdata.rectData) {
				rectElement = gdata.rectData[key][0]
				rectoptions = gdata.rectData[key][1]
				
				
				rx = distanceBTWgraphToSvg([0,0],[rectoptions.w, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
				ry = distanceBTWgraphToSvg([0,0],[0, rectoptions.h], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
				
				rectElement.setAttribute('x', graphToScaledX(rectoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
				rectElement.setAttribute('y', graphToScaledY(rectoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
				rectElement.setAttribute('width', rx + '%')
				rectElement.setAttribute('height', ry + '%');
			}			

			for (var key in gdata.pointData) {
				pointElement = gdata.pointData[key][0]
				pointoptions = gdata.pointData[key][1]
				
				
				pointElement.setAttribute('cx', graphToScaledX(pointoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
				pointElement.setAttribute('cy', graphToScaledY(pointoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			}			
		}

		function addGraph(parentdiv, name, gdata) {
			gdata = gdata || {}

			gdata.name = name || 'graph' + Math.random().toString()

			if (gdata.axislocationX != 0) {
				gdata.axislocationX = gdata.axislocationX || 0
			}
			else {
				gdata.axislocationX = 0
			}
			if (gdata.axislocationY != 0) {
				gdata.axislocationY = gdata.axislocationY || 0
			}
			else {
				gdata.axislocationY = 0
			}
			if (gdata.xmin != 0) {
				gdata.xmin = gdata.xmin || -1
			}
			else {
				gdata.xmin = 0
			}
			if (gdata.xmax != 0) {
				gdata.xmax = gdata.xmax || -1
			}
			else {
				gdata.xmax = 0
			}
			if (gdata.ymin != 0) {
				gdata.ymin = gdata.ymin || -1
			}
			else {
				gdata.ymin = 0
			}
			if (gdata.ymax != 0) {
				gdata.ymax = gdata.ymax || -1
			}
			else {
				gdata.ymax = 0
			}

			gdata.unitAspectRatio = gdata.unitAspectRatio || 'no'
			gdata.fixAxis = gdata.fixAxis || 'yaxis'
			gdata.fixAxisStretchCentrally = gdata.fixAxisStretchCentrally || 'no'


			gdata.xaxisvisibility = gdata.xaxisvisibility || 'yes'
			gdata.yaxisvisibility = gdata.yaxisvisibility || 'yes'

			gdata.xaxislabelvisibility = gdata.xaxislabelvisibility || 'yes' 
			gdata.yaxislabelvisibility = gdata.yaxislabelvisibility || 'yes'
			
			gdata.xmajorgridlinesvisibility = gdata.xmajorgridlinesvisibility || 'yes'
			gdata.ymajorgridlinesvisibility = gdata.ymajorgridlinesvisibility || 'yes'

			gdata.position = gdata.position || 'absolute'

			var svgElement = document.createElementNS("http://www.w3.org/2000/svg", 'svg');
			svgElement.setAttribute('height',"100%");
			svgElement.setAttribute('width', '100%');
			svgElement.setAttribute('viewBox',"0 0 100 100")
			// svgElement.setAttribute('preserveAspectRatio',"none")
			svgElement.setAttribute('id', name)
			svgElement.style.position = gdata.position
			svgElement.style.left = '0%'
			svgElement.style.top = '0%'
			parentdiv.appendChild(svgElement)
			gdata.svgElement = svgElement
			gdata.parentElement = parentdiv

			gdata.fontSize = gdata.fontSize || 5

			gdata.gridlinenumberX = gdata.gridlinenumberX || 10
			gdata.gridlinenumberY = gdata.gridlinenumberY || 10

			

			gdata.parentW = parentdiv.offsetWidth
			gdata.parentH = parentdiv.offsetHeight

			aratio = parentdiv.offsetWidth/parentdiv.offsetHeight

			if (gdata.unitAspectRatio == 'yes') {
				if (gdata.fixAxis == 'yaxis') {
					if (gdata.fixAxisStretchCentrally == 'yes') {
						centre = (gdata.xmax + gdata.xmin)/2
						gdata.xmin = centre - ((gdata.ymax - gdata.ymin)*aratio/2)
						gdata.xmax = centre + ((gdata.ymax - gdata.ymin)*aratio/2)
					}
					else {
						gdata.xmax = gdata.xmin + (gdata.ymax - gdata.ymin)*aratio
					}
					
				}
				else {
					if (gdata.fixAxisStretchCentrally == 'yes') {
						centre = (gdata.ymax + gdata.ymin)/2
						gdata.ymin = centre - ((gdata.xmax - gdata.xmin)*aratio/2)
						gdata.ymax = centre + ((gdata.xmax - gdata.xmin)*aratio/2)
					}
					else {
						gdata.ymax = gdata.ymin + (gdata.xmax - gdata.xmin)*aratio	
					}
					
				}
			}



			if (darkmode) {
				gdata.yaxiscolor = gdata.yaxiscolor || 'hsla(0, 100%, 100%, 1)'			
				gdata.xaxiscolor = gdata.xaxiscolor || 'hsla(0, 100%, 100%, 1)'			
				gdata.xmajorgridlabelcolor = gdata.xmajorgridlabelcolor || 'hsla(0, 100%, 100%, 1)'
				gdata.ymajorgridlabelcolor = gdata.ymajorgridlabelcolor || 'hsla(0, 100%, 100%, 1)'
				gdata.xmajorgridcolor = gdata.xmajorgridcolor || 'hsla(0, 100%, 100%, 1)'
				gdata.ymajorgridcolor = gdata.ymajorgridcolor || 'hsla(0, 100%, 100%, 1)'
			}

			gdata.yaxisthickness = gdata.yaxisthickness || 0.5
			gdata.yaxiscolor = gdata.yaxiscolor || 'hsla(0, 50%, 0%, 1)'


			if (gdata.yaxisvisibility == 'yes') {
				var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
				lineElement.setAttribute('x1', graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) + '%');
				lineElement.setAttribute('y1', graphToScaledY(gdata.ymax, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('vector-effect','non-scaling-stroke');
				lineElement.setAttribute('x2', graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) + '%')
				lineElement.setAttribute('y2', graphToScaledY(gdata.ymin, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('id', gdata.name + '-yaxis')
				lineElement.style.stroke = gdata.yaxiscolor
				lineElement.style.strokeWidth = gdata.yaxisthickness + '%';
				gdata.yaxisElement = lineElement
				svgElement.appendChild(lineElement);
			}

			gdata.xaxisthickness = gdata.xaxisthickness || 0.5
			gdata.xaxiscolor = gdata.xaxiscolor || 'hsla(0, 50%, 0%, 1)'

			
			if (gdata.xaxisvisibility == 'yes') {
				var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
				lineElement.setAttribute('x1', graphToScaledX(gdata.xmin, gdata.xmin, gdata.xmax, aratio) + '%');
				lineElement.setAttribute('y1', graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('vector-effect','non-scaling-stroke');
				lineElement.setAttribute('x2', graphToScaledX(gdata.xmax, gdata.xmin, gdata.xmax, aratio) + '%')
				lineElement.setAttribute('y2', graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) + '%');
				lineElement.setAttribute('id', gdata.name + '-xaxis')
				lineElement.style.stroke = gdata.xaxiscolor
				lineElement.style.strokeWidth = gdata.xaxisthickness + '%';
				gdata.xaxisElement = lineElement
				svgElement.appendChild(lineElement);
			}


			gdata.xmajorgridcolor = gdata.xmajorgridcolor || 'hsla(190, 0%, 50%, 1)'
			gdata.xmajorgridthickness = gdata.xmajorgridthickness || 0.3

			gdata.xmajorgridlinesextension = gdata.xmajorgridlinesextension || 'yes'
			gdata.ymajorgridlinesextension = gdata.ymajorgridlinesextension || 'yes'

			ticks = gdata.gridlinenumberX
			
			if (gdata.xmajorgridlinesvisibility == 'yes') {
				xmajortickvalues = gridtickvalues(gdata.xmin, gdata.xmax, ticks)
				gdata.xmajorgridElements = []
				for (m = 0; m < xmajortickvalues.length; m++) {
					ticklocation = xmajortickvalues[m]
					var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
					ylength = (gdata.ymax - gdata.ymin)
					if (gdata.xmajorgridlinesextension == 'yes') {
						lineElement.setAttribute('x1', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(gdata.ymin - (ylength)/2, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(gdata.ymax + (ylength)/2, gdata.ymin, gdata.ymax, aratio) + '%');
						
					}
					else {
						lineElement.setAttribute('x1', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(gdata.ymin, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(gdata.ymax, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('id', gdata.name + '-xmajorgridline-' + m)
					}
					lineElement.setAttribute('id', gdata.name + '-xmajorgridline-' + m)
					lineElement.style.stroke = gdata.xmajorgridcolor
					lineElement.style.strokeWidth = gdata.xmajorgridthickness + '%';
					gdata.xmajorgridElements.push(lineElement)
					svgElement.appendChild(lineElement);
				}
				gdata.xmajorgridticks = xmajortickvalues
			}

			gdata.ymajorgridcolor = gdata.ymajorgridcolor || 'hsla(190, 0%, 50%, 1)'
			gdata.ymajorgridthickness = gdata.ymajorgridthickness || 0.3


			ticks = gdata.gridlinenumberY


			if (gdata.ymajorgridlinesvisibility == 'yes') {
				ymajortickvalues = gridtickvalues(gdata.ymin, gdata.ymax, ticks)
				gdata.ymajorgridElements = []
				for (m = 0; m < ymajortickvalues.length; m++) {
					ticklocation = ymajortickvalues[m]
					var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
					xlength = (gdata.xmax - gdata.xmin)
					if (gdata.ymajorgridlinesextension == 'yes') {
						lineElement.setAttribute('x1', graphToScaledX((gdata.xmin) - xlength/2, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(gdata.xmax + (xlength/2), gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
					}
					else {
						lineElement.setAttribute('x1', graphToScaledX(gdata.xmin, gdata.xmin, gdata.xmax, aratio) + '%');
						lineElement.setAttribute('y1', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
						lineElement.setAttribute('vector-effect','non-scaling-stroke');
						lineElement.setAttribute('x2', graphToScaledX(gdata.xmax, gdata.xmin, gdata.xmax, aratio) + '%')
						lineElement.setAttribute('y2', graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + '%');
					}
					lineElement.setAttribute('id', gdata.name + '-ymajorgridline-' + m)
					lineElement.style.stroke = gdata.ymajorgridcolor
					lineElement.style.strokeWidth = gdata.ymajorgridthickness + '%';
					gdata.ymajorgridElements.push(lineElement)
					svgElement.appendChild(lineElement);
				}
				gdata.ymajorgridticks = ymajortickvalues
			}

			

			gdata.ymajorgridlabelvisibility = gdata.ymajorgridlabelvisibility || 'yes'
			gdata.ymajorgridlabelcolor = gdata.ymajorgridlabelcolor || 'hsla(190, 0%, 50%, 1)'


			gdata.ymajorgridlabelshift = gdata.ymajorgridlabelshift || 0.1
			gdata.xmajorgridlabelshift = gdata.xmajorgridlabelshift || 0.1

			gdata.xmajorgridlabelvisibility = gdata.xmajorgridlabelvisibility || 'yes'
			gdata.xmajorgridlabelcolor = gdata.xmajorgridlabelcolor || 'hsla(190, 0%, 50%, 1)'



			gdata.xlabelexclusionsstart = gdata.xlabelexclusionsstart || 0
			gdata.xlabelexclusionsend = gdata.xlabelexclusionsend || 0

			gdata.ylabelexclusionsstart = gdata.ylabelexclusionsstart || 0
			gdata.ylabelexclusionsend = gdata.ylabelexclusionsend || 0


			gdata.isComplexPlane = gdata.isComplexPlane || 'no'


			if (gdata.ymajorgridlabelvisibility == 'yes') {
				gdata.ymajorlabelsElements = []
				ymajortickvalues = gridtickvalues(gdata.ymin, gdata.ymax, ticks)
				labelylocationX = gdata.axislocationX
				if (graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) < 0) {
					labelylocationX = gdata.xmin
				}
				if (graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) > 100) {
					labelylocationX = gdata.xmax
				}
				for (m = gdata.ylabelexclusionsstart; m < ymajortickvalues.length - gdata.ylabelexclusionsend; m++) {
					ticklocation = ymajortickvalues[m]

					var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');
					

					if(isInt(ticklocation)) {
						if (gdata.isComplexPlane == 'yes') {
							textElement.innerHTML = ticklocation + 'i'
						}
					}
					else {
						expstring = ticklocation.toExponential().toString()
						order = (expstring.slice(expstring
							.indexOf('e') + 1)*(-1))
						if (parseFloat(order) < -1) {
							ticklocation = ticklocation.toExponential(0)	
						}
						else {
							ticklocation = ticklocation.toFixed(2)
						}
						textElement.innerHTML = ticklocation
						if(ticklocation == 0) {
							textElement.innerHTML = 0
						}
						if (gdata.isComplexPlane == 'yes') {
							textElement.innerHTML = ticklocation + 'i'
						}

					}


					textElement.setAttribute('x', graphToScaledX(labelylocationX, gdata.xmin, gdata.xmax, aratio) + 0.5 + gdata.ymajorgridlabelshift + '%');
					textElement.setAttribute('y',graphToScaledY(ticklocation, gdata.ymin, gdata.ymax, aratio) + 0.5 + '%');
					textElement.setAttribute('id', gdata.name + '-yticklabel-' + m)
					textElement.style.fontSize = gdata.fontSize
					textElement.style.userSelect = 'none'
					textElement.style.fontFamily = 'Source Sans Pro'
					textElement.style.fill = gdata.ymajorgridlabelcolor
					svgElement.appendChild(textElement);

					gdata.ymajorlabelsElements.push(textElement)
					
				}
			}

			ticks = gdata.gridlinenumberX


			if (gdata.xmajorgridlabelvisibility == 'yes') {
				gdata.xmajorlabelsElements = []
				xmajortickvalues = gridtickvalues(gdata.xmin, gdata.xmax, ticks)
				labelxlocationY = gdata.axislocationY
				if (graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) < 0) {
					labelxlocationY = gdata.ymin
				}
				if (graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) > 100) {
					labelxlocationY = gdata.ymax
				}


				for (m = gdata.xlabelexclusionsstart; m < xmajortickvalues.length - gdata.xlabelexclusionsend; m++) {
					ticklocation = xmajortickvalues[m]

					var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');

					if(isInt(ticklocation)) {
						textElement.innerHTML = ticklocation
					}
					else {

						expstring = ticklocation.toExponential().toString()
						order = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
						if (parseFloat(order) < -1) {
							ticklocation = ticklocation.toExponential(0)	
						}
						else {
							ticklocation = ticklocation.toFixed(2)
						}
						textElement.innerHTML = ticklocation
						if(ticklocation == 0) {
							textElement.innerHTML = 0
						}

					}

					textElement.setAttribute('x', graphToScaledX(ticklocation, gdata.xmin, gdata.xmax, aratio) - 1 + '%');
					textElement.setAttribute('y',graphToScaledY(labelxlocationY, gdata.ymin, gdata.ymax, aratio) + 2 + gdata.xmajorgridlabelshift + '%');
					textElement.setAttribute('id', gdata.name + '-xticklabel-' + m)
					textElement.style.fontSize = gdata.fontSize
					textElement.style.fontFamily = 'Source Sans Pro'
					textElement.style.userSelect = 'none'
					textElement.style.fill = gdata.ymajorgridlabelcolor
					svgElement.appendChild(textElement);
					
					gdata.xmajorlabelsElements.push(textElement)
					
				}
			}


			gdata.xaxislabel = gdata.xaxislabel || 'x axis'
			gdata.yaxislabel = gdata.yaxislabel || 'y axis'

			gdata.xaxislabelshift = gdata.xaxislabelshift || 2
			gdata.yaxislabelshift = gdata.yaxislabelshift || 2

			if (darkmode) {
				gdata.yaxislabelcolor = gdata.yaxislabelcolor || 'hsla(190, 100%, 100%, 1)'
				gdata.xaxislabelcolor = gdata.xaxislabelcolor || 'hsla(190, 100%, 100%, 1)'
			}
			else {
				gdata.yaxislabelcolor = gdata.yaxislabelcolor || 'hsla(190, 0%, 0%, 1)'
				gdata.xaxislabelcolor = gdata.xaxislabelcolor || 'hsla(190, 0%, 0%, 1)'
			}
			


			if (gdata.xaxislabelvisibility == 'yes') {
				var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');
				textElement.innerHTML = gdata.xaxislabel 
				textElement.setAttribute('x', graphToScaledX(gdata.xmax, gdata.xmin, gdata.xmax, aratio) + gdata.xaxislabelshift + '%');
				textElement.setAttribute('y',graphToScaledY(gdata.axislocationY, gdata.ymin, gdata.ymax, aratio) + 1 + '%');
				textElement.setAttribute('id', name + '-xaxislabel')
				textElement.style.fontSize = gdata.fontSize
				textElement.style.color = gdata.xaxislabelcolor
				textElement.style.fontFamily = 'Source Sans Pro'
				
				svgElement.appendChild(textElement);
				gdata.xaxislabelElement = textElement
				
			}


			if (gdata.yaxislabelvisibility == 'yes') {
				var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');
				textElement.innerHTML = gdata.yaxislabel 
				textElement.setAttribute('x', graphToScaledX(gdata.axislocationX, gdata.xmin, gdata.xmax, aratio) + 0 + '%');
				textElement.setAttribute('y',graphToScaledY(gdata.ymax, gdata.ymin, gdata.ymax, aratio) - gdata.yaxislabelshift + '%');
				textElement.setAttribute('id',name + '-yaxislabel')
				textElement.style.fontSize = gdata.fontSize
				textElement.style.color = gdata.yaxislabelcolor
				textElement.style.fontFamily = 'Source Sans Pro'
				
				svgElement.appendChild(textElement);
				gdata.yaxislabelElement = textElement
				
			}

			gdata.scrollZoom = gdata.scrollZoom || 'yes'

			if (gdata.scrollZoom == 'yes') {
				svgElement.addEventListener('wheel', wheelHandle)
			}

			svgPTVariable[name] = svgElement.createSVGPoint()

			gdata.draggability = gdata.draggability || 'no'
			if (gdata.draggability == 'yes') {
				gdata.currentlyDraggableGraph = gdata.currentlyDraggableGraph || 'yes'
			}
			else {
				gdata.currentlyDraggableGraph = gdata.currentlyDraggableGraph || 'no'
			}
			gdata.runFunctionOnDragEnd = gdata.runFunctionOnDragEnd || ''
			gdata.runFunctionDuringDrag = gdata.runFunctionDuringDrag || ''

			if (gdata.draggability == 'yes') {
				svgElement.addEventListener('mousedown', graphDragHandle)
				svgElement.addEventListener('touchstart', graphDragHandle)
			}
			else {
				svgElement.style.pointerEvents = 'none'
				svgElement.addEventListener('touchmove', graphTouchDisable)
			}

			gdata.dragDirection = gdata.dragDirection || 'bothXY'
			gdata.dragIfCondition = gdata.dragIfCondition || 'true'


			gdata.lineData = {}
			gdata.circleData = {}
			gdata.pointData = {}
			gdata.ellipseData = {}
			gdata.rectData = {}
			gdata.textData = {}
			gdata.pathData = {}
			gdata.sliderData = {}

			gdata.aspectratio = aratio

			graphData[name] = gdata
			return JSON.parse(JSON.stringify(gdata));
		}

		function getGraphCursorLocation(cursorpercent, graphname) {
			gdata = graphData[graphname]

			graphEl = document.getElementById(gdata.name)

			valx = svgToGraphX(cursorpercent[0], gdata.xmin, gdata.xmax, gdata.aspectratio)
			valy = svgToGraphY(cursorpercent[1], gdata.ymin, gdata.ymax, gdata.aspectratio)

			return [valx, valy]
		}

		function addLine(graphname, linename, lineoptions) {
			gdata = graphData[graphname]
			lineoptions = lineoptions || {}

			aratio = gdata.aspectratio

			lineoptions.x1 = parseFloat(lineoptions.x1.toString() || 0)
			lineoptions.y1 = parseFloat(lineoptions.y1.toString() || 0)
			lineoptions.x2 = parseFloat(lineoptions.x2.toString() || 0.5)
			lineoptions.y2 = parseFloat(lineoptions.y2.toString() || 0.5)
			lineoptions.name = linename || uid

			lineoptions.strokedasharray = lineoptions.strokedasharray || ""
			lineoptions.strokewidth = lineoptions.strokewidth || 1
			lineoptions.linecolor = lineoptions.linecolor || 'hsla(190, 100%, 50%, 1)'

			var lineElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
			lineElement.setAttribute('x1', graphToScaledX(lineoptions.x1, gdata.xmin, gdata.xmax, aratio) + '%');
			lineElement.setAttribute('y1', graphToScaledY(lineoptions.y1, gdata.ymin, gdata.ymax, aratio) + '%');
			lineElement.setAttribute('x2', graphToScaledX(lineoptions.x2, gdata.xmin, gdata.xmax, aratio) + '%')
			lineElement.setAttribute('y2', graphToScaledY(lineoptions.y2, gdata.ymin, gdata.ymax, aratio) + '%');
			lineElement.setAttribute('stroke-dasharray', lineoptions.strokedasharray);
			
			lineElement.setAttribute('id', graphname + '-line-' + linename)
			uid = uid + 1
			lineElement.setAttribute('vector-effect','non-scaling-stroke');
			lineElement.style.stroke = lineoptions.linecolor
			lineElement.style.strokeWidth = lineoptions.strokewidth + '%';
			gdata.svgElement.appendChild(lineElement);

			graphData[graphname].lineData[linename] = [lineElement, lineoptions]
			return [lineElement, lineoptions]
		}

		function addSlider(graphname, slidername, slideroptions) {
			gdata = graphData[graphname]
			slideroptions = slideroptions || {}

			aratio = gdata.aspectratio

			slideroptions.x1 = parseFloat(slideroptions.x1.toString() || 0)
			slideroptions.y1 = parseFloat(slideroptions.y1.toString() || 0)
			slideroptions.x2 = parseFloat(slideroptions.x2.toString() || 0.5)
			slideroptions.y2 = parseFloat(slideroptions.y2.toString() || 0.5)
			slideroptions.name = slidername || uid

			slideroptions.automaticallySetKnobRadius

			slideroptions.currentvalue = parseFloat(slideroptions.currentvalue.toString() || 0.5)
			slideroptions.maxvalue = parseFloat(slideroptions.maxvalue.toString() || 0.5)
			slideroptions.minvalue = parseFloat(slideroptions.minvalue.toString() || 0.5)

			slideroptions.strokewidth = slideroptions.strokewidth || 1
			slideroptions.sliderfillcolor = slideroptions.sliderfillcolor || 'hsla(190, 100%, 50%, 1)'
			slideroptions.sliderbasecolor = slideroptions.sliderbasecolor || 'hsla(190, 0%, 70%, 1)'
			slideroptions.sliderknobcolor = slideroptions.sliderknobcolor || 'hsla(190, 100%, 50%, 1)'

			slideroptions.knobradius = parseFloat(slideroptions.knobradius || 0.5)

			kfactor = (slideroptions.currentvalue - slideroptions.minvalue)/(slideroptions.maxvalue - slideroptions.minvalue)

			slideroptions.cx = ((slideroptions.x2*kfactor) + slideroptions.x1)/(kfactor + 1)
			slideroptions.cy = ((slideroptions.y2*kfactor) + slideroptions.y1)/(kfactor + 1)

			slideroptions.cx = parseFloat(slideroptions.cx.toString() || 0)
			slideroptions.cy = parseFloat(slideroptions.cy.toString() || 0)

			var sliderbaseElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
			sliderbaseElement.setAttribute('x1', graphToScaledX(slideroptions.x1, gdata.xmin, gdata.xmax, aratio) + '%');
			sliderbaseElement.setAttribute('y1', graphToScaledY(slideroptions.y1, gdata.ymin, gdata.ymax, aratio) + '%');
			sliderbaseElement.setAttribute('x2', graphToScaledX(slideroptions.x2, gdata.xmin, gdata.xmax, aratio) + '%')
			sliderbaseElement.setAttribute('y2', graphToScaledY(slideroptions.y2, gdata.ymin, gdata.ymax, aratio) + '%');
			
			sliderbaseElement.setAttribute('id', graphname + '-slider-base-' + slidername)
			sliderbaseElement.setAttribute('vector-effect','non-scaling-stroke');
			sliderbaseElement.style.stroke = slideroptions.sliderbasecolor
			sliderbaseElement.style.strokeWidth = slideroptions.strokewidth + '%';
			gdata.svgElement.appendChild(sliderbaseElement);

			var sliderfillElement = document.createElementNS("http://www.w3.org/2000/svg", 'line');
			sliderfillElement.setAttribute('x1', graphToScaledX(slideroptions.x1, gdata.xmin, gdata.xmax, aratio) + '%');
			sliderfillElement.setAttribute('y1', graphToScaledY(slideroptions.y1, gdata.ymin, gdata.ymax, aratio) + '%');
			sliderfillElement.setAttribute('x2', graphToScaledX(slideroptions.cx, gdata.xmin, gdata.xmax, aratio) + '%')
			sliderfillElement.setAttribute('y2', graphToScaledY(slideroptions.cy, gdata.ymin, gdata.ymax, aratio) + '%');
			
			sliderfillElement.setAttribute('id', graphname + '-slider-fill-' + slidername)
			sliderfillElement.setAttribute('vector-effect','non-scaling-stroke');
			sliderfillElement.style.stroke = slideroptions.sliderfillcolor
			sliderfillElement.style.strokeWidth = slideroptions.strokewidth + '%';
			gdata.svgElement.appendChild(sliderfillElement);

			rx = distanceBTWgraphToSvg([0,0],[slideroptions.knobradius, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, slideroptions.knobradius], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)

			slideroptions.automaticallySetKnobRadius = slideroptions.automaticallySetKnobRadius || 'yes'

			if (slideroptions.automaticallySetKnobRadius == 'yes') {
				// Adjusted based on certain calculations at https://www.desmos.com/calculator/wocvdzcn1p 
				aRegress = -1.2979*Math.pow(10, -9);
				bRegress = -9.8036
				cRegress = -0.0337978
				fRegress = 10.1808

				strokeW = options.strokewidth
				if (strokeW < 25) {
					rx = ((aRegress*strokeW) + bRegress)*(Math.exp(cRegress*strokeW)) + fRegress
					ry = rx
				}
				else {
					rx = 0.2217*strokeW + 0.736503
					ry = rx
				}
			}

				
			
			var circleElement = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse');
			circleElement.setAttribute('cx', graphToScaledX(slideroptions.cx, gdata.xmin, gdata.xmax, aratio) + '%');
			circleElement.setAttribute('cy', graphToScaledY(slideroptions.cy, gdata.ymin, gdata.ymax, aratio) + '%');
			circleElement.setAttribute('rx', rx + '%')
			circleElement.setAttribute('ry', ry + '%');
			circleElement.setAttribute('id', graphname + '-slider-knob-' + slidername)
			uid = uid + 1
			circleElement.setAttribute('vector-effect','non-scaling-stroke');
			circleElement.style.fill = slideroptions.sliderknobcolor
			circleElement.style.strokeWidth = '0%';
			gdata.svgElement.appendChild(circleElement);

			graphData[graphname].sliderData[slidername] = [sliderbaseElement,sliderfillElement, circleElement, slideroptions]
			return [sliderbaseElement,sliderfillElement, circleElement, slideroptions]
		}

		sliderDivData = {}

		function addSliderToDiv(holderName, slidername, slideroptions) {
			slideroptions = slideroptions || {}

			slideroptions.classname = slideroptions.classname || 'standardSlider'

			var sliderinputElement = document.createElement("input");
			sliderinputElement.type = 'range';
			sliderinputElement.setAttribute('min', slideroptions.min);
			sliderinputElement.setAttribute('max', slideroptions.max);
			sliderinputElement.setAttribute('step', slideroptions.step);
			sliderinputElement.setAttribute('value', slideroptions.value);
			sliderinputElement.setAttribute('id', slidername);
			sliderinputElement.setAttribute('class', slideroptions.classname);
			sliderinputElement.setAttribute('oninput', slideroptions.eventFunction);

			holderDiv = document.getElementById(holderName)

			holderDiv.appendChild(sliderinputElement);

			sliderinputElement.style.width = slideroptions.w;
			sliderinputElement.style.height = slideroptions.h;
			sliderinputElement.style.backgroundColor = slideroptions.sliderbasecolor

			sliderDivData[slidername] = [holderDiv, slidername, slideroptions]
			return [slidername, holderDiv]
		}

		function divSlider(holder, divslidername, minval, maxval, currvalue, stepval, eventfunc, widthval, heightval, colorval) {
			options = {}
			options.min = minval
			options.max = maxval
			options.value = currvalue
			options.step = stepval
			options.eventFunction = eventfunc
			options.w = widthval
			options.h = heightval
			options.sliderbasecolor = colorval

			addSliderToDiv(holder, divslidername, options)
		}

		function addPath(graphname, pathname, pathoptions) {
			gdata = graphData[graphname]
			pathoptions = pathoptions || {}

			aratio = gdata.aspectratio

			pathoptions.points = pathoptions.points || [[0, 1], [1, 0]]

			pathstring = 'M'

			for (pth = 0; pth < pathoptions.points.length; pth++) {
				if (pth == 0) {
					pathstring = pathstring + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
				}
				else {
					pathstring = pathstring + 'L' + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
				}
				
			}

			

			pathoptions.name = pathname || uid
			// console.log((0).toString() || 0.5)

			pathoptions.strokewidth = pathoptions.strokewidth || 1
			pathoptions.pathcolor = pathoptions.pathcolor || 'hsla(190, 100%, 50%, 1)'

			var pathElement = document.createElementNS("http://www.w3.org/2000/svg", 'path');
			pathElement.setAttribute('d', pathstring);
			pathElement.setAttribute('id', graphname + '-path-' + pathname)
			uid = uid + 1
			pathElement.style.stroke = pathoptions.pathcolor
			pathElement.style.fill = 'none'
			pathElement.style.strokeWidth = pathoptions.strokewidth + '%';
			gdata.svgElement.appendChild(pathElement);

			graphData[graphname].pathData[pathname] = [pathElement, pathoptions]
			return [pathElement, pathoptions]
		}

		function updatePath(graphname, pathname, newpathoptions) {

			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			pathoptions = gdata.pathData[pathname][1]
			pathElement = gdata.pathData[pathname][0]

			pathoptions.points = newpathoptions.points || pathoptions.points

			pathstring = 'M'

			for (pth = 0; pth < pathoptions.points.length; pth++) {
				if (pth == 0) {
					pathstring = pathstring + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
				}
				else {
					pathstring = pathstring + 'L' + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
				}
				
			}

			pathElement.setAttribute('d', pathstring);

			pathoptions.strokewidth = newpathoptions.strokewidth || pathoptions.strokewidth
			pathoptions.pathcolor = newpathoptions.pathcolor || pathoptions.pathcolor

			pathElement.style.stroke = pathoptions.pathcolor
			pathElement.style.fill = 'none'
			pathElement.style.strokeWidth = pathoptions.strokewidth + '%';
			
			graphData[graphname].pathData[pathname] = [pathElement, pathoptions]
		}

		function updatePathPoints(graphname, pathname, npathpoints) {

			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			pathoptions = gdata.pathData[pathname][1]
			pathElement = gdata.pathData[pathname][0]

			pathoptions.points = npathpoints || pathoptions.points

			pathstring = 'M'

			for (pth = 0; pth < pathoptions.points.length; pth++) {
				if (pth == 0) {
					pathstring = pathstring + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
				}
				else {
					pathstring = pathstring + 'L' + graphToScaledX(pathoptions.points[pth][0], gdata.xmin, gdata.xmax, aratio) + ' ' + graphToScaledY(pathoptions.points[pth][1], gdata.ymin, gdata.ymax, aratio) + ' '
				}
				
			}

			pathElement.setAttribute('d', pathstring);
			
			graphData[graphname].pathData[pathname] = [pathElement, pathoptions]

			return [pathElement, pathoptions]
		}

		function updateLine(graphname, linename, linevalues) {

			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			lineoptions = gdata.lineData[linename][1]
			lineElement = gdata.lineData[linename][0]
			
			if (linevalues.x1 != 0) {
				lineoptions.x1 = linevalues.x1 || lineoptions.x1	
			}
			else {
				lineoptions.x1 = linevalues.x1
			}


			if (linevalues.y1 != 0) {
				lineoptions.y1 = linevalues.y1 || lineoptions.y1	
			}
			else {
				lineoptions.y1 = linevalues.y1
			}


			if (linevalues.x2 != 0) {
				lineoptions.x2 = linevalues.x2 || lineoptions.x2	
			}
			else {
				lineoptions.x2 = linevalues.x2
			}


			if (linevalues.y2 != 0) {
				lineoptions.y2 = linevalues.y2 || lineoptions.y2	
			}
			else {
				lineoptions.y2 = linevalues.y2
			}

			lineoptions.strokedasharray = linevalues.strokedasharray || lineoptions.strokedasharray
			lineoptions.strokewidth = linevalues.strokewidth || lineoptions.strokewidth
			lineoptions.linecolor = linevalues.linecolor || lineoptions.linecolor

			lineElement.setAttribute('x1', graphToScaledX(lineoptions.x1, gdata.xmin, gdata.xmax, aratio) + '%');
			lineElement.setAttribute('y1', graphToScaledY(lineoptions.y1, gdata.ymin, gdata.ymax, aratio) + '%');
			lineElement.setAttribute('x2', graphToScaledX(lineoptions.x2, gdata.xmin, gdata.xmax, aratio) + '%')
			lineElement.setAttribute('y2', graphToScaledY(lineoptions.y2, gdata.ymin, gdata.ymax, aratio) + '%');

			lineElement.setAttribute('stroke-dasharray', lineoptions.strokedasharray);
			lineElement.style.stroke = lineoptions.linecolor
			lineElement.style.strokeWidth = lineoptions.strokewidth + '%';
			
			graphData[graphname].lineData[linename] = [lineElement, lineoptions]
		}

		function distanceBTWgraphToSvg(p1, p2, xmin, xmax, ymin, ymax, aspectratio) {
			pt1 = [graphToScaledX(p1[0], xmin, xmax, aspectratio), graphToScaledY(p1[1], ymin, ymax, aspectratio)]
			pt2 = [graphToScaledX(p2[0], xmin, xmax, aspectratio), graphToScaledY(p2[1], ymin, ymax, aspectratio)]

			return Math.pow(Math.pow(pt1[0] - pt2[0], 2) + Math.pow(pt1[1] - pt2[1], 2), 0.5)
		}

		function addCircle(graphname, circlename, circleoptions) {
			gdata = graphData[graphname]
			circleoptions = circleoptions || {}
			aratio = gdata.aspectratio

			if (circleoptions.x != 0) {
				circleoptions.x = circleoptions.x || 0.3
			}
			else {
				circleoptions.x = 0
			}

			if (circleoptions.y != 0) {
				circleoptions.y = circleoptions.y || 0.3
			}
			else {
				circleoptions.y = 0
			}

			if (circleoptions.radius != 0) {
				circleoptions.radius = circleoptions.radius || 0.3
			}
			else {
				circleoptions.radius = 0
			}

			circleoptions.name = circlename || uid

			circleoptions.stroke = circleoptions.stroke || 'hsla(190, 100%, 50%, 0.5)'
			circleoptions.strokewidth = circleoptions.strokewidth || 0.1
			
			circleoptions.circlecolor = circleoptions.circlecolor || 'hsla(190, 100%, 50%, 1)'

			rx = distanceBTWgraphToSvg([0,0],[circleoptions.radius, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, circleoptions.radius], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			
			var circleElement = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse');
			circleElement.setAttribute('cx', graphToScaledX(circleoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			circleElement.setAttribute('cy', graphToScaledY(circleoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			circleElement.setAttribute('rx', rx + '%')
			circleElement.setAttribute('ry', ry + '%');
			circleElement.setAttribute('id', graphname + '-circle-' + circlename)
			uid = uid + 1
			circleElement.setAttribute('vector-effect','non-scaling-stroke');
			circleElement.style.fill = circleoptions.circlecolor
			circleElement.style.strokeWidth = circleoptions.strokewidth + '%';
			circleElement.style.stroke = circleoptions.stroke;
			circleElement.setAttribute('stroke-dasharray', circleoptions.strokedasharray);
			gdata.svgElement.appendChild(circleElement);

			graphData[graphname].circleData[circlename] = [circleElement, circleoptions]
			return [circleElement, circleoptions]
		}

		function updateCircle(graphname, circlename, circlenewvalues) {

			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			circleoptions = gdata.circleData[circlename][1]
			circleElement = gdata.circleData[circlename][0]


			if (circleoptions.x != 0) {
				circleoptions.x = circlenewvalues.x || circleoptions.x
			}
			else {
				circleoptions.x = 0
			}

			if (circleoptions.y != 0) {
				circleoptions.y = circlenewvalues.y || circleoptions.y
			}
			else {
				circleoptions.y = 0
			}

			if (circleoptions.radius != 0) {
				circleoptions.radius = circlenewvalues.radius || circleoptions.radius
			}
			else {
				circleoptions.radius = 0
			}

			circleoptions.name = circlename || uid

			circleoptions.stroke = circlenewvalues.stroke || circleoptions.stroke
			circleoptions.strokewidth = circlenewvalues.strokewidth || circleoptions.strokewidth
			
			circleoptions.circlecolor = circlenewvalues.circlecolor || circleoptions.circlecolor

			rx = distanceBTWgraphToSvg([0,0],[circleoptions.radius, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, circleoptions.radius], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			
			circleElement.setAttribute('cx', graphToScaledX(circleoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			circleElement.setAttribute('cy', graphToScaledY(circleoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			circleElement.setAttribute('rx', rx + '%')
			circleElement.setAttribute('ry', ry + '%');
			circleElement.setAttribute('id', graphname + '-circle-' + circlename)
			uid = uid + 1
			circleElement.setAttribute('vector-effect','non-scaling-stroke');
			circleElement.style.fill = circleoptions.circlecolor
			circleElement.style.strokeWidth = circleoptions.strokewidth + '%';
			circleElement.style.stroke = circleoptions.stroke;
			circleElement.setAttribute('stroke-dasharray', circleoptions.strokedasharray);
			
			graphData[graphname].circleData[circlename] = [circleElement, circleoptions]
		}

		function addEllipse(graphname, ellipsename, ellipseoptions) {
			gdata = graphData[graphname]

			aratio = gdata.aspectratio

			ellipseoptions = ellipseoptions || {}

			ellipseoptions.x = parseFloat(ellipseoptions.x.toString() || 0)
			ellipseoptions.y = parseFloat(ellipseoptions.y.toString() || 0)
			ellipseoptions.rx = parseFloat(ellipseoptions.rx.toString() || 0.3)
			ellipseoptions.ry = parseFloat(ellipseoptions.ry.toString() || 8)
			ellipseoptions.name = ellipsename || uid

			ellipseoptions.stroke = ellipseoptions.stroke || 'hsla(190, 100%, 50%, 0.5)'
			ellipseoptions.strokewidth = ellipseoptions.strokewidth || 0.1
			
			ellipseoptions.ellipsecolor = ellipseoptions.ellipsecolor || 'hsla(190, 100%, 50%, 1)'

			rx = distanceBTWgraphToSvg([0,0],[ellipseoptions.rx, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, ellipseoptions.ry], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			
			var ellipseElement = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse');
			ellipseElement.setAttribute('cx', graphToScaledX(ellipseoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			ellipseElement.setAttribute('cy', graphToScaledY(ellipseoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			ellipseElement.setAttribute('rx', rx + '%')
			ellipseElement.setAttribute('ry', ry + '%');
			ellipseElement.setAttribute('id', graphname + '-ellipse-' + ellipsename)
			uid = uid + 1
			ellipseElement.setAttribute('vector-effect','non-scaling-stroke');
			ellipseElement.style.fill = ellipseoptions.ellipsecolor
			ellipseElement.style.strokeWidth = ellipseoptions.strokewidth + '%';
			ellipseElement.style.stroke = ellipseoptions.stroke;
			gdata.svgElement.appendChild(ellipseElement);

			graphData[graphname].ellipseData[ellipsename] = [ellipseElement, ellipseoptions]
			return [ellipseElement, ellipseoptions]
		}

		function updateEllipse(graphname, ellipsename, ellipsenewvalues) {
			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			ellipseoptions = gdata.ellipseData[ellipsename][1]
			ellipseElement = gdata.ellipseData[ellipsename][0]

			if (ellipseoptions.x != 0) {
				ellipseoptions.x = ellipsenewvalues.x || ellipseoptions.x
			}
			else {
				ellipseoptions.x = 0
			}

			if (ellipseoptions.y != 0) {
				ellipseoptions.y = ellipsenewvalues.y || ellipseoptions.y
			}
			else {
				ellipseoptions.y = 0
			}

			if (ellipseoptions.rx != 0) {
				ellipseoptions.rx = ellipsenewvalues.rx || ellipseoptions.rx
			}
			else {
				ellipseoptions.rx = 0
			}
			if (ellipseoptions.ry != 0) {
				ellipseoptions.ry = ellipsenewvalues.ry || ellipseoptions.ry
			}
			else {
				ellipseoptions.ry = 0
			}

			ellipseoptions.name = ellipsename || uid

			ellipseoptions.stroke = ellipsenewvalues.stroke || ellipseoptions.stroke
			ellipseoptions.strokewidth = ellipsenewvalues.strokewidth || ellipseoptions.strokewidth
			
			ellipseoptions.ellipsecolor = ellipsenewvalues.ellipsecolor || ellipseoptions.ellipsecolor

			rx = distanceBTWgraphToSvg([0,0],[ellipseoptions.rx, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, ellipseoptions.ry], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			
			ellipseElement.setAttribute('cx', graphToScaledX(ellipseoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			ellipseElement.setAttribute('cy', graphToScaledY(ellipseoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			ellipseElement.setAttribute('rx', rx + '%')
			ellipseElement.setAttribute('ry', ry + '%');
			ellipseElement.setAttribute('id', graphname + '-ellipse-' + ellipsename)
			uid = uid + 1
			ellipseElement.setAttribute('vector-effect','non-scaling-stroke');
			ellipseElement.style.fill = ellipseoptions.ellipsecolor
			ellipseElement.style.strokeWidth = ellipseoptions.strokewidth + '%';
			ellipseElement.style.stroke = ellipseoptions.stroke;
			gdata.svgElement.appendChild(ellipseElement);

			graphData[graphname].ellipseData[ellipsename] = [ellipseElement, ellipseoptions]
		}

		function addText(graphname, textname, textoptions) {
			gdata = graphData[graphname]
			textoptions = textoptions || {}

			aratio = gdata.aspectratio

			textoptions.x = parseFloat(textoptions.x.toString() || 0)
			textoptions.y = parseFloat(textoptions.y.toString() || 0)
			textoptions.text = textoptions.text || ''
			textoptions.name = textname || uid

			textoptions.textAlign = textoptions.textAlign || 'left'
			textoptions.fontSize = textoptions.fontSize || 12
			
			textoptions.textcolor = textoptions.textcolor || 'hsla(190, 100%, 0%, 1)'
			
			var textElement = document.createElementNS("http://www.w3.org/2000/svg", 'text');
			textElement.setAttribute('x', graphToScaledX(textoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			textElement.setAttribute('y', graphToScaledY(textoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			textElement.setAttribute('id', graphname + '-text-' + textname)
			uid = uid + 1
			textElement.setAttribute('vector-effect','non-scaling-stroke');
			textElement.style.fill = textoptions.textcolor
			textElement.innerHTML = textoptions.text
			textElement.style.fontFamily = 'Source Sans Pro'
			textElement.style.fontSize = textoptions.fontSize;
			if (textoptions.textAlign == 'center') {
				textElement.setAttribute('text-anchor','middle')
			}
			gdata.svgElement.appendChild(textElement);

			graphData[graphname].textData[textname] = [textElement, textoptions]
			return [textElement, textoptions]
		}

		function updateText(graphname, textname, textvalues) {
			gdata = graphData[graphname]

			aratio = gdata.aspectratio

			textoptions = gdata.textData[textname][1]
			textElement = gdata.textData[textname][0]

			textoptions.text = textvalues.text || textoptions.text
			textoptions.x = textvalues.x || textoptions.x
			textoptions.y = textvalues.y || textoptions.y
			textoptions.textcolor = textvalues.textcolor || textoptions.textcolor

			textElement.innerHTML = textoptions.text
			textElement.setAttribute('x', graphToScaledX(textoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			textElement.setAttribute('y', graphToScaledY(textoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			textElement.style.fill = textoptions.textcolor
			
			graphData[graphname].textData[textname] = [textElement, textoptions]
			return [textElement, textoptions]
		}

		function addRectangle(graphname, rectname, rectoptions) {
			gdata = graphData[graphname]
			aratio = gdata.aspectratio
			rectoptions = rectoptions || {}

			rectoptions.x = parseFloat(rectoptions.x.toString() || 0)
			rectoptions.y = parseFloat(rectoptions.y.toString() || 0)
			rectoptions.w = parseFloat(rectoptions.w.toString() || 1)
			rectoptions.h = parseFloat(rectoptions.h.toString() || 1)
			rectoptions.name = rectname || uid

			rectoptions.stroke = rectoptions.stroke || 'hsla(190, 100%, 50%, 0.5)'
			rectoptions.strokewidth = rectoptions.strokewidth || 0.1
			rectoptions.strokedasharray = rectoptions.strokedasharray || ""

			
			rectoptions.rectcolor = rectoptions.rectcolor || 'hsla(190, 100%, 50%, 1)'

			rx = distanceBTWgraphToSvg([0,0],[rectoptions.w, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, rectoptions.h], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			
			var rectElement = document.createElementNS("http://www.w3.org/2000/svg", 'rect');
			rectElement.setAttribute('x', graphToScaledX(rectoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			rectElement.setAttribute('y', graphToScaledY(rectoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			rectElement.setAttribute('width', rx + '%')
			rectElement.setAttribute('height', ry + '%');
			rectElement.setAttribute('id', graphname + '-rect-' + rectname)
			uid = uid + 1
			rectElement.setAttribute('vector-effect','non-scaling-stroke');
			rectElement.style.fill = rectoptions.rectcolor
			rectElement.style.strokeWidth = rectoptions.strokewidth + '%';
			rectElement.style.stroke = rectoptions.stroke;
			rectElement.setAttribute('stroke-dasharray', rectoptions.strokedasharray);

			gdata.svgElement.appendChild(rectElement);

			graphData[graphname].rectData[rectname] = [rectElement, rectoptions]

			return [rectElement, rectoptions]
		}

		function updateRectangle(graphname, rectname, rectvalueupdate) {
			gdata = graphData[graphname]
			rectoptions = gdata.rectData[rectname][1]
			rectElement = gdata.rectData[rectname][0]
			aratio = gdata.aspectratio

			if (rectvalueupdate.x != 0) {
				rectoptions.x = rectvalueupdate.x || rectoptions.x	
			}
			else {
				rectoptions.x = rectvalueupdate.x
			}


			if (rectvalueupdate.y != 0) {
				rectoptions.y = rectvalueupdate.y || rectoptions.y	
			}
			else {
				rectoptions.y = rectvalueupdate.y
			}


			if (rectvalueupdate.w != 0) {
				rectoptions.w = rectvalueupdate.w || rectoptions.w	
			}
			else {
				rectoptions.w = rectvalueupdate.w
			}


			if (rectvalueupdate.h != 0) {
				rectoptions.h = rectvalueupdate.h || rectoptions.h	
			}
			else {
				rectoptions.h = rectvalueupdate.h
			}
			
			rectoptions.stroke = rectvalueupdate.stroke || rectoptions.stroke
			rectoptions.strokewidth = rectvalueupdate.strokewidth || rectoptions.strokewidth
			
			rectoptions.rectcolor = rectvalueupdate.rectcolor || rectoptions.rectcolor

			rx = distanceBTWgraphToSvg([0,0],[rectoptions.w, 0], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			ry = distanceBTWgraphToSvg([0,0],[0, rectoptions.h], gdata.xmin, gdata.xmax, gdata.ymin, gdata.ymax, aratio)
			
			rectElement.setAttribute('x', graphToScaledX(rectoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			rectElement.setAttribute('y', graphToScaledY(rectoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			rectElement.setAttribute('width', rx + '%')
			rectElement.setAttribute('height', ry + '%');
			rectElement.style.fill = rectoptions.rectcolor
			rectElement.style.strokeWidth = rectoptions.strokewidth + '%';
			rectElement.style.stroke = rectoptions.stroke;

			
			graphData[graphname].rectData[rectname] = [rectElement, rectoptions]
		}

		function addPoint(graphname, pointname, pointoptions) {
			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			pointoptions = pointoptions || {}

			if (pointoptions.x != 0) {
				pointoptions.x = pointoptions.x || 0.3	
			}
			if (pointoptions.y != 0) {
				pointoptions.y = pointoptions.y || 0.3	
			}
			// pointoptions.y = pointoptions.y || 0.3
			pointoptions.pointsize = pointoptions.pointsize || 0.7
			pointoptions.name = pointname || uid

			pointoptions.pointcolor = pointoptions.pointcolor || 'hsla(190, 100%, 50%, 1)'
			
			var pointElement = document.createElementNS("http://www.w3.org/2000/svg", 'ellipse');
			pointElement.setAttribute('cx', graphToScaledX(pointoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			pointElement.setAttribute('cy', graphToScaledY(pointoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			pointElement.setAttribute('rx', pointoptions.pointsize + '%')
			pointElement.setAttribute('ry', pointoptions.pointsize + '%');
			pointElement.setAttribute('id', graphname + '-point-' + pointname)
			uid = uid + 1
			pointElement.setAttribute('vector-effect','non-scaling-stroke');
			pointElement.style.fill = pointoptions.pointcolor
			gdata.svgElement.appendChild(pointElement);

			pointoptions.draggability = pointoptions.draggability || 'no'
			if (pointoptions.draggability == 'yes') {
				pointoptions.currentlyDraggable = pointoptions.currentlyDraggable || 'yes'
			}
			else {
				pointoptions.currentlyDraggable = pointoptions.currentlyDraggable || 'no'
			}
			pointoptions.runFunctionOnDragEnd = pointoptions.runFunctionOnDragEnd || ''
			pointoptions.runFunctionDuringDrag = pointoptions.runFunctionDuringDrag || ''

			if (pointoptions.draggability == 'yes') {
				pointElement.addEventListener('mousedown', pointDrag)
				pointElement.addEventListener('touchstart', pointDrag)
				gdata.svgElement.addEventListener('touchmove', graphTouchDisable)
			}
			else {
				pointElement.style.pointerEvents = 'none'
			}

			pointoptions.dragDirection = pointoptions.dragDirection || 'bothXY'
			pointoptions.dragIfCondition = pointoptions.dragIfCondition || 'true'

			graphData[graphname].pointData[pointname] = [pointElement, pointoptions]
			reverseGraphElementMap[pointElement.id] = [graphname, pointname]
			return [pointElement, pointoptions]
		}

		function updatePoint(graphname, pointname, newpointoptions) {
			gdata = graphData[graphname]
			pointoptions = gdata.pointData[pointname][1]
			pointElement = gdata.pointData[pointname][0]
			aratio = gdata.aspectratio

			if (pointoptions.x != 0) {
				pointoptions.x = newpointoptions.x || pointoptions.x
			}
			if (pointoptions.y != 0) {
				pointoptions.y = newpointoptions.x || pointoptions.y
			}
			// pointoptions.y = pointoptions.y || 0.3
			pointoptions.pointsize = newpointoptions.pointsize || pointoptions.pointsize
			pointoptions.name = pointname || uid

			pointoptions.pointcolor = newpointoptions.pointcolor || pointoptions.pointcolor
			
			pointElement.setAttribute('cx', graphToScaledX(pointoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			pointElement.setAttribute('cy', graphToScaledY(pointoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');
			pointElement.setAttribute('rx', pointoptions.pointsize + '%')
			pointElement.setAttribute('ry', pointoptions.pointsize + '%');
			pointElement.setAttribute('id', graphname + '-point-' + pointname)
			uid = uid + 1
			pointElement.setAttribute('vector-effect','non-scaling-stroke');
			pointElement.style.fill = pointoptions.pointcolor
			gdata.svgElement.appendChild(pointElement);

			pointoptions.draggability = newpointoptions.draggability || 'no'
			if (pointoptions.draggability == 'yes') {
				pointoptions.currentlyDraggable = newpointoptions.currentlyDraggable || 'yes'
			}
			else {
				pointoptions.currentlyDraggable = newpointoptions.currentlyDraggable || 'no'
			}
			pointoptions.runFunctionOnDragEnd = newpointoptions.runFunctionOnDragEnd || ''
			pointoptions.runFunctionDuringDrag = newpointoptions.runFunctionDuringDrag || ''
			pointoptions.dragDirection = newpointoptions.dragDirection || 'bothXY'
			pointoptions.dragIfCondition = newpointoptions.dragIfCondition || ''

			if (pointoptions.draggability == 'yes') {
				pointElement.addEventListener('mousedown', pointDrag)
				pointElement.addEventListener('touchstart', pointDrag)
			}
			else {
				pointElement.removeEventListener('mousedown', pointDrag)
				pointElement.removeEventListener('touchstart', pointDrag)
			}

			graphData[graphname].pointData[pointname] = [pointElement, pointoptions]

		}

		function updatePointXY(graphname, pointname, xvalue, yvalue) {
			pointElement = document.getElementById(graphname + '-point-' + pointname)
			gdata = graphData[graphname]
			aratio = gdata.aspectratio

			pointoptions = graphData[graphname].pointData[pointname][1]

			pointoptions.x = xvalue
			pointoptions.y = yvalue
			
			
			pointElement.setAttribute('cx', graphToScaledX(pointoptions.x, gdata.xmin, gdata.xmax, aratio) + '%');
			pointElement.setAttribute('cy', graphToScaledY(pointoptions.y, gdata.ymin, gdata.ymax, aratio) + '%');

			graphData[graphname].pointData[pointname] = [pointElement, pointoptions]
		}

		function removePoint(graphname, pointname) {
			pointElement = document.getElementById(graphname + '-point-' + pointname)
			
			pointElement.outerHTML = "";
			delete graphData[graphname].pointData[pointname]
		}

		function removeLine(graphname, linename) {
			lineElement = document.getElementById(graphname + '-line-' + linename)
			lineElement.outerHTML = "";
			delete graphData[graphname].lineData[linename]
		}

		function removePath(graphname, pathname) {
			pathElement = document.getElementById(graphname + '-path-' + pathname)
			pathElement.outerHTML = "";
			delete graphData[graphname].pathData[pathname]
		}

		function removeGraph(graphname) {
			graphElement = document.getElementById(graphname)
			graphElement.outerHTML = "";
			delete graphData[graphname]
		}

		function basicSlider(graphname2, slidernamebasic, maxv, minv, currentv, thickness, coordinates) {
			options = {}
			options.maxvalue = maxv
			options.minvalue = minv
			options.currentvalue = currentv
			options.x1 = coordinates[0][0]
			options.y1 = coordinates[0][1]
			options.x2 = coordinates[1][0]
			options.y2 = coordinates[1][1]
			options.strokewidth = thickness
			options.automaticallySetKnobRadius = 'yes'
			addSlider(graphname2, slidernamebasic, options)
		}

		function makeArc(arcradius, arcthickness, arccolor, startanglepercent, endanglepercent, ringname) {
			resolution = 100
			arcpoints = []
			for (p = startanglepercent*resolution; p < endanglepercent*(resolution + 1); p++) {
				quanta = 2*Math.PI/resolution
				arcpoints.push([arcradius*Math.cos(quanta*p), arcradius*Math.sin(quanta*p)])
			}
			options = {}
			options.points = arcpoints
			options.pathcolor = arccolor
			options.strokewidth = arcthickness
			addPath('ringvisualgraph', ringname, options)
			// console.log(options.points)

			return arcpoints
		}

		function makeArcS(ringarcnum, arcradius, arcthickness, arccolor, startanglepercent, endanglepercent, ringname) {
			resolution = 20
			arcpoints = []
			for (p = startanglepercent*resolution; p < endanglepercent*(resolution + 1); p++) {
				quanta = 2*Math.PI/resolution
				arcpoints.push([arcradius*Math.cos(quanta*p), arcradius*Math.sin(quanta*p)])
			}
			options = {}
			options.points = arcpoints
			options.pathcolor = arccolor
			options.strokewidth = arcthickness
			addPath('ringvisualgraph', ringname, options)
			// console.log(options.points)
		}

		function deleteSegments(collection) {
			if (typeof collection != 'undefined') {
				for (f = 0; f < collection.length; f++) {
					collection[f].outerHTML = ''
				}
			}
		}

		function randomChoice(choicearray) {
			return choicearray[parseInt(Math.random()*choicearray.length)]
		}

		function linearValue(xv1, xv2, yv1, yv2, inputvl) {
			return yv1 + ((inputvl - xv1)/(xv2 - xv1))*(yv2 - yv1)
		}

		currentMovingPoint = ''
		function pointDrag(event) {
			gphname = reverseGraphElementMap[event.target.id][0]
			ptname = reverseGraphElementMap[event.target.id][1]
			if (graphData[gphname].pointData[ptname][1].currentlyDraggable == 'yes') {
				if (graphData[gphname].currentlyDraggableGraph == 'yes') {
					document.getElementById(gphname).removeEventListener('mousedown', graphDragHandle)
					document.getElementById(gphname).removeEventListener('touchstart', graphDragHandle)
				}
				event.target.removeEventListener('mousedown', pointDrag)
				event.target.removeEventListener('touchstart', pointDrag)
				window.addEventListener('mousemove', pointMoveEvent)
				window.addEventListener('mouseup', pointUpEvent)
				event.preventDefault()
				window.addEventListener('touchmove', pointMoveEvent, { passive: false })
				window.addEventListener('touchend', pointUpEvent)
				// window.addEventListener('mouseout', pointUpEvent)
				currentMovingPoint = event.target
			}
				
		}

		svgPTVariable = {}
		
		function pointMoveEvent(event) {
			event.preventDefault()
			gphname = reverseGraphElementMap[currentMovingPoint.id][0]
			ptname = reverseGraphElementMap[currentMovingPoint.id][1]
			var rect = document.getElementById(gphname).getBoundingClientRect();
			posx = event.clientX - rect.left;
			posy = event.clientY - rect.top;
			svgPTVariable[gphname].x = event.clientX;
			svgPTVariable[gphname].y = event.clientY;

			if (event.clientX == undefined) {
				posx = event.changedTouches[0].clientX - rect.left;
				posy = event.changedTouches[0].clientY - rect.top;
				svgPTVariable[gphname].x = event.changedTouches[0].clientX;
				svgPTVariable[gphname].y = event.changedTouches[0].clientY;
			}

			var cursorpt =  svgPTVariable[gphname].matrixTransform(document.getElementById(gphname).getScreenCTM().inverse());

			moveX = svgToGraphX(cursorpt.x, graphData[gphname].xmin,graphData[gphname].xmax, graphData[gphname].aspectratio)
			moveY = svgToGraphY(cursorpt.y, graphData[gphname].ymin,graphData[gphname].ymax, graphData[gphname].aspectratio)

			if (typeof eval(graphData[gphname].pointData[ptname][1].dragIfCondition) != undefined) {
				if (eval(graphData[gphname].pointData[ptname][1].dragIfCondition) == true) {
					if (graphData[gphname].pointData[ptname][1].dragDirection == 'bothXY') {
						updatePointXY(gphname, ptname, moveX, moveY)
						eval(graphData[gphname].pointData[ptname][1].runFunctionDuringDrag)
					}
					else if (graphData[gphname].pointData[ptname][1].dragDirection == 'onlyY') {
						updatePointXY(gphname, ptname, graphData[gphname].pointData[ptname][1].x, moveY)
						eval(graphData[gphname].pointData[ptname][1].runFunctionDuringDrag)
					}
					else if (graphData[gphname].pointData[ptname][1].dragDirection == 'onlyX') {
						updatePointXY(gphname, ptname, moveX, graphData[gphname].pointData[ptname][1].y)
						eval(graphData[gphname].pointData[ptname][1].runFunctionDuringDrag)
					}
				}
			}
		}

		function pointUpEvent(event) {
			gphname = reverseGraphElementMap[currentMovingPoint.id][0]
			ptname = reverseGraphElementMap[currentMovingPoint.id][1]
			if (graphData[gphname].currentlyDraggableGraph == 'yes') {
				document.getElementById(gphname).addEventListener('mousedown', graphDragHandle)
				document.getElementById(gphname).addEventListener('touchstart', graphDragHandle)
			}
			currentMovingPoint.addEventListener('mousedown', pointDrag)
			currentMovingPoint.addEventListener('touchstart', pointDrag)
			window.removeEventListener('mousemove', pointMoveEvent)
			window.removeEventListener('mouseup', pointUpEvent)
			window.removeEventListener('touchmove', pointMoveEvent)
			window.removeEventListener('touchend', pointUpEvent)

			// window.removeEventListener('mouseout', pointUpEvent)
			eval(graphData[gphname].pointData[ptname][1].runFunctionOnDragEnd)
		}

		function wheelHandle(event) {
			event.preventDefault();
			whlvalue = (event.wheelDeltaY)/Math.abs(event.wheelDeltaY)
			if (event.wheelDeltaY == undefined) {
				whlvalue = (event.deltaY)/Math.abs(event.deltaY)
				// For FireFox
			}
			scalefactorup = 1.1
			scalefactordown = 0.9

			if(graphData[event.target.id.split('-')[0]] == undefined) {

			}
			else {
				gdata = graphData[event.target.id.split('-')[0]]

				scale = gdata.ymax - gdata.ymin
				expstring = scale.toExponential().toString()
				ordery = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
				// console.log(ordery)

				scale = gdata.xmax - gdata.xmin
				expstring = scale.toExponential().toString()
				orderx = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
				// console.log(orderx)

				gphname = gdata.name

				var rect = document.getElementById(gphname).getBoundingClientRect();
				posx = event.clientX - rect.left;
				posy = event.clientY - rect.top;
				svgPTVariable[gphname].x = event.clientX;
				svgPTVariable[gphname].y = event.clientY;

				if (event.clientX == undefined) {
					posx = event.changedTouches[0].clientX - rect.left;
					posy = event.changedTouches[0].clientY - rect.top;
					svgPTVariable[gphname].x = event.changedTouches[0].clientX;
					svgPTVariable[gphname].y = event.changedTouches[0].clientY;
				}

				var cursorpt =  svgPTVariable[gphname].matrixTransform(document.getElementById(gphname).getScreenCTM().inverse());

				zoomlocationX = svgToGraphX(cursorpt.x, graphData[gphname].xmin,graphData[gphname].xmax, graphData[gphname].aspectratio)
				zoomlocationY = svgToGraphY(cursorpt.y, graphData[gphname].ymin,graphData[gphname].ymax, graphData[gphname].aspectratio)

				currentvalues = graphData[gphname]

				posx = posx/rect.width
				posy = posy/rect.height

				if (posx > 0.11 && posx < 0.89 && posy > 0.11 && posy < 0.89) {
					if (whlvalue < 0) {
						scaleupdownFactor = scalefactorup
						leftX = (zoomlocationX - currentvalues.xmin)*scaleupdownFactor
						newZXmin = zoomlocationX - leftX
						rightX = (currentvalues.xmax - zoomlocationX)*scaleupdownFactor
						newZXmax = zoomlocationX + rightX
						leftY = (zoomlocationY - currentvalues.ymin)*scaleupdownFactor
						newZYmin = zoomlocationY - leftY
						rightY = (currentvalues.ymax - zoomlocationY)*scaleupdownFactor
						newZYmax = zoomlocationY + rightY

						options = {}
						options.xmin = newZXmin
						options.xmax = newZXmax
						options.ymin = newZYmin
						options.ymax = newZYmax
						
						updateGraphZoom(gphname, options)
					}
					else if (whlvalue >= 0 && orderx < 14 && ordery < 14) {

						scaleupdownFactor = scalefactordown
						leftX = (zoomlocationX - currentvalues.xmin)*scaleupdownFactor
						newZXmin = zoomlocationX - leftX
						rightX = (currentvalues.xmax - zoomlocationX)*scaleupdownFactor
						newZXmax = zoomlocationX + rightX
						leftY = (zoomlocationY - currentvalues.ymin)*scaleupdownFactor
						newZYmin = zoomlocationY - leftY
						rightY = (currentvalues.ymax - zoomlocationY)*scaleupdownFactor
						newZYmax = zoomlocationY + rightY

						options = {}
						options.xmin = newZXmin
						options.xmax = newZXmax
						options.ymin = newZYmin
						options.ymax = newZYmax
						updateGraphZoom(gphname, options)
					}
				}

					
			}
		}

		currentMovingGraph = ''
		currentMovingGraphStartLocation = []
		
		function graphDragHandle(event) {
			event.preventDefault();
			gphname = event.target.id.split('-')[0]
			if (graphData[gphname].currentlyDraggableGraph == 'yes') {
				graphData[gphname].svgElement.removeEventListener('mousedown', graphDragHandle)
				graphData[gphname].svgElement.removeEventListener('touchstart', graphDragHandle)
				window.addEventListener('mousemove', graphDragMoveEvent)
				window.addEventListener('mouseup', graphDragUpEvent)
				event.preventDefault()
				window.addEventListener('touchmove', graphDragMoveEvent, { passive: false })
				window.addEventListener('touchend', graphDragUpEvent)
				// window.addEventListener('mouseout', pointUpEvent)
				currentMovingGraph = graphData[gphname].svgElement

				var rect = document.getElementById(gphname).getBoundingClientRect();
				posx = event.clientX - rect.left;
				posy = event.clientY - rect.top;
				svgPTVariable[gphname].x = event.clientX;
				svgPTVariable[gphname].y = event.clientY;

				if (event.clientX == undefined) {
					posx = event.changedTouches[0].clientX - rect.left;
					posy = event.changedTouches[0].clientY - rect.top;
					svgPTVariable[gphname].x = event.changedTouches[0].clientX;
					svgPTVariable[gphname].y = event.changedTouches[0].clientY;

				}

				var cursorpt =  svgPTVariable[gphname].matrixTransform(document.getElementById(gphname).getScreenCTM().inverse());

				tapX = svgToGraphX(cursorpt.x, graphData[gphname].xmin,graphData[gphname].xmax, graphData[gphname].aspectratio)
				tapY = svgToGraphY(cursorpt.y, graphData[gphname].ymin,graphData[gphname].ymax, graphData[gphname].aspectratio)

				currentMovingGraphStartLocation = [tapX, tapY]
				currentMovingGraphOriginalBounds = [graphData[gphname].xmin, graphData[gphname].xmax, graphData[gphname].ymin, graphData[gphname].ymax]

				currentMovingGraph.style.cursor = 'move'

			}
		}

		function clientToGraph(clientValues, graphNameInput) {
			svgPTVariable[graphNameInput].x = clientValues[0];
			svgPTVariable[graphNameInput].y = clientValues[1];

			var cursorpt =  svgPTVariable[gphname].matrixTransform(document.getElementById(gphname).getScreenCTM().inverse());

			return [svgToGraphX(cursorpt.x, graphData[gphname].xmin,graphData[gphname].xmax, graphData[gphname].aspectratio), svgToGraphY(cursorpt.y, graphData[gphname].ymin,graphData[gphname].ymax, graphData[gphname].aspectratio)]

		}

		function graphPinchMoveEvent(event) {
			if (event.changedTouches.length == 2) {
				gphname = event.target.id.split('-')[0]
				touch1 = [event.changedTouches[0].clientX, event.changedTouches[0].clientY]
				touch2 = [event.changedTouches[1].clientX, event.changedTouches[1].clientY]

				touch1 = clientToGraph(touch1, gphname)
				touch2 = clientToGraph(touch2, gphname)

				oldtouch1 = clientToGraph(pinchStartData[0], gphname)
				oldtouch2 = clientToGraph(pinchStartData[1], gphname)

				pinchScale = distF(oldtouch1, oldtouch2)/distF(touch1, touch2)
				pinchStartMidpoint = [(oldtouch1[0] + oldtouch2[0])/2, (oldtouch1[1] + oldtouch2[1])/2]

				zoomlocationX = pinchStartMidpoint[0]
				zoomlocationY = pinchStartMidpoint[1]

				gdata = graphData[gphname]

				scale = gdata.ymax - gdata.ymin
				expstring = scale.toExponential().toString()
				ordery = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
				// console.log(ordery)

				scale = gdata.xmax - gdata.xmin
				expstring = scale.toExponential().toString()
				orderx = (expstring.slice(expstring.indexOf('e') + 1)*(-1))
				// console.log(orderx)

				currentvalues = graphData[gphname]

				scaleFactorForTouch = 1
				if (pinchScale <= 1) {
					scaleFactorForTouch = linearValue(0, 1, 0.9, 1, pinchScale)
				}
				else {
					scaleFactorForTouch = linearValue(1, 5, 1, 1.1, pinchScale)
				}

				leftX = (zoomlocationX - currentvalues.xmin)*scaleFactorForTouch
				newZXmin = zoomlocationX - leftX
				rightX = (currentvalues.xmax - zoomlocationX)*scaleFactorForTouch
				newZXmax = zoomlocationX + rightX
				leftY = (zoomlocationY - currentvalues.ymin)*scaleFactorForTouch
				newZYmin = zoomlocationY - leftY
				rightY = (currentvalues.ymax - zoomlocationY)*scaleFactorForTouch
				newZYmax = zoomlocationY + rightY

				options = {}
				options.xmin = newZXmin
				options.xmax = newZXmax
				options.ymin = newZYmin
				options.ymax = newZYmax
				
				updateGraphZoom(gphname, options)
				
				// console.log(pinchStartMidpoint)
			}
		}

		function graphPinchEndEvent(event) {
			pinchZoom = false
			window.removeEventListener('touchmove', graphPinchMoveEvent)
			window.removeEventListener('touchend', graphPinchEndEvent)
		}

		pinchZoom = false
		pinchStartData = []

		function graphDragMoveEvent(event) {
			event.preventDefault()
			gphname = currentMovingGraph.id
			var rect = document.getElementById(gphname).getBoundingClientRect();
			posx = event.clientX - rect.left;
			posy = event.clientY - rect.top;
			svgPTVariable[gphname].x = event.clientX;
			svgPTVariable[gphname].y = event.clientY;

			touchEventDetect = 0

			if (event.clientX == undefined) {
				posx = event.changedTouches[0].clientX - rect.left;
				posy = event.changedTouches[0].clientY - rect.top;
				svgPTVariable[gphname].x = event.changedTouches[0].clientX;
				svgPTVariable[gphname].y = event.changedTouches[0].clientY;
				
				if (event.changedTouches.length == 2) {
					oldtouch1 = [event.changedTouches[0].clientX, event.changedTouches[0].clientY]
					oldtouch2 = [event.changedTouches[1].clientX, event.changedTouches[1].clientY]
					pinchStartData = [oldtouch1, oldtouch2]
					dummyEve = {}
					pinchZoom = true
					graphDragUpEvent(dummyEve)
					window.addEventListener('touchmove', graphPinchMoveEvent)
					window.addEventListener('touchend', graphPinchEndEvent)
				}

				touchEventDetect = event.changedTouches[0].identifier
				
			}

			if (pinchZoom == false && touchEventDetect == 0) {
				var cursorpt =  svgPTVariable[gphname].matrixTransform(document.getElementById(gphname).getScreenCTM().inverse());

				moveX = svgToGraphX(cursorpt.x, graphData[gphname].xmin,graphData[gphname].xmax, graphData[gphname].aspectratio)
				moveY = svgToGraphY(cursorpt.y, graphData[gphname].ymin,graphData[gphname].ymax, graphData[gphname].aspectratio)

				deltaVecX = moveX - currentMovingGraphStartLocation[0]
				deltaVecY = moveY - currentMovingGraphStartLocation[1]
				currentvalues = graphData[gphname]

				newZXmin = currentvalues.xmin - deltaVecX
				newZXmax =currentvalues.xmax - deltaVecX
				newZYmin = currentvalues.ymin - deltaVecY
				newZYmax = currentvalues.ymax - deltaVecY
				
				if (typeof eval(graphData[gphname].dragIfCondition) != undefined) {
					if (eval(graphData[gphname].dragIfCondition) == true) {
						if (graphData[gphname].dragDirection == 'bothXY') {
							options = {}
							options.xmin = newZXmin
							options.xmax = newZXmax
							options.ymin = newZYmin
							options.ymax = newZYmax
							updateGraphZoom(gphname, options)
							eval(graphData[gphname].runFunctionDuringDrag)
						}
						else if (graphData[gphname].dragDirection == 'onlyY') {
							options = {}
							options.ymin = newZYmin
							options.ymax = newZYmax
							updateGraphZoom(gphname, options)
							eval(graphData[gphname].runFunctionDuringDrag)
						}
						else if (graphData[gphname].dragDirection == 'onlyX') {
							options = {}
							options.xmin = newZXmin
							options.xmax = newZXmax
							updateGraphZoom(gphname, options)
							eval(graphData[gphname].runFunctionDuringDrag)
						}
					}
				}
			}

				
		}

		function graphDragUpEvent(event) {
			gphname = currentMovingGraph.id

			currentMovingGraph.addEventListener('mousedown', graphDragHandle)
			currentMovingGraph.addEventListener('touchstart', graphDragHandle)
			window.removeEventListener('mousemove', graphDragMoveEvent)
			window.removeEventListener('mouseup', graphDragUpEvent)
			window.removeEventListener('touchmove', graphDragMoveEvent)
			window.removeEventListener('touchend', graphDragUpEvent)

			// window.removeEventListener('mouseout', pointUpEvent)
			eval(graphData[gphname].runFunctionOnDragEnd)

			currentMovingGraph.style.cursor = 'auto'
		}

		function graphTouchDisable(event) {
			event.preventDefault()
		}


		dmode = 'square'
		if (1.25*window.innerWidth < window.innerHeight && window.innerWidth < window.innerHeight) {
			dmode = 'portrait'
		}
		else if (window.innerWidth > 1.3*window.innerHeight && window.innerWidth > window.innerHeight) {
			dmode = 'landscape'
		}

		function setFont(divCollection, fontval) {
			for (divN = 0; divN < divCollection.length; divN++) {
				document.getElementById(divCollection[divN]).style.fontSize = fontval
			}
		}

		function handleLayout() {
			if (dmode == 'portrait') {
				document.getElementById('containAll').style.position = 'relative'
				// document.getElementById('containAll').style.overflow = 'scroll'
				// document.body.style.overflow = 'hidden'
				document.getElementById('containAll').style.height = '55%'
				document.getElementById('containAll').style.position = 'fixed'
				document.getElementById('containAll').style.zIndex = '300'

				document.getElementById('space1Div').style.height = '55%'
				document.getElementById('space2Div').style.height = '8%'
				document.getElementById('space2Div').style.position = 'fixed'
				document.getElementById('space2Div').style.zIndex = '200'
				document.getElementById('space2Div').style.pointerEvents = 'auto'
				document.getElementById('space2Div').style.background = 'hsla(0, 0%, 92%, 1)';
				document.getElementById('space3Div').style.height = '8%'
				// document.getElementById('space3Div').style.overflow = 'hidden'

				document.getElementById('space4Div').style.height = '39%'

				$("<div id='gradFillOverMenu' style='margin:0px;width:100%; height: 100%; z-index: 20; display: inline-block; position: fixed; pointer-events: none; background: linear-gradient(to bottom, hsla(0, 0%, 92%, 1) 0%, hsla(0, 100%, 100%, 0) 3%);'></div>").insertBefore("#space4Div")

				document.getElementById('space5Div').style.height = '0%'

				document.getElementById('scroller').style.width = '0%'
				document.getElementById('noscroller').style.width = '100%'

				document.getElementById('middlepanel').style.fontSize = '0'
				document.getElementById('menupanel').style.fontSize = '0'

				// $('#menupanel').insertBefore('#boundaryoptionspanel')
				$("#menuDisplayPanel").appendTo("#space2Div");
				$("#optionsDisplayPanel").appendTo("#space4Div");

				document.getElementById('menuDisplayPanel').style.height = '100%'
				document.getElementById('optionsDisplayPanel').style.height = '200%'
				document.getElementById('optionsDisplayPanel').style.overflowY = 'hidden'
				document.getElementById('middlepanel').style.width = '0%'
				document.getElementById('verticalspacerA').style.width = '0%'
				document.getElementById('verticalspacerB').style.width = '0%'

				document.getElementById('spacerD13').style.height = '55%'
				

				// $('<br/>').insertBefore('#boundaryoptionspanel')

				
				// document.getElementById('middlepanel').style.height = '155%'

				// document.getElementById('space2Div').style.overflow = 'scroll'


				// $('#interactionAndTitle').insertBefore('#middlepanel')
				
				// $('#algooptionspanel').insertAfter('#menupanel')
				// $('#interactionAndTitle').insertBefore('#middlepanel')
				// $('#middlepanel').insertBefore('#containAll')
				// $('#containAll').insertBefore('#middlepanel')


				document.getElementById('interactionAndTitle').style.height = '100%'
				document.getElementById('interactionAndTitle').style.width = '100%'
				// document.getElementById('interactionAndTitle').style.position = 'fixed'

				document.getElementById('maintitle').innerHTML = 'N <font style="color: var(--themeblue);">Charges</font> inside a <font style="color: var(--themeorange);">boundary</font> <br/><font style="font-size: 1.6vmax; font-family: Nunito; font-weight: normal; color: hsla(190, 0%, 30%, 1);">Finding Minimum Energy Configurations </font><br/><font style="font-size: 1.3vmax; font-weight: normal; font-family: Nunito; color: hsla(260, 100%, 30%, 1);">Vinton Adrian Rebello, Manas Shetty and Prajwal DSouza </font><br/><font style="font-size: 1.3vmax;">inspired by the <a href="https://iopscience.iop.org/article/10.1088/0305-4470/31/3/014/meta" style="text-decoration: none;" target="_blank"><font style="color: hsla(190, 40%, 40%, 1);">work</font></a> of Kari J Nurmela</font>'

				document.getElementById('maintitle').style.fontSize = '2.7vmax'

				document.getElementById('titleH').style.height = '25%'
				document.getElementById('simulationDetailAndButtonsH').style.height = '75%'
				document.getElementById('labH').style.height = '75%'

				document.getElementById('energyinfo').style.fontSize = '1.2vmax'

				document.getElementById('simulationDetailAndButtonsH').style.boxShadow = 'inset 0px 0px 30px 30px hsla(32, 100%,100%, 1)'

				document.getElementById('spacerSD5').style.width = '80%'
				document.getElementById('saveButtonH').style.width = '16%'
				document.getElementById('savebutton').style.fontSize = '1.2vmax'
				document.getElementById('spacerSD7').style.width = '80%'
				document.getElementById('loadButtonH').style.width = '16%'
				document.getElementById('loadbutton').style.fontSize = '1.2vmax'
				document.getElementById('spacerSD9').style.width = '80%'
				document.getElementById('homeButtonH').style.width = '16%'
				document.getElementById('homebutton').style.fontSize = '1.2vmax'

				document.getElementById('simulationDetailAndButtonsH').style.borderRadius = '20px 20px 20px 20px'
				document.getElementById('labH').style.borderRadius = '20px 20px 20px 20px'
				document.getElementById('simulationDetailAndButtonsH').style.left = '4%'
				document.getElementById('labH').style.left = '4%'
				document.getElementById('simulationDetailAndButtonsH').style.width = '92%'
				document.getElementById('labH').style.width = '92%'


				// document.getElementById('labpanel').style.width = '82%'

				// document.getElementById('middlepanel').style.height = '100%'
				// document.getElementById('middlepanel').style.width = '100%'
				// document.getElementById('middlepanel').style.overflow = 'auto'
				// document.getElementById('middlepanel').style.position = 'relative'
				// document.getElementById('labpanel').style.overflow = 'scroll'

				document.getElementById('topspacerMenu').style.height = '40%'

				document.getElementById('algorithmoption').style.fontSize = '1.2vmax'
				document.getElementById('boundaryoption').style.fontSize = '1.2vmax'
				document.getElementById('chargesoption').style.fontSize = '1.2vmax'
				document.getElementById('settingsoption').style.fontSize = '1.2vmax'

				document.getElementById('algorithmoptionH').style.height = '50%'
				document.getElementById('boundaryoptionH').style.height = '50%'
				document.getElementById('chargesoptionH').style.height = '50%'
				document.getElementById('settingsoptionH').style.height = '50%'

				document.getElementById('algorithmoption').style.border = '0.5px solid rgb(153, 153, 153)'
				document.getElementById('boundaryoption').style.border = '0.5px solid rgb(153, 153, 153)'
				document.getElementById('chargesoption').style.border = '0.5px solid rgb(153, 153, 153)'
				document.getElementById('settingsoption').style.border = '0.5px solid rgb(153, 153, 153)'

				document.getElementById('savebutton').style.borderRadius = '6px'
				document.getElementById('loadbutton').style.borderRadius = '6px'
				document.getElementById('homebutton').style.borderRadius = '6px'


				// document.getElementById('boundaryoptionspanel').style.position = 'absolute'
				// document.getElementById('algooptionspanel').style.position = 'absolute'
				// document.getElementById('chargesoptionspanel').style.position = 'absolute'
				// document.getElementById('settingsoptionspanel').style.position = 'absolute'

				// document.getElementById('boundaryoptionspanel').style.height = '92%'
				// document.getElementById('algooptionspanel').style.height = '92%'
				// document.getElementById('chargesoptionspanel').style.height = '92%'
				// document.getElementById('settingsoptionspanel').style.height = '92%'

				setFont(['algorithmnametext','algorithmeditortext','algorithmchoosetext','addchargeText'], '1.2vmax')
				setFont(['algorithmdescriptiontext','errorAndInfodisplay','boundaryadditionalinfo'], '1.1vmax')
				setFont(['algoplaytext', 'algosteptext', 'algoresettext','algorithmsToChoose','algoadditionalinfo','energyinfodata'], '1vmax')

				setFont(['bdtypename', 'ellipseoptiontilebutton', 'polyoptiontilebutton', 'sidesname', 'sidesTileInput', 'boundarypointseditortext', 'semiMajorAxName', 'semiMajorTileInput', 'semiMinorAxName', 'semiMinorTileInput','chargepropName','chNumberTopHead','chargeXLabelN','chargeYLabelN','chargeWLabelN','egfuncTextID'], '1.2vmax')
				setFont(['bdptNameID', 'XcorBDName', 'YcorBDName'], '1.3vmax')

				setFont(['energyFInput'], '1.8vmax')

				document.getElementById('spacerBD1').style.height = '3%'
				document.getElementById('spacerCH1').style.height = '3%'
				document.getElementById('spacerD1').style.height = '3%'

				
				


				
				// document.getElementById('textTablesH').style.height = '80%'

				// document.getElementById('textgraphTablesH').style.height = '60%'
				// document.getElementById('textgraphTablesH').style.width = '100%'

				// document.getElementById('graphholder').style.width = '100%'
				// document.getElementById('graphholder').style.height = '40%'
				// document.getElementById('spacer1H').style.height = '3%'
				// document.getElementById('graphTablesH').style.width = '100%'
				// document.getElementById('graphTablesH').style.height = '25%'

				// document.getElementById('outputtable').style.height = '10%'


				// document.getElementById('graphspaceholder').style.width = '0%'
				// document.getElementById('pausePrevTD').style.width = '13%'

				// document.getElementById('playpauseSim').style.textAlign = 'left'
				// document.getElementById('playpauseSim').style.fontSize = '3.3vmin'

				// document.getElementById('materialH').style.backgroundColor = 'black'

				// $(window).bind('scroll', function () {
				// 	if ($(window).scrollTop() > 50) {
				// 		$('.menu').addClass('fixed');
				// 	} else {
				// 		$('.menu').removeClass('fixed');
				// 	}
				// });
				
			}
		}

		handleLayout()

		
		uid = 0
		graphData = {}

		reverseGraphElementMap = {}
		
		function setUpGraph() {
			graphH = document.getElementById('labH')
			graphoptions = {}
			graphoptions.xmax = 1.8
			graphoptions.xmin = -1.8

			graphoptions.ymax = 1.2
			graphoptions.ymin = -1.2
			// if (mode == 'portrait') {
			// 	graphoptions.ymax = 3
			// 	graphoptions.ymin = -3	
			// }

			graphoptions.axislocationX = 0
			graphoptions.axislocationY = 0

			graphoptions.xaxislabelvisibility = 'no'
			graphoptions.yaxislabelvisibility = 'no'

			// graphoptions.xaxisvisibility= 'no'
			// graphoptions.yaxisvisibility = 'no'

			// graphoptions.xmajorgridlabelvisibility = 'no'
			// graphoptions.ymajorgridlabelvisibility = 'no'

			// graphoptions.xmajorgridlinesvisibility = 'no'
			// graphoptions.ymajorgridlinesvisibility = 'no'

			// graphoptions.ymajorgridlinesextension = 'yes'
			// graphoptions.xmajorgridlinesextension = 'yes'

			// graphoptions.xaxislabel = 'H'
			// graphoptions.yaxislabel = 'M'

			// graphoptions.gridlinenumberX = 5
			// graphoptions.gridlinenumberY = 5

			graphoptions.fontSize = 1.6
			// graphoptions.xmajorgridlabelshift = 2
			// graphoptions.ymajorgridlabelshift = 2

			// if (mode == 'portrait') {
			// 	graphoptions.gridlinenumberX = 4
			// 	graphoptions.gridlinenumberY = 11
			// 	graphoptions.fontSize = 5
			// }

			graphoptions.unitAspectRatio = 'yes'
			// graphoptions.fixAxis = 'yaxis'
			graphoptions.fixAxisStretchCentrally = 'yes'

			graphoptions.position = 'relative'
			graphoptions.scrollZoom = 'yes'

			graphoptions.draggability = 'yes'


			// graphoptions.isgraphH = 'yes'
			
			addGraph(graphH, 'labG', graphoptions)

			// options = {}
			// options.points = [[-10, -10], [-10, -10]]
			// options.pathcolor = 'hsla(40, 100%, 50%, 1)'
			// options.strokewidth = 0.4
			// addPath('basicGraph', 'graphpointpath', options)

			options = {}
			options.ellipsecolor = 'hsla(190, 0%, 0%, 0)'
			options.stroke = 'hsla(0,0%,0%,0)'
			options.x = 0
			options.y = 0
			options.ry = 1
			options.rx = 1
			options.strokewidth = 2
			addedellipseboundary = addEllipse('labG', 'simpleEllipticBoundary', options)[0]
			addedellipseboundary.style.pointerEvents = 'none'

			options = {}
			options.pathcolor = 'hsla(0, 0%, 0%, 0)'
			options.points = [[1,0], [0,1], [-1,0], [0,-1],[1,0]]
			options.strokewidth = 0.3
			addedpolyboundary = addPath('labG', 'simplePolygonBoundary', options)[0]
			addedpolyboundary.style.pointerEvents = 'none'


			// options = {}
			// options.circlecolor = 'hsla(190, 0%, 0%, 0)'
			// options.stroke = boptions.color
			// options.x = 0
			// options.y = 0
			// options.radius = boptions.radius
			// options.strokewidth = boptions.boundaryThickness || 2
			// addCircle('labG', 'simpleCircleBoundary', options)
		}

		function inside(point, vs) {
			// ray-casting algorithm based on
			// http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
			var x = point[0], y = point[1];

			var inside = false;
			for (var i = 0, j = vs.length - 1; i < vs.length; j = i++) {
				var xi = vs[i][0], yi = vs[i][1];
				var xj = vs[j][0], yj = vs[j][1];

				var intersect = ((yi > y) != (yj > y)) && (x < (xj - xi) * (y - yi) / (yj - yi) + xi);
				if (intersect) inside = !inside;
			}

			return inside;
		};

		setUpGraph()

		window.onscroll = function (e) {
			document.getElementById('scrollerH').style.height = linearValue(0,document.body.offsetHeight - document.body.clientHeight, 35, 100, document.body.scrollTop) + '%'
			if (dmode == 'portrait') {
				if (linearValue(0,document.body.offsetHeight - document.body.clientHeight, 0, 100, document.body.scrollTop) > 25) {
					document.getElementById('verticalspacerA').style.height = '0%'
					document.getElementById('verticalspacerB').style.height = '0%'
					document.getElementById('middlepanel').style.height = '0%'
					document.getElementById('titleH').style.height = '15%'
					document.getElementById('simulationDetailAndButtonsH').style.height = '85%'
					document.getElementById('labH').style.height = '85%'
					document.getElementById('containAll').style.height = '50%'
					document.getElementById('space1Div').style.height = '50%'
					document.getElementById('maintitle').innerHTML = 'N <font style="color: var(--themeblue);">Charges</font> inside a <font style="color: var(--themeorange);">boundary</font> <br/>'
					
				}
				else {
					document.getElementById('titleH').style.height = '25%'
					document.getElementById('simulationDetailAndButtonsH').style.height = '75%'
					document.getElementById('labH').style.height = '75%'
					document.getElementById('containAll').style.height = '55%'
					document.getElementById('space1Div').style.height = '55%'
					document.getElementById('maintitle').innerHTML = 'N <font style="color: var(--themeblue);">Charges</font> inside a <font style="color: var(--themeorange);">boundary</font> <br/><font style="font-size: 1.6vmax; font-family: Nunito; font-weight: normal; color: hsla(190, 0%, 30%, 1);">Finding Minimum Energy Configurations </font><br/><font style="font-size: 1.3vmax; font-weight: normal; font-family: Nunito; color: hsla(260, 100%, 30%, 1);">Vinton Adrian Rebello, Manas Shetty and Prajwal DSouza </font><br/><font style="font-size: 1.3vmax;">inspired by the <a href="https://iopscience.iop.org/article/10.1088/0305-4470/31/3/014/meta" style="text-decoration: none;" target="_blank"><font style="color: hsla(190, 40%, 40%, 1);">work</font></a> of Kari J Nurmela</font>'

				}
			}
				

				
			// console.log(linearValue(0,document.body.offsetHeight - document.body.clientHeight, 0, 100, document.body.scrollTop))
		} 


		boundaryoptions = {}
		boundaryoptions.color = 'var(--boundaryorange)'

		options = {}
		options.stroke = 'var(--boundaryorange)'
		updateEllipse('labG', 'simpleEllipticBoundary', options)

		function addEllipseKnobs() {
			options = {}
			options.x = 1
			options.y = 0
			options.pointsize = 1
			options.pointcolor = 'var(--themeorange)'
			mjknob = addPoint('labG', 'majorknob', options)[0]
			mjknob.style.visibility = 'hidden'
			mjknob.style.pointerEvents = 'none'

			options = {}
			options.x = 1
			options.y = 0
			options.pointsize = 2
			options.pointcolor = 'hsla(32, 100%, 50%, 0.3)'
			options.draggability = 'yes'
			options.dragDirection = 'onlyX'
			options.dragIfCondition = 'moveX > 0'
			options.runFunctionDuringDrag = 'majorknobDragFunction()'
			options.runFunctionOnDragEnd = 'randomizeChargePositions()'
			majorknob = addPoint('labG', 'majorknobBack', options)[0]
			majorknob.style.visibility = 'hidden'
			majorknob.style.pointerEvents = 'none'
			majorknob.style.cursor = 'ew-resize'

			options = {}
			options.x = 0
			options.y = 1
			options.pointsize = 1
			options.pointcolor = 'var(--themeorange)'
			mnknob = addPoint('labG', 'minorknob', options)[0]
			mnknob.style.visibility = 'hidden'
			mnknob.style.pointerEvents = 'none'

			options = {}
			options.x = 0
			options.y = 1
			options.pointsize = 2
			options.pointcolor = 'hsla(32, 100%, 50%, 0.3)'
			options.draggability = 'yes'
			options.dragDirection = 'onlyY'
			options.dragIfCondition = 'moveY > 0'
			options.runFunctionDuringDrag = 'minorknobDragFunction()'
			options.runFunctionOnDragEnd = 'randomizeChargePositions()'
			minorknob = addPoint('labG', 'minorknobBack', options)[0]
			minorknob.style.visibility = 'hidden'
			minorknob.style.pointerEvents = 'none'
			minorknob.style.cursor = 'ns-resize'
		}

		addEllipseKnobs()

		function majorknobDragFunction() {
			knobGName = reverseGraphElementMap[currentMovingPoint.id][0]
			knobName = reverseGraphElementMap[currentMovingPoint.id][1]

			options = {}
			options.rx = graphData[knobGName].pointData[knobName][1].x
			updateEllipse(knobGName, 'simpleEllipticBoundary', options)

			updatePointXY(knobGName, 'majorknob', graphData[knobGName].pointData[knobName][1].x, graphData[knobGName].pointData[knobName][1].y)
			

			boundaryoptions.semiMajorAxis = graphData[knobGName].pointData[knobName][1].x
			document.getElementById('semiMajorTileInput').value = boundaryoptions.semiMajorAxis
			boundaryTypeCheck()
		}

		function minorknobDragFunction() {
			knobGName = reverseGraphElementMap[currentMovingPoint.id][0]
			knobName = reverseGraphElementMap[currentMovingPoint.id][1]

			updatePointXY(knobGName, 'minorknob', graphData[knobGName].pointData[knobName][1].x, graphData[knobGName].pointData[knobName][1].y)
			options = {}
			options.ry = graphData[knobGName].pointData[knobName][1].y
			updateEllipse(knobGName, 'simpleEllipticBoundary', options)

			boundaryoptions.semiMinorAxis = graphData[knobGName].pointData[knobName][1].y
			document.getElementById('semiMinorTileInput').value = boundaryoptions.semiMinorAxis

			boundaryTypeCheck()
		}

		function updateMinorAxis() {
			boundaryoptions.semiMinorAxis = parseFloat(document.getElementById('semiMinorTileInput').value)
			updatePointXY('labG', 'minorknob', 0, boundaryoptions.semiMinorAxis)
			options = {}
			options.ry = boundaryoptions.semiMinorAxis
			updateEllipse('labG', 'simpleEllipticBoundary', options)

			updatePointXY('labG', 'minorknobBack', 0, boundaryoptions.semiMinorAxis)

			boundaryTypeCheck()
		}

		function updateMajorAxis() {
			boundaryoptions.semiMajorAxis = parseFloat(document.getElementById('semiMajorTileInput').value)
			updatePointXY('labG', 'majorknob', boundaryoptions.semiMajorAxis, 0)
			options = {}
			options.rx = boundaryoptions.semiMajorAxis
			updateEllipse('labG', 'simpleEllipticBoundary', options)

			updatePointXY('labG', 'majorknobBack', boundaryoptions.semiMajorAxis, 0)

			boundaryTypeCheck()
		}

		boundaryoptions.semiMajorAxis = 1
		boundaryoptions.semiMinorAxis = 1
		boundaryoptions.radius = 1

		boundaryType = 'circle'

		function boundaryTypeCheck() {
			if (boundaryoptions.semiMajorAxis == boundaryoptions.semiMinorAxis) {
				boundaryoptions.radius = boundaryoptions.semiMajorAxis
				boundaryType = 'circle'
			}
			else {
				boundaryType = 'ellipse'
			}
		}

		boundaryTypeCheck()

		chargeDetails = {}
		chargeId = 0

		function addCharge(locX, locY, weight) {
			options = {}
			options.x = locX
			options.y = locY
			options.pointsize = 1
			options.pointcolor = 'var(--themeblue)'
			chargeId = chargeId + 1
			addPoint('labG', chargeId + '-charge', options)

			chargeDetails.push([chargeId, [locX, locY], weight])
		}

		function addChargeToBoundary(locX, locY, weight, chnumber) {
			if (boundaryType == 'circle') {
				if (distF([0,0],[locX, locY]) < boundaryoptions.radius) {
					options = {}
					options.x = locX
					options.y = locY
					options.pointsize = 1
					options.pointcolor = 'var(--themeblue)'
					options.draggability = 'yes'
					options.currentlyDraggable = 'no'
					chargeId = chargeId + 1
					addPoint('labG', chargeId + '-charge', options)

					options = {}
					options.x = locX
					options.y = locY
					options.pointsize = 2
					options.pointcolor = 'hsla(198, 100%, 50%, 0.4)'
					options.draggability = 'yes'
					options.currentlyDraggable = 'yes'
					options.dragIfCondition = 'chargeMovePossible([moveX, moveY])'
					options.runFunctionDuringDrag = 'chargeMove([moveX, moveY])'
					options.runFunctionOnDragEnd = 'chargeMoveEnd()'
					addedChBack = addPoint('labG', chargeId + '-chargeBack', options)[0]
					addedChBack.style.cursor = 'move'
					addedChBack.style.pointerEvents = 'none'
					addedChBack.style.visibility = 'hidden'

					chargeDetails[chnumber] = {}
					chargeDetails[chnumber].loc = [locX, locY]
					chargeDetails[chnumber].weight = weight
					chargeDetails[chnumber].id = chargeId
					chargeuidMap[chargeId] = chnumber
				}	
			}
			else if (boundaryType == 'ellipse') {
				if (Math.pow(locX/boundaryoptions.semiMajorAxis, 2) + Math.pow(locY/boundaryoptions.semiMinorAxis, 2) < 1) {
					options = {}
					options.x = locX
					options.y = locY
					options.pointsize = 1
					options.pointcolor = 'var(--themeblue)'
					options.draggability = 'yes'
					options.currentlyDraggable = 'no'
					chargeId = chargeId + 1
					addPoint('labG', chargeId + '-charge', options)

					options = {}
					options.x = locX
					options.y = locY
					options.pointsize = 2
					options.pointcolor = 'hsla(198, 100%, 50%, 0.4)'
					options.draggability = 'yes'
					options.currentlyDraggable = 'yes'
					options.dragIfCondition = 'chargeMovePossible([moveX, moveY])'
					options.runFunctionDuringDrag = 'chargeMove([moveX, moveY])'
					options.runFunctionOnDragEnd = 'chargeMoveEnd()'
					addedChBack = addPoint('labG', chargeId + '-chargeBack', options)[0]
					addedChBack.style.cursor = 'move'
					addedChBack.style.pointerEvents = 'none'
					addedChBack.style.visibility = 'hidden'

					chargeDetails[chnumber] = {}		
					chargeDetails[chnumber].loc = [locX, locY]
					chargeDetails[chnumber].weight = weight
					chargeDetails[chnumber].id = chargeId
					chargeuidMap[chargeId] = chnumber
				}	
			}
			else if (boundaryType == 'polygon') {
				if (inside([locX, locY], polyPoints)) {
					options = {}
					options.x = locX
					options.y = locY
					options.pointsize = 1
					options.pointcolor = 'var(--themeblue)'
					options.draggability = 'yes'
					options.currentlyDraggable = 'no'
					chargeId = chargeId + 1
					addPoint('labG', chargeId + '-charge', options)	

					options = {}
					options.x = locX
					options.y = locY
					options.pointsize = 2
					options.pointcolor = 'hsla(198, 100%, 50%, 0.4)'
					options.draggability = 'yes'
					options.currentlyDraggable = 'yes'
					options.dragIfCondition = 'chargeMovePossible([moveX, moveY])'
					options.runFunctionDuringDrag = 'chargeMove([moveX, moveY])'
					options.runFunctionOnDragEnd = 'chargeMoveEnd()'
					addedChBack = addPoint('labG', chargeId + '-chargeBack', options)[0]
					addedChBack.style.cursor = 'move'
					addedChBack.style.pointerEvents = 'none'
					addedChBack.style.visibility = 'hidden'

					chargeDetails[chnumber] = {}
					chargeDetails[chnumber].loc = [locX, locY]
					chargeDetails[chnumber].weight = weight
					chargeDetails[chnumber].id = chargeId
					chargeuidMap[chargeId] = chnumber
				}	
			}			
		}

		chargeuidMap = {}

		function chargeMove(chlocation) {
			chargeids = currentMovingPoint.id.split('-')[2]
			chargenum = chargeuidMap[chargeids]
			chargeDetails[chargenum].loc = chlocation
			updatePointXY('labG', chargeids + '-charge', chlocation[0], chlocation[1])
			document.getElementById('chpointBXv@' + chargenum).value = chlocation[0]
			document.getElementById('chpointBYv@' + chargenum).value = chlocation[1]
		}

		function chargeMoveEnd() {
			currentEnergy = computeEnergy()
			if (currentEnergy < lowestEnergy) {
				lowestEnergy = currentEnergy
				// console.log(lowestEnergy)
			}
			updateEnergyInfo()
		}

		function chargeMovePossible(chlocation) {
			if (boundaryType == 'circle') {
				if (distF([0,0],chlocation) < boundaryoptions.radius) {
					return true
				}
				else {
					return false
				}
			}
			else if (boundaryType == 'ellipse') {

				if (Math.pow(chlocation[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(chlocation[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
					return true
				}
				else {
					return false
				}
			}
			else if (boundaryType == 'polygon') {
				if (inside(chlocation, polyPoints)) {
					return true
				}
				else {
					return false
				}
			}
		}

		function addCharges(number) {
			if (boundaryType == 'circle') {
				for(ch = 0; ch < number; ch++) {
					ang = Math.random()*2*Math.PI
					dis = Math.random()*boundaryoptions.radius	
					addNewChargePoint([dis*Math.cos(ang), dis*Math.sin(ang), 1])
				}
			}	
			else if (boundaryType == 'ellipse') {
				for(ch = 0; ch < number; ch++) {
					ang = Math.random()*2*Math.PI
					bdpointE = [boundaryoptions.semiMajorAxis*Math.cos(ang), boundaryoptions.semiMinorAxis*Math.sin(ang)]
					dis = Math.random()*distF([0,0], bdpointE)
					addNewChargePoint([dis*Math.cos(ang), dis*Math.sin(ang), 1])
				}
			}
			else if (boundaryType == 'polygon') {
				for(ch = 0; ch < number; ch++) {
					polypointXV = []
					polypointYV = []
					for (polypointindex = 0; polypointindex < polyPoints.length; polypointindex++) {
						polypointXV.push(polyPoints[polypointindex][0])
						polypointYV.push(polyPoints[polypointindex][1])
					}

					ppxmin = Math.min.apply(Math, polypointXV)
					ppxmax = Math.max.apply(Math, polypointXV)
					ppymin = Math.min.apply(Math, polypointYV)
					ppymax = Math.max.apply(Math, polypointYV)

					while(true) {
						canditatepointX = ppxmin + Math.random()*(ppxmax - ppxmin)
						canditatepointY = ppymin + Math.random()*(ppymax - ppymin)
						if (inside([canditatepointX, canditatepointY], polyPoints)) {
							addNewChargePoint([canditatepointX, canditatepointY, 1])
							break
						}
					}
					
				}
			}
		}

		function addchargeblock() {
			randompsn = randomPositionInsideBoundary()
			addNewChargePoint([randompsn[0],randompsn[1], 1])
		}

		function addNewChargePoint(newchpoint) {
			ref = document.getElementById('chfinalspacer')
			// polypointuid = polypointuid + 1
			chlength = Object.keys(chargeDetails).length + 1
			cindex = chlength
			newdiv = document.createElement("div");
			newdiv.id = 'chpointB' + cindex
			newdiv.setAttribute('class','chpointB')
			newdiv.style = 'margin:0px;width:100%; height:20%; display: inline-block;'

			portraitfont1 = '0.9vmax'
			portraitfont2 = '0.6vmax'
			if (dmode == 'portrait') {
				portraitfont1 = '1.2vmax'
				portraitfont2 = '0.9vmax'
			}
			newdiv.innerHTML = '<input value="' + (chlength) + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 5%; height: 100%; text-align: center;font-size:' + portraitfont1 + '; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: var(--themeblue); cursor: auto; pointer-events: none; user-select: none;" readonly=""><div id="chspacer" style="margin:0px;width:4%; height:100%; display: inline-block;"></div><input type="number" step="0.01" id="chpointBXv@' + (chlength) + '" oninput="chpointInput(event)" value="' + newchpoint[0] + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 25%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size:' + portraitfont1 + '; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none; border-radius: 6px; outline: none;"><div id="chspacer" style="margin:0px;width:4%; height:100%; display: inline-block;"></div><input type="number" step="0.01" id="chpointBYv@' + (chlength) + '" oninput="chpointInput(event)" value="' + newchpoint[1] + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 25%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size:' + portraitfont1 + '; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none; border-radius: 6px;"><div id="chspacer" style="margin:0px;width:4%; height:100%; display: inline-block;"></div><input type="number" step="0.01" id="chpointBCv@' + (chlength) + '" oninput="chpointInput(event)" value="' + newchpoint[2] + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 14%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size:' + portraitfont1 + '; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none; border-radius: 6px;"><div id="chspacer" style="margin:0px;width:4%; height:100%; display: inline-block;"></div><input onclick="removeChargePoint(event)" value="REMOVE" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 13%; height: 100%; text-align: center;font-size: ' + portraitfont2 + '; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: var(--themeblue); cursor: pointer;  user-select: none;" id="chpointRemove@' + (chlength) + '" readonly=""></div>'
			ref.parentNode.insertBefore(newdiv, ref);

			newdiv = document.createElement("div");
			newdiv.id = 'chVspacerOf' + (chlength)
			newdiv.setAttribute('class', 'chVspacer')
			newdiv.style = 'margin:0px;width:100%; height:5%; display: inline-block;'
			ref.parentNode.insertBefore(newdiv, ref);

			addChargeToBoundary(newchpoint[0], newchpoint[1], newchpoint[2], cindex)
			$("#chargePropsBlocksH").scrollTop($("#chargePropsBlocksH")[0].scrollHeight);

			showChargeKnobs()

			lowestEnergy = Infinity

			if (doEnergyComputation) {
				currentEnergy = computeEnergy()
				if (currentEnergy < lowestEnergy) {
					lowestEnergy = currentEnergy
					// console.log(lowestEnergy)
				}
				updateEnergyInfo()
			}
		}

		function chpointInput(event) {
			chargenum = event.target.id.split('@')[1]
			chargeids = chargeDetails[chargenum].id
			chlocation = [parseFloat(document.getElementById('chpointBXv@' + chargenum).value), parseFloat(document.getElementById('chpointBYv@' + chargenum).value)]
			if (chargeMovePossible(chlocation)) {
				chargeDetails[chargenum].loc = chlocation
				chargeDetails[chargenum].weight = parseFloat(document.getElementById('chpointBCv@' + chargenum).value)
				updatePointXY('labG', chargeids + '-charge', chlocation[0], chlocation[1])
				updatePointXY('labG', chargeids + '-chargeBack', chlocation[0], chlocation[1])
			}
			currentEnergy = computeEnergy()
			if (currentEnergy < lowestEnergy) {
				lowestEnergy = currentEnergy
				// console.log(lowestEnergy)
			}
			updateEnergyInfo()
		}

		function removeChargePoint(event) {
			newChargeDetails = {...chargeDetails}
			removedCharge = event.target.id.split('@')[1]

			for (var chargeIndex in chargeDetails) {
				removePoint('labG', chargeDetails[chargeIndex].id +  '-charge')
				removePoint('labG',  chargeDetails[chargeIndex].id + '-chargeBack')
			}

			chargeDetails = {}
			document.getElementById('chargePropsBlocksH').innerHTML = "<div id='topspacer' style='margin:0px;width:100%; height:6%; display: inline-block;'></div><div id='chfinalspacer' style='margin:0px;width:100%; height:20%; display: inline-block;'></div>"

			for (var chargekey in newChargeDetails) {
				if (removedCharge != chargekey) {
					removedLoc = newChargeDetails[chargekey].loc
					removedW = newChargeDetails[chargekey].weight
					addNewChargePoint([removedLoc[0], removedLoc[1], removedW])
				}
			}
		}

		function removeAllCharges() {
			for (var chargeIndex in chargeDetails) {
				removePoint('labG', chargeDetails[chargeIndex].id +  '-charge')
				removePoint('labG',  chargeDetails[chargeIndex].id + '-chargeBack')
			}

			chargeDetails = {}
			document.getElementById('chargePropsBlocksH').innerHTML = "<div id='topspacer' style='margin:0px;width:100%; height:6%; display: inline-block;'></div><div id='chfinalspacer' style='margin:0px;width:100%; height:20%; display: inline-block;'></div>"

			
		}

		function handleEnergyFInput(event) {
			energyFunc = event.target.value
		}

		energyFunc = 'p*q/d'

		function energyMeasure() {
			return eval(energyFunc)
		}

		function computeEnergy() {
			enrg = 0
			completedCombination = {}
			// console.log('s')
			for (var charge1 in chargeDetails) {
				for (var charge2 in chargeDetails) {
					if (charge2 != charge1 && completedCombination[charge2 + '-' + charge1] == undefined && completedCombination[charge1 + '-' + charge2] == undefined) {
						ch1dist = chargeDetails[charge1].loc
						ch2dist = chargeDetails[charge2].loc
						chargeDist = distF(ch1dist, ch2dist)
						d = chargeDist
						p = chargeDetails[charge1].weight
						q = chargeDetails[charge2].weight
						// console.log(p, q)
						// console.log(energyMeasure())
						enrg = enrg + energyMeasure()
						completedCombination[charge2 + '-' + charge1] = true
						completedCombination[charge1 + '-' + charge2] = true
					}
				}
			}
			return enrg
		}

		function checkEnergy() {
			currentEnergy = computeEnergy()
			if (currentEnergy < lowestEnergy) {
				lowestEnergy = currentEnergy
				// console.log(lowestEnergy)
			}
			updateEnergyInfo()
			return currentEnergy
		}

		doEnergyComputation = true
		lowestEnergy = Infinity
		lowestEnergyPositions = {}
		currentEnergy = Infinity

		playing = true

		function togglePlayPause(event) {
		 	if (playing) {
		 		clearInterval(loopinterval);
		 		playing = false
		 		document.getElementById('playpauseSim').innerHTML = 'Play Simulation'
		 	}
		 	else {
		 		playLoop()
		 		playing = true
		 		document.getElementById('playpauseSim').innerHTML = 'Pause Simulation'
		 	}
		 }

		function addArray(ar1, ar2) {
		 	arsum = []
		 	if (ar1.length == ar2.length) {
		 		for (idx = 0; idx < ar1.length; idx++) {
		 			arsum.push(ar1[idx] + ar2[idx])
		 		}
		 	}
		 	return arsum
		 }

		function tangentialBoundaryForce(sforcevector) {
			returnvec1 = [(-1)*sforcevector[1],sforcevector[0]]
			returnvec2 = [sforcevector[1],(-1)*sforcevector[0]]
			return [returnvec1, returnvec2]
		}

		handleTangentialForce = true

		function electrostaticWalk(onCharge, moveDistance) {
		 	charge2 = onCharge
			ch2dist = chargeDetails[charge2].loc
			totalforce = [0,0]
			for (var charge1 in chargeDetails) {
				if (charge2 != charge1) {
					ch1dist = chargeDetails[charge1].loc
					chargeDist = distF(ch1dist, ch2dist)
					vec = directionvec(ch1dist, ch2dist)
					// [algo.movefactor*vec[0]/Math.pow(chargeDist,2),algo.movefactor*vec[1]/Math.pow(chargeDist,2)]
					force = [vec[0]/Math.pow(chargeDist,2),vec[1]/Math.pow(chargeDist,2)]
					totalforce = addArray(force, totalforce)
				}
			}
			totalforce = [moveDistance*totalforce[0]/mod(totalforce),moveDistance*totalforce[1]/mod(totalforce)]
			newpos = [totalforce[0] + ch2dist[0], totalforce[1] + ch2dist[1]]
			if (boundaryType == 'circle') {
				if (distF(newpos, [0,0]) < boundaryoptions.radius) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					if (usingStepAlgo) {
						document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Moved the charge <font style="color: var(--themeblue)">' + charge2 + '</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">' + moveDistance + '</font>, resulting in displacement of (' + totalforce[0] + ',' +totalforce[1] + ').</font>'
					}
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (distF(newpos, [0,0]) < boundaryoptions.radius) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
						if (usingStepAlgo) {
							document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Moved the charge <font style="color: var(--themeblue)">' + charge2 + '</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">' + moveDistance + '</font>, resulting in displacement of (' + newtotalforce[0] + ',' + newtotalforce[1] + ').</font>'
						}
					}
				}
			}
			else if (boundaryType == 'ellipse') {
				if (Math.pow(newpos[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(newpos[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					if (usingStepAlgo) {
						document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Moved the charge <font style="color: var(--themeblue)">' + charge2 + '</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">' + moveDistance + '</font>, resulting in displacement of (' + newtotalforce[0] + ',' + newtotalforce[1] + ').</font>'
					}
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (Math.pow(newpos[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(newpos[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
						if (usingStepAlgo) {
							document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Moved the charge <font style="color: var(--themeblue)">' + charge2 + '</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">' + moveDistance + '</font>, resulting in displacement of (' + newtotalforce[0] + ',' + newtotalforce[1] + ').</font>'
						}
					}
				}
			}	
			else if (boundaryType == 'polygon') {
				if (inside(newpos, polyPoints)) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					if (usingStepAlgo) {
						document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Moved the charge <font style="color: var(--themeblue)">' + charge2 + '</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">' + moveDistance + '</font>, resulting in displacement of (' + newtotalforce[0] + ',' + newtotalforce[1] + ').</font>'
					}
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (inside(newpos, polyPoints)) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
						if (usingStepAlgo) {
							document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Moved the charge <font style="color: var(--themeblue)">' + charge2 + '</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">' + moveDistance + '</font>, resulting in displacement of (' + newtotalforce[0] + ',' + newtotalforce[1] + ').</font>'
						}
					}
				}
			}	
		}

		function electrostaticForce(onCharge, eStaticStrengthFactor) {
		 	charge2 = onCharge
			ch2dist = chargeDetails[charge2].loc
			totalforce = [0,0]
			for (var charge1 in chargeDetails) {
				if (charge2 != charge1) {
					ch1dist = chargeDetails[charge1].loc
					chargeDist = distF(ch1dist, ch2dist)
					vec = directionvec(ch1dist, ch2dist)
					chargevalue1 = chargeDetails[charge1].weight
					chargevalue2 = chargeDetails[charge2].weight
					numeratorE = chargevalue2*eStaticStrengthFactor*chargevalue1
					// [algo.movefactor*vec[0]/Math.pow(chargeDist,2),algo.movefactor*vec[1]/Math.pow(chargeDist,2)]
					force = [vec[0]*numeratorE/Math.pow(chargeDist,2),vec[1]*numeratorE/Math.pow(chargeDist,2)]
					totalforce = addArray(force, totalforce)
				}
			}
			newpos = [totalforce[0] + ch2dist[0], totalforce[1] + ch2dist[1]]
			if (boundaryType == 'circle') {
				if (distF(newpos, [0,0]) < boundaryoptions.radius) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (distF(newpos, [0,0]) < boundaryoptions.radius) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					}
				}
			}
			else if (boundaryType == 'ellipse') {
				if (Math.pow(newpos[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(newpos[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (Math.pow(newpos[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(newpos[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					}
				}
			}	
			else if (boundaryType == 'polygon') {
				if (inside(newpos, polyPoints)) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (inside(newpos, polyPoints)) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					}
				}
			}	
		}

		function randomForce(onCharge, moveDistance) {
			charge2 = onCharge
			ch2dist = chargeDetails[charge2].loc
			forceangle = Math.random()*2*Math.PI
			totalforce = [moveDistance*Math.cos(forceangle), moveDistance*Math.sin(forceangle)]
			newpos = [totalforce[0] + ch2dist[0], totalforce[1] + ch2dist[1]]
			if (boundaryType == 'circle') {
				if (distF(newpos, [0,0]) < boundaryoptions.radius) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (distF(newpos, [0,0]) < boundaryoptions.radius) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					}
				}
			}
			else if (boundaryType == 'ellipse') {
				if (Math.pow(newpos[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(newpos[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (Math.pow(newpos[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(newpos[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					}
				}
			}	
			else if (boundaryType == 'polygon') {
				if (inside(newpos, polyPoints)) {
					chargeDetails[charge2].loc = newpos
					chargeIds = chargeDetails[charge2].id
					updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
				}
				else if (handleTangentialForce) {
					newtotalforce = randomChoice(tangentialBoundaryForce(totalforce))
					newpos = [newtotalforce[0] + ch2dist[0], newtotalforce[1] + ch2dist[1]]
					if (inside(newpos, polyPoints)) {
						chargeDetails[charge2].loc = newpos
						chargeIds = chargeDetails[charge2].id
						updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
					}
				}
			}	
		}

		function probability() {
			return Math.random()*100
		}

		function pickCharge() {
			chpicked = parseInt(Math.random()*(Object.keys(chargeDetails).length)) + 1
			if (usingStepAlgo) {
				document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Picked the charge <font style="color: var(--themeblue)">' + chpicked + '</font>. </font>'
			}
			return chpicked
		}

		useCustomCode = true
		customcodes = ['charge = pickCharge()', 'electrostaticWalk(charge, 0.008)']
		customcodePointer = 0

		errordisplayflag = false

		loopcount = 0
		function playLoop(event) {
			loopinterval = setInterval(frame, 1);
			function frame() {
				loopcount = loopcount + 1
				if (playing) {
					if (useCustomCode) {
						theInstructions = customcodes[customcodePointer];
						// console.log(theInstructions)
						if (errordisplayflag) {
							errordisplayflag = false
							document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">The code is written in Javascript and exact function names have to followed since they are case sensitive.</font>'
						}
						try {
							eval(theInstructions)
						}
						catch(error) {
							document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Current Error : </font>' + error
							errordisplayflag = true
							document.getElementsByClassName('codeblock')[customcodePointer].style.borderColor = 'red'
							document.getElementsByClassName('codeblockText')[customcodePointer].style.color = 'red'
							stopAlgorithm()
						}
						customcodePointer = (customcodePointer + 1) % customcodes.length
						if (doEnergyComputation) {
							checkEnergy()
						}
							
					}
					else {
						if (algorithm == 'Electrostatic') {
							for (mch = 0; mch < 1; mch++) {
								charge2 = parseInt(Math.random()*(Object.keys(chargeDetails).length)) + 1
								ch2dist = chargeDetails[charge2].loc
								totalforce = [0,0]
								for (var charge1 in chargeDetails) {
									if (charge2 != charge1) {
										ch1dist = chargeDetails[charge1].loc
										chargeDist = distF(ch1dist, ch2dist)
										vec = directionvec(ch1dist, ch2dist)
										force = [algo.movefactor*vec[0]/Math.pow(chargeDist,2),algo.movefactor*vec[1]/Math.pow(chargeDist,2)]
										if (Math.random() < algo.randomfluctuations) {
											force = [algo.randomdist*(Math.random() - 0.5)*algo.movefactor, algo.randomdist*(Math.random() - 0.5)*algo.movefactor]
										}
										totalforce = addArray(force, totalforce)
									}
								}
								newpos = [totalforce[0] + ch2dist[0], totalforce[1] + ch2dist[1]]
								if (distF(newpos, [0,0]) < boundaryoptions.radius) {
									chargeDetails[charge2].loc = newpos
									chargeIds = chargeDetails[charge2].id
									updatePointXY('labG', chargeIds + '-charge', newpos[0], newpos[1])
									// updatePointMemory = ['labG', chargeId + '-charge', newpos[0], newpos[1]]
									// window.requestAnimationFrame(frame); 
									// setTimeout(updatePointLater(chargeId + '-charge'), 1)
								}
							}
						}
						currentEnergy = computeEnergy()
						if (currentEnergy < lowestEnergy) {
							lowestEnergy = currentEnergy
							lowestEnergyPositions = {...chargeDetails}
							// console.log(lowestEnergy)
						}
					}
						
				}
			}
		}

		// playLoop()

		function distF(pt1, pt2) {
			return Math.pow(Math.pow(pt1[0] - pt2[0], 2) + Math.pow(pt1[1] - pt2[1], 2), 0.5)
		}

		function directionvec(pt1, pt2) {
			diff = [pt2[0] - pt1[0], pt2[1] - pt1[1]]
			difflen = distF(diff, [0,0])
			return [diff[0]/difflen, diff[1]/difflen]
		}

		function mod(ofVector) {
			return distF(ofVector, [0,0])
		}

		algorithm = 'Electrostatic'

		function playpauseAlgo(event){
			if (playing) {
				stopAlgorithm()
			}
			else {
				runAlgorithm()
			}
		}

		function runAlgorithm() {
			playing = true
			grabCodes()
			playLoop()
			blocks = document.getElementsByClassName('codeblock')
			for (blk = 0; blk < blocks.length; blk++) {
				blocks[blk].style.borderColor = 'hsla(0,0%,0%,0.5)'
			}
			blocks = document.getElementsByClassName('codeblockText')
			for (blk = 0; blk < blocks.length; blk++) {
				blocks[blk].style.color = 'hsla(0,0%,0%,1)'
			}
			document.getElementById('algoplaytext').innerHTML = 'PAUSE'
			document.getElementById('algosteptext').style.color = 'hsla(0, 0%, 0%, 0.4)'
			document.getElementById('algoresettext').style.color = 'hsla(0, 0%, 0%, 0.4)'
			document.getElementById('algosteptext').style.pointerEvents = 'none'
			document.getElementById('algoresettext').style.pointerEvents = 'none'
			
		}

		function stopAlgorithm() {
			clearInterval(loopinterval)
			playing = false
			document.getElementById('algoplaytext').innerHTML = 'PLAY'
			document.getElementById('algosteptext').style.color = 'hsla(0, 0%, 0%, 1)'
			document.getElementById('algoresettext').style.color = 'hsla(0, 0%, 0%, 1)'
			document.getElementById('algosteptext').style.pointerEvents = 'auto'
			document.getElementById('algoresettext').style.pointerEvents = 'auto'
		}

		runAlgorithm()

		codeblockuid = 2

		function addNewCodeBlock(optionaltext) {
			optionaltext = optionaltext || ''
			customcodes.push(optionaltext)
			codeblockuid = codeblockuid + 1
			cindex = codeblockuid
			newdiv = document.createElement("div");
			newdiv.id = 'codeblock' + cindex
			newdiv.setAttribute('class','codeblock')
			newdiv.style = 'margin:0px;width:80%; height:23%; display: inline-block; border-radius: 4px; border: 1px solid hsla(0,0%,0%,0.5); position: relative; overflow: auto;'
			portraitfont = '0.9vmax'
			if (dmode == 'portrait') {
				portraitfont = '1.2vmax'
			}
			newdiv.innerHTML = '<input oninput="changedCodeBlock(event)" id="codeblock' + cindex + 'text" value="' + optionaltext + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); height: 100%; width: 100%; text-align: center; font-family: Nunito; font-size: ' + portraitfont + '; font-weight: lighter; color:  black; border-radius: 4px;" class="codeblockText"></input>'
			ref = document.getElementById('addcodeblock')
			ref.parentNode.insertBefore(newdiv, ref);

			portraitfont = '0.8vmax'
			if (dmode == 'portrait') {
				portraitfont = '1vmax'
			}
			newdiv = document.createElement("div");
			newdiv.id = 'codeblock' + cindex + 'tile'
			newdiv.style = 'margin:0px;width:15%; height:23%; display: inline-block;  text-align: center; overflow: hidden;'
			newdiv.innerHTML = '<input onclick="removeCodeBlock(event)" id="codeblockremove-' + cindex + '" value="Remove" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 100%; height: 100%; text-align: center; font-family: Nunito; font-size: ' + portraitfont + ';  font-weight: lighter; color:  black; background: hsla(0,0%,0%,0); color: var(--themeviolet); cursor: pointer; user-select: none;" readonly></input>'
			ref.parentNode.insertBefore(newdiv, ref);

			newdiv = document.createElement("div");
			newdiv.id = 'codeblock' + cindex + 'spacer'
			newdiv.style = 'margin:0px;width:100%; height:4%; display: inline-block;'
			ref.parentNode.insertBefore(newdiv, ref);
		}

		function removeCodeBlock(event) {
			blocknum = parseInt(event.target.id.split('-')[1])
			document.getElementById('codeblock' + blocknum).outerHTML = ''
			document.getElementById('codeblock' + blocknum + 'spacer').outerHTML = ''
			document.getElementById('codeblock' + blocknum + 'tile').outerHTML = ''
			grabCodes()
		}

		function removeCodeBlockSpecific(blockid) {
			blocknum = parseInt(blockid.split('codeblock')[1])
			document.getElementById('codeblock' + blocknum).outerHTML = ''
			document.getElementById('codeblock' + blocknum + 'spacer').outerHTML = ''
			document.getElementById('codeblock' + blocknum + 'tile').outerHTML = ''
			grabCodes()
		}

		function removeAllCodeBlocks() {
			blocks = document.getElementsByClassName('codeblock')
			blockscopy = {...blocks}
			for (var blk in blockscopy) {
				removeCodeBlockSpecific(blockscopy[blk].id)
			}
		}

		function changedCodeBlock(event) {
			// divindex = $('#' + event.target.id).parent().index();
			// console.log(divindex/3)
			grabCodes()
		}

		function grabCodes() {
			blocks = document.getElementsByClassName('codeblockText')
			customcodes = []
			for (blk = 0; blk < blocks.length; blk++) {
				customcodes.push(blocks[blk].value)
			}
		}

		usingStepAlgo = false

		function stepAlgo(event) {
			if (useCustomCode) {
				theInstructions = customcodes[customcodePointer];
				blocks = document.getElementsByClassName('codeblockText')
				for (blk = 0; blk < blocks.length; blk++) {
					blocks[blk].style.color = 'hsla(0,0%,0%,1)'
				}
				try {
					usingStepAlgo = true
					errordisplayflag = true
					eval(theInstructions)
					usingStepAlgo = false
					document.getElementsByClassName('codeblockText')[customcodePointer].style.color = 'var(--themeviolet)'
				}
				catch(error) {
					document.getElementById('errorAndInfodisplay').innerHTML = '<font style="color: hsla(0, 0%, 0%, 0.7)">Current Error : </font>' + error
					errordisplayflag = true
					document.getElementsByClassName('codeblock')[customcodePointer].style.borderColor = 'red'
					document.getElementsByClassName('codeblockText')[customcodePointer].style.color = 'red'
					stopAlgorithm()
				}
				customcodePointer = (customcodePointer + 1) % customcodes.length
				checkEnergy()
			}
		}

		function resetAlgo(event) {
			customcodePointer = 0
			randomizeChargePositions()
			lowestEnergy = Infinity
			updateEnergyInfo()
		}

		algorithmCodes = {}
		algorithmCodes.electrostaticwalkAlgoCode = ['charge = pickCharge()', 'electrostaticWalk(charge, 0.008)']
		algorithmCodes.electrostaticwithRandomnessAlgoCode = ['charge = pickCharge()', 'if (probability() < 40) { randomForce(charge, 0.02) }','charge = pickCharge()', 'if (probability() < 90) { electrostaticWalk(charge, 0.008) }']
		algorithmCodes.electrostaticForceAlgoCode = ['charge = pickCharge()', 'electrostaticForce(charge, 0.003)']
		algorithmCodes.randomPositionAlgoCode  = ['charge = pickCharge()', 'oldps = getPosition(charge)','newps = randomPositionInsideBoundary()', 'oldenergy = computeEnergy()', 'moveChargeToPosition(newps, charge)', 'newenergy = computeEnergy()', 'if (newenergy > oldenergy) {moveChargeToPosition(oldps, charge)}']
		algorithmCodes.geneticAlgoCode = ['charge = pickCharge()', 'electrostaticForce(charge, 0.008)']
		algorithmCodes.randomSearchAlgoCode = ['randomizeChargePositions()']
		algorithmCodes.moveIfMinimumAlgoCode = ['charge = pickCharge()', 'oldps = getPosition(charge)', 'oldenergy = computeEnergy()', 'dsp = randomDisplacementOfLength(0.01)', 'newps = addPositions(oldps, dsp)',  'moveChargeToPosition(newps, charge)', 'newenergy = computeEnergy()', 'if (newenergy > oldenergy) {moveChargeToPosition(oldps, charge)}']


		algorithmCodeDetails = {}
		algorithmCodes.electrostaticwalkAlgoCodeDetails = ['ELECTROSTATIC WALK','Move the <font style="color: var(--themeblue);">nth charge</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">d</font> in the direction of electrostatic force, if the new location is within the <font style="color: var(--themeorange);">boundary</font>. <br/><font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : electrostaticWalk(<font style="color: var(--themeblue);">n</font>, <font style="color: hsla(210, 100%, 50%, 1);">d</font>)</font> <br/><br/> Pick a random <font style="color: var(--themeblue);">charge</font> <br/> <font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : pickCharge()</font><br/><br/><br/>']
		algorithmCodes.electrostaticwithRandomnessAlgoCodeDetails = ['ELECTROSTATIC AND RANDOMNESS','Movement in the direction of the electrostatic force, but with certain randomness. There is a random event which generates a value between 0 to 100, if the probability value is less than certain value, the force is applied. Also, there is new force called the random force. It is equivalent to a statistical fluctuation. It acts in a random direction and makes the picked charged move a distance d in that direction, if the new location is within the <font style="color: var(--themeorange);">boundary</font>.<br/><font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : randomForce(<font style="color: var(--themeblue);">n</font>, <font style="color: hsla(210, 100%, 50%, 1);">d</font>)</font> <br/><br/> Pick a value between 0 to 100.<br/> <font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : probability()</font><br/><br/>Move the <font style="color: var(--themeblue);">nth charge</font>, a distance of <font style="color: hsla(210, 100%, 50%, 1);">d</font> in the direction of electrostatic force<font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : electrostaticForce(<font style="color: var(--themeblue);">n</font>, <font style="color: hsla(210, 100%, 50%, 1);">d</font>)</font> <br/><br/> Pick a random <font style="color: var(--themeblue);">charge</font> <br/> <font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : pickCharge()</font><br/><br/><br/><br/>']
		algorithmCodes.electrostaticForceAlgoCodeDetails = ['ELECTROSTATIC FORCE','Move the <font style="color: var(--themeblue);">nth charge</font>, under the action of the electrostatic force, if the new location is within the <font style="color: var(--themeorange);">boundary</font>. The force strength is given by the term "K". <br/><font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : electrostaticForce(<font style="color: var(--themeblue);">n</font>, K)</font> <br/><br/> Pick a random <font style="color: var(--themeblue);">charge</font> <br/> <font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : pickCharge()</font><br/><br/><br/>']
		algorithmCodes.randomPositionAlgoCodeDetails = ['RANDOM POSITION','Pick a <font style="color: var(--themeblue);">charge</font> and then randomly pick a position within the <font style="color: var(--themeorange);">boundary</font>. Move the <font style="color: var(--themeblue);">charge</font> to that location. If the energy in the new arrangement is greater than the previous arrangment, move the <font style="color: var(--themeblue);">charge</font> back to its original position. <br/><br/> Get the position of the <font style="color: var(--themeblue);">charge</font>.<br/> <font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : getPosition(<font style="color: var(--themeblue);">charge</font>)</font><br/><br/> Pick a random position inside the <font style="color: var(--themeorange);">boundary</font>. <br/><font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : randomPositionInsideBoundary()</font> <br/><br/>Get the energy for the current arrangement of the <font style="color: var(--themeblue);">charges</font>. <br/><font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : computeEnergy()</font><br/><br/><br/> ']
		algorithmCodes.geneticAlgoCodeDetails = ['GENETIC ALGORITHM','We start the charges in a random state and apply a working algorithm, such as ElectroStatic algorithm. Once we reach, the end state, we saved the state. We call this state, the offspring 01 of generation 01. We run the Electrostatic algorithm "p1" times and generate "p1" offsprings which will belong to generation 01. We then pick top "g1" offsprings (states) that leads to the lowest energy states. <br/>We then apply the Electrostatic algorithm (with little changes in parameters) again on these "g1" offsprings picking them randomly and run the algorithm "p2" times to generate "p2" offsprings of generation 02. We pick the top "g2" offsprings of lowest energy. This process continues till we have lowest energy state.<br/><br/><br/>']
		algorithmCodes.randomSearchAlgoCodeDetails = ['RANDOM SEARCH','Pick a random configuration and compute its energy. <br/><br/> Randomly place all the <font style="color: var(--themeblue);">charges</font>. <br/><font style="font-family: Roboto; color: black; font-size: 0.75vmax;"> Code : randomizeChargePositions()</font> <br/><br/>']
		algorithmCodes.moveIfMinimumAlgoCodeDetails = ['MOVE IF MINIMUM','Moves the charge a distance d, in a random direction. If the energy is not minimized, the charge is moved back.']


		function loadAlgoCode(algocode) {
			removeAllCodeBlocks()
			for (codenum = 0; codenum < algocode.length; codenum++) {
				addNewCodeBlock(algocode[codenum])
			}
		}

		// loadAlgoCode(electrostaticwithRandomnessAlgoCode)

		function chooseAlgo(event) {
			loadAlgoCode(algorithmCodes[event.target.value + 'Code'])
			if (dmode == 'portrait') {
				document.getElementById('algorithmnametext').innerHTML = algorithmCodes[event.target.value + 'CodeDetails'][0]
				document.getElementById('algorithmdescriptiontext').innerHTML = algorithmCodes[event.target.value + 'CodeDetails'][1].split('0.75vmax').join('1vmax')
			}
			else {
				document.getElementById('algorithmnametext').innerHTML = algorithmCodes[event.target.value + 'CodeDetails'][0]
				document.getElementById('algorithmdescriptiontext').innerHTML = algorithmCodes[event.target.value + 'CodeDetails'][1]
			}		
		}

		dummyEvent = {}
		dummyEvent['target'] = {}
		dummyEvent.target['value'] = 'electrostaticwalkAlgo'
		chooseAlgo(dummyEvent)

		function getPosition(chargenumb) {
			return chargeDetails[chargenumb].loc
		}

		function randomDisplacementOfLength(dispLength) {
			ang = Math.random()*2*Math.PI
			return [dispLength*Math.cos(ang), dispLength*Math.sin(ang)]
		}

		function addPositions(positionToAdd1, positionToAdd2) {
			return [positionToAdd1[0] + positionToAdd2[0], positionToAdd1[1] + positionToAdd2[1]]
		}

		function randomPositionInsideBoundary() {
			if (boundaryType == 'circle') {
				ang = Math.random()*2*Math.PI
				dis = Math.random()*boundaryoptions.radius	
				return [dis*Math.cos(ang), dis*Math.sin(ang)]
			}
			else if (boundaryType == 'ellipse') {
				ang = Math.random()*2*Math.PI
				bdpointE = [boundaryoptions.semiMajorAxis*Math.cos(ang), boundaryoptions.semiMinorAxis*Math.sin(ang)]
				return [Math.random()*bdpointE[0], Math.random()*bdpointE[1]]
			}
			else if (boundaryType == 'polygon') {
				polypointXV = []
				polypointYV = []
				for (polypointindex = 0; polypointindex < polyPoints.length; polypointindex++) {
					polypointXV.push(polyPoints[polypointindex][0])
					polypointYV.push(polyPoints[polypointindex][1])
				}
				ppxmin = Math.min.apply(Math, polypointXV)
				ppxmax = Math.max.apply(Math, polypointXV)
				ppymin = Math.min.apply(Math, polypointYV)
				ppymax = Math.max.apply(Math, polypointYV)

				toreturnpoint = []
				while(true) {
					canditatepointX = ppxmin + Math.random()*(ppxmax - ppxmin)
					canditatepointY = ppymin + Math.random()*(ppymax - ppymin)
					if (inside([canditatepointX, canditatepointY], polyPoints)) {
						toreturnpoint = [canditatepointX, canditatepointY]
						break
					}
				}
				return toreturnpoint
			}

		}

		function moveChargeToPosition(positionToMove, chargenumb) {
			if (boundaryType == 'circle') {
				if (distF(positionToMove, [0,0]) < boundaryoptions.radius) {
					chargeDetails[chargenumb].loc = positionToMove
					chargeId = chargeDetails[chargenumb].id
					updatePointXY('labG', chargeId + '-charge', positionToMove[0], positionToMove[1])
				}
			}	
			else if (boundaryType == 'ellipse') {
				if (Math.pow(positionToMove[0]/boundaryoptions.semiMajorAxis, 2) + Math.pow(positionToMove[1]/boundaryoptions.semiMinorAxis, 2) < 1) {
					chargeDetails[chargenumb].loc = positionToMove
					chargeId = chargeDetails[chargenumb].id
					updatePointXY('labG', chargeId + '-charge', positionToMove[0], positionToMove[1])
				}
			}	
			else if (boundaryType == 'polygon') {
				if (inside(positionToMove, polyPoints)) {
					chargeDetails[chargenumb].loc = positionToMove
					chargeId = chargeDetails[chargenumb].id
					updatePointXY('labG', chargeId + '-charge', positionToMove[0], positionToMove[1])
				}
			}
		}

		function updateEnergyInfo() {
			document.getElementById('energyinfo').innerHTML =  '<font style="color: hsla(0, 0%, 0%, 0.5); font-weight: normal;">Lowest Energy</font>  ' + lowestEnergy +  ' <br/> <font style="color: hsla(0, 0%, 0%, 0.5); font-weight: normal;">Current Energy</font> ' + currentEnergy + ' <br/> <font style="color: hsla(0, 0%, 0%, 0.5); font-weight: normal;">Energy Function : </font> ' + energyFunc + ' <br/> <font style="color: hsla(0, 0%, 0%, 0.5); font-weight: normal;">Charges : </font><font style="color: var(--themeblue); font-weight: normal;">' + Object.keys(chargeDetails).length + '</font> '
		}

		function randomizeChargePositions() {
			for (var chg in chargeDetails) {
				moveChargeToPosition(randomPositionInsideBoundary(), chg)
			}
		}

		function showChargeKnobs() {
			for (var charge1 in chargeDetails) {
				document.getElementById('labG-point-' + chargeDetails[charge1].id + '-chargeBack').style.visibility = 'visible'
				document.getElementById('labG-point-' + chargeDetails[charge1].id + '-chargeBack').style.pointerEvents = 'auto'
			}
			updateChargeKnobs()
		}

		function hideChargeKnobs() {
			for (var charge1 in chargeDetails) {
				document.getElementById('labG-point-' + chargeDetails[charge1].id + '-chargeBack').style.visibility = 'hidden'
				document.getElementById('labG-point-' + chargeDetails[charge1].id + '-chargeBack').style.pointerEvents = 'none'
			}
		}

		function updateChargeKnobs() {
			for (var charge1 in chargeDetails) {
				updatePointXY('labG', chargeDetails[charge1].id + '-chargeBack', chargeDetails[charge1].loc[0],chargeDetails[charge1].loc[1])
				document.getElementById('chpointBXv@' + charge1).value = chargeDetails[charge1].loc[0]
				document.getElementById('chpointBYv@' + charge1).value = chargeDetails[charge1].loc[1]
			}
				
		}

		function showBoundaryKnobs() {
			if (boundaryType == 'circle' || boundaryType == 'ellipse') {
				minorknob.style.visibility = 'visible'
				minorknob.style.pointerEvents = 'auto'
				majorknob.style.visibility = 'visible'
				majorknob.style.pointerEvents = 'auto'
				mnknob.style.visibility = 'visible'
				mjknob.style.visibility = 'visible'
				for (pptIndex = 1; pptIndex <= polyPoints.length; pptIndex++) {
					document.getElementById('labG-point-polypointknob@' + pptIndex).style.visibility = 'hidden'
					document.getElementById('labG-point-polypointknobBack@' + pptIndex).style.visibility = 'hidden'
					document.getElementById('labG-point-polypointknobBack@' + pptIndex).style.pointerEvents = 'none'
				}
				options = {}
				options.stroke = 'var(--boundaryorange)'
				updateEllipse('labG', 'simpleEllipticBoundary', options)
				options = {}
				options.pathcolor = 'hsla(0, 0%, 0%, 0)'
				updatePath('labG', 'simplePolygonBoundary', options)
			}
			else if (boundaryType == 'polygon') {
				for (pptIndex = 1; pptIndex <= polyPoints.length; pptIndex++) {
					document.getElementById('labG-point-polypointknob@' + pptIndex).style.visibility = 'visible'
					document.getElementById('labG-point-polypointknobBack@' + pptIndex).style.visibility = 'visible'
					document.getElementById('labG-point-polypointknobBack@' + pptIndex).style.pointerEvents = 'auto'
				}
				minorknob.style.visibility = 'hidden'
				minorknob.style.pointerEvents = 'none'
				majorknob.style.visibility = 'hidden'
				majorknob.style.pointerEvents = 'none'
				mnknob.style.visibility = 'hidden'
				mjknob.style.visibility = 'hidden'

				options = {}
				options.stroke = 'hsla(0, 0%, 0%, 0)'
				updateEllipse('labG', 'simpleEllipticBoundary', options)
				options = {}
				options.pathcolor = 'var(--boundaryorange)'
				updatePath('labG', 'simplePolygonBoundary', options)
			}
		}

		function hideBoundaryKnobs() {
			minorknob.style.visibility = 'hidden'
			minorknob.style.pointerEvents = 'none'
			majorknob.style.visibility = 'hidden'
			majorknob.style.pointerEvents = 'none'
			mnknob.style.visibility = 'hidden'
			mjknob.style.visibility = 'hidden'
			for (pptIndex = 1; pptIndex <= polyPoints.length; pptIndex++) {
				document.getElementById('labG-point-polypointknob@' + pptIndex).style.visibility = 'hidden'
				document.getElementById('labG-point-polypointknobBack@' + pptIndex).style.visibility = 'hidden'
				document.getElementById('labG-point-polypointknobBack@' + pptIndex).style.pointerEvents = 'none'
			}
		}

		currentpanel = 'algorithm'

		function handlePanel(event) {
			stopAlgorithm()
			if (event.target.id == 'algorithmoption') {
				event.target.setAttribute('onclick', '')
				event.target.style.cursor = 'auto'
				event.target.style.backgroundColor = 'hsla(280,100%,50%,1)';
				event.target.style.color = 'hsla(0,0%,0%,1)';
				document.getElementById('settingsoption').style.cursor = 'pointer';
				document.getElementById('boundaryoption').style.cursor = 'pointer';
				document.getElementById('chargesoption').style.cursor = 'pointer';
				document.getElementById('settingsoption').style.background = 'none';
				document.getElementById('boundaryoption').style.background = 'none';
				document.getElementById('chargesoption').style.background = 'none';
				document.getElementById('settingsoption').style.color = 'grey';
				document.getElementById('boundaryoption').style.color = 'grey';
				document.getElementById('chargesoption').style.color = 'grey';
				document.getElementById('settingsoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('boundaryoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('chargesoption').setAttribute('onclick', 'handlePanel(event)')

				document.getElementById('algooptionspanel').style.visibility = 'visible'
				document.getElementById('algooptionspanel').style.pointerEvents = 'auto'
				document.getElementById('boundaryoptionspanel').style.visibility = 'hidden'
				document.getElementById('boundaryoptionspanel').style.pointerEvents = 'none'

				document.getElementById('ellipsePanel').style.visibility = 'hidden'
				document.getElementById('polyPanel').style.visibility = 'hidden'
				document.getElementById('ellipsePanel').style.pointerEvents = 'none'
				document.getElementById('polyPanel').style.pointerEvents = 'none'

				document.getElementById('chargesoptionspanel').style.visibility = 'hidden'
				document.getElementById('chargesoptionspanel').style.pointerEvents = 'none'
				document.getElementById('settingsoptionspanel').style.visibility = 'hidden'
				document.getElementById('settingsoptionspanel').style.pointerEvents = 'none'

				hideBoundaryKnobs()
				hideChargeKnobs()

				currentpanel = 'algorithm'

			}
			else if (event.target.id == 'settingsoption') {
				event.target.setAttribute('onclick', '')
				event.target.style.cursor = 'auto'
				event.target.style.background = 'hsla(0,0%,60%,1)';
				event.target.style.color = 'hsla(0,0%,0%,1)';
				document.getElementById('algorithmoption').style.cursor = 'pointer';
				document.getElementById('boundaryoption').style.cursor = 'pointer';
				document.getElementById('chargesoption').style.cursor = 'pointer';
				document.getElementById('algorithmoption').style.background = 'none';
				document.getElementById('boundaryoption').style.background = 'none';
				document.getElementById('chargesoption').style.background = 'none';
				document.getElementById('algorithmoption').style.color = 'grey';
				document.getElementById('boundaryoption').style.color = 'grey';
				document.getElementById('chargesoption').style.color = 'grey';
				document.getElementById('algorithmoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('boundaryoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('chargesoption').setAttribute('onclick', 'handlePanel(event)')

				document.getElementById('algooptionspanel').style.visibility = 'hidden'
				document.getElementById('algooptionspanel').style.pointerEvents = 'none'
				document.getElementById('boundaryoptionspanel').style.visibility = 'hidden'
				document.getElementById('boundaryoptionspanel').style.pointerEvents = 'none'

				document.getElementById('ellipsePanel').style.visibility = 'hidden'
				document.getElementById('polyPanel').style.visibility = 'hidden'
				document.getElementById('ellipsePanel').style.pointerEvents = 'none'
				document.getElementById('polyPanel').style.pointerEvents = 'none'

				document.getElementById('chargesoptionspanel').style.visibility = 'hidden'
				document.getElementById('chargesoptionspanel').style.pointerEvents = 'none'
				document.getElementById('settingsoptionspanel').style.visibility = 'visible'
				document.getElementById('settingsoptionspanel').style.pointerEvents = 'auto'

				hideBoundaryKnobs()
				hideChargeKnobs()

				currentpanel = 'settings'
			}
			else if (event.target.id == 'chargesoption') {
				event.target.setAttribute('onclick', '')
				event.target.style.cursor = 'auto'
				event.target.style.background = 'var(--themeblue)';
				event.target.style.color = 'hsla(0,0%,0%,1)';
				document.getElementById('algorithmoption').style.background = 'none';
				document.getElementById('boundaryoption').style.background = 'none';
				document.getElementById('settingsoption').style.background = 'none';
				document.getElementById('algorithmoption').style.cursor = 'pointer';
				document.getElementById('boundaryoption').style.cursor = 'pointer';
				document.getElementById('settingsoption').style.cursor = 'pointer';
				document.getElementById('algorithmoption').style.color = 'grey';
				document.getElementById('boundaryoption').style.color = 'grey';
				document.getElementById('settingsoption').style.color = 'grey';
				document.getElementById('algorithmoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('boundaryoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('settingsoption').setAttribute('onclick', 'handlePanel(event)')

				document.getElementById('algooptionspanel').style.visibility = 'hidden'
				document.getElementById('algooptionspanel').style.pointerEvents = 'none'
				document.getElementById('boundaryoptionspanel').style.visibility = 'hidden'
				document.getElementById('boundaryoptionspanel').style.pointerEvents = 'none'

				document.getElementById('ellipsePanel').style.visibility = 'hidden'
				document.getElementById('polyPanel').style.visibility = 'hidden'
				document.getElementById('ellipsePanel').style.pointerEvents = 'none'
				document.getElementById('polyPanel').style.pointerEvents = 'none'

				document.getElementById('chargesoptionspanel').style.visibility = 'visible'
				document.getElementById('chargesoptionspanel').style.pointerEvents = 'auto'
				document.getElementById('settingsoptionspanel').style.visibility = 'hidden'
				document.getElementById('settingsoptionspanel').style.pointerEvents = 'none'

				hideBoundaryKnobs()
				showChargeKnobs()
				$("#chargePropsBlocksH").scrollTop(0);
				currentpanel = 'charges'
			}
			else if (event.target.id == 'boundaryoption') {
				event.target.setAttribute('onclick', '')
				event.target.style.cursor = 'auto'
				event.target.style.background = 'hsla(32,100%,50%,1)';
				event.target.style.color = 'hsla(0,0%,0%,1)';
				document.getElementById('algorithmoption').style.background = 'none';
				document.getElementById('chargesoption').style.background = 'none';
				document.getElementById('settingsoption').style.background = 'none';
				document.getElementById('algorithmoption').style.cursor = 'pointer';
				document.getElementById('chargesoption').style.cursor = 'pointer';
				document.getElementById('settingsoption').style.cursor = 'pointer';
				document.getElementById('algorithmoption').style.color = 'grey';
				document.getElementById('chargesoption').style.color = 'grey';
				document.getElementById('settingsoption').style.color = 'grey';
				document.getElementById('algorithmoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('chargesoption').setAttribute('onclick', 'handlePanel(event)')
				document.getElementById('settingsoption').setAttribute('onclick', 'handlePanel(event)')

				document.getElementById('algooptionspanel').style.visibility = 'hidden'
				document.getElementById('algooptionspanel').style.pointerEvents = 'none'
				document.getElementById('boundaryoptionspanel').style.visibility = 'visible'
				document.getElementById('boundaryoptionspanel').style.pointerEvents = 'auto'

				if (boundaryType == 'polygon') {
					document.getElementById('polyPanel').style.visibility = 'visible'
					document.getElementById('polyPanel').style.pointerEvents = 'auto'
				}
				else {
					document.getElementById('ellipsePanel').style.visibility = 'visible'
					document.getElementById('ellipsePanel').style.pointerEvents = 'auto'
				}

				document.getElementById('chargesoptionspanel').style.visibility = 'hidden'
				document.getElementById('chargesoptionspanel').style.pointerEvents = 'none'
				document.getElementById('settingsoptionspanel').style.visibility = 'hidden'
				document.getElementById('settingsoptionspanel').style.pointerEvents = 'none'

				showBoundaryKnobs()
				hideChargeKnobs()

				currentpanel = 'boundary'

			}
		}

		function toggleBoundaryType(event) {
			ellipseTile = document.getElementById('ellipseoptiontilebutton')
			polyTile = document.getElementById('polyoptiontilebutton')
			if (boundaryType == 'circle' || boundaryType == 'ellipse') {
				ellipseTile.style.cursor = 'pointer'
				polyTile.style.cursor = 'auto'
				ellipseTile.style.pointerEvents = 'auto'
				polyTile.style.pointerEvents = 'none'
				ellipseTile.style.background = 'none'
				polyTile.style.background = 'var(--themeorange)'
				ellipseTile.style.color = 'hsla(0, 0%, 70%, 1)'
				polyTile.style.color = 'hsla(0, 100%, 100%, 1)'
				ellipseTile.style.borderWidth = '1px'
				polyTile.style.borderWidth = '0px'

				if (dmode == 'portrait') {
					document.getElementById('spacerBD1').style.height = '3%'
				}
				else {
					document.getElementById('spacerBD1').style.height = '10%'
				}

				document.getElementById('polyPanel').style.visibility = 'visible'
				document.getElementById('ellipsePanel').style.visibility = 'hidden'
				document.getElementById('polyPanel').style.pointerEvents = 'auto'
				document.getElementById('ellipsePanel').style.pointerEvents = 'none'

				document.getElementById('boundaryadditionalinfo').innerHTML = 'Polygonal boundaries are possible with certain limitations. Not all polygons are possible yet.'

				boundaryType = 'polygon'

			}
			else if (boundaryType == 'polygon') {
				polyTile.style.cursor = 'pointer'
				ellipseTile.style.cursor = 'auto'
				polyTile.style.pointerEvents = 'auto'
				ellipseTile.style.pointerEvents = 'none'
				polyTile.style.background = 'none'
				ellipseTile.style.background = 'var(--themeorange)'
				polyTile.style.color = 'hsla(0, 0%, 70%, 1)'
				ellipseTile.style.color = 'hsla(0, 100%, 100%, 1)'
				polyTile.style.borderWidth = '1px'
				ellipseTile.style.borderWidth = '0px'

				if (dmode == 'portrait') {
					document.getElementById('spacerBD1').style.height = '3%'
				}
				else {
					document.getElementById('spacerBD1').style.height = '30%'
				}

				document.getElementById('ellipsePanel').style.visibility = 'visible'
				document.getElementById('polyPanel').style.visibility = 'hidden'
				document.getElementById('ellipsePanel').style.pointerEvents = 'auto'
				document.getElementById('polyPanel').style.pointerEvents = 'none'

				document.getElementById('boundaryadditionalinfo').innerHTML = 'For a circular boundary, set both the axis lengths to same value which is the radius.'

				boundaryType = 'ellipse'
			}

			// boundaryTypeCheck()
			showBoundaryKnobs()
			randomizeChargePositions()
			lowestEnergy = Infinity

			checkEnergy()

		}

		// polypointuid = 1
		polyPoints = []

		function addNewPolyPoint(newpolypoint) {
			ref = document.getElementById('pbVfinalspacer')
			// polypointuid = polypointuid + 1
			cindex = (polyPoints.length + 1)
			newdiv = document.createElement("div");
			newdiv.id = 'polypointB' + cindex
			newdiv.setAttribute('class','polypointB')
			newdiv.style = 'margin:0px;width:100%; height:20%; display: inline-block;'
			portraitfont = '0.9vmax'
			if (dmode == 'portrait') {
				portraitfont = '1.2vmax'
			}
			newdiv.innerHTML = '<input value="Point ' + (polyPoints.length + 1) + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 22%; height: 100%; text-align: center;font-size: ' + portraitfont + '; font-family: Source Sans Pro; letter-spacing: 1px; overflow: hidden;background: hsla(32,100%,50%,0); color: var(--themeorange); cursor: auto; pointer-events: none; user-select: none;" readonly=""><div id="pbspacer" style="margin:0px;width:5%; height:100%; display: inline-block;"></div><input type="number" step="0.01" id="polypointBXv@' + (polyPoints.length + 1) + '" oninput="polypointInput(event)" value="' + newpolypoint[0] + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 30%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: ' + portraitfont + '; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none; border-radius: 6px;"><div id="pbspacer" style="margin:0px;width:5%; height:100%; display: inline-block;"></div><input type="number" step="0.01" id="polypointBYv@' + (polyPoints.length + 1) + '" oninput="polypointInput(event)" value="' + newpolypoint[1] + '" list="brow" style="border: 0px solid hsla(190, 0%, 50%,0.2); width: 30%; height: 100%; text-align: center; font-family: Nunito; font-weight: bold; font-size: ' + portraitfont + '; background: hsla(0,0%,78%,1); color: hsla(0, 100%, 100%, 1); cursor: auto; user-select: none; border-radius: 6px;">'
			ref.parentNode.insertBefore(newdiv, ref);

			newdiv = document.createElement("div");
			newdiv.id = 'pbVspacerOf' + (polyPoints.length + 1)
			newdiv.setAttribute('class', 'pbVspacer')
			newdiv.style = 'margin:0px;width:100%; height:5%; display: inline-block;'
			ref.parentNode.insertBefore(newdiv, ref);

			options = {}
			options.x = newpolypoint[0]
			options.y = newpolypoint[1]
			options.pointsize = 1
			options.pointcolor = 'var(--themeorange)'
			ptknob = addPoint('labG', 'polypointknob@' + (polyPoints.length + 1), options)[0]
			ptknob.style.visibility = 'hidden'
			ptknob.style.pointerEvents = 'none'

			options = {}
			options.x = newpolypoint[0]
			options.y = newpolypoint[1]
			options.pointsize = 2
			options.pointcolor = 'hsla(32, 100%, 50%, 0.3)'
			options.draggability = 'yes'
			options.dragDirection = 'bothXY'
			options.dragIfCondition = 'checkNewPointIntersectionChange([moveX, moveY])'
			options.runFunctionDuringDrag = 'adjustPolyBoundary([moveX, moveY])'
			options.runFunctionOnDragEnd = 'randomizeChargePositions()'
			pptknob = addPoint('labG', 'polypointknobBack@' + (polyPoints.length + 1), options)[0]
			pptknob.style.visibility = 'hidden'
			pptknob.style.pointerEvents = 'none'
			pptknob.style.cursor = 'move'

			polyPoints.push(newpolypoint)
		}

		function addPolygonPoints(sides) {
			for (ppIndex = 0; ppIndex < sides; ppIndex++) {
				ang = (2*Math.PI/sides)*ppIndex
				ppPointToAdd = [Math.cos(ang), Math.sin(ang)]
				addNewPolyPoint(ppPointToAdd)
			}
		}

		addPolygonPoints(6)

		function updatePolyPath() {
			polyPathPoints = polyPoints.slice()
			polyPathPoints.push(polyPoints[0])
			updatePathPoints('labG', 'simplePolygonBoundary', polyPathPoints)
		}

		updatePolyPath()

		function removePolyPoints() {
			for (pptIndex = 1; pptIndex <= polyPoints.length; pptIndex++) {
				removePoint('labG', 'polypointknob@' + pptIndex)
				removePoint('labG', 'polypointknobBack@' + pptIndex)
			}
		}

		function polysidesChange() {
			removePolyPoints()
			polyPoints = []
			toDeleteBoxes = document.getElementsByClassName('polypointB')
			toDeleteBoxesC = {...toDeleteBoxes}
			for (var blk in toDeleteBoxesC) {
				toDeleteBoxesC[blk].outerHTML = ''
			}
			toDeleteBoxes = document.getElementsByClassName('pbVspacer')
			toDeleteBoxesC = {...toDeleteBoxes}
			for (var blk in toDeleteBoxesC) {
				toDeleteBoxesC[blk].outerHTML = ''
			}
			
			addPolygonPoints(document.getElementById('sidesTileInput').value)
			updatePolyPath()
			showBoundaryKnobs()
			randomizeChargePositions()

			lowestEnergy = Infinity
			checkEnergy()
		}

		function checkIfSegmentsMeet(segment1, segment2) {
			// This fails when segments meet at their endpoints or when the intersection is another line segment

			saX = segment1[0][0]
			saY = segment1[0][1]
			sbX = segment1[1][0]
			sbY = segment1[1][1]
			scX = segment2[0][0]
			scY = segment2[0][1]
			sdX = segment2[1][0]
			sdY = segment2[1][1]

			aM = saX - sbX
			bM = (-1)*(scX - sdX)
			cM = saY - sbY
			dM = (-1)*(scY - sdY)
			eM = sdX - sbX
			fM = sdY - sbY

			determinant = aM*dM - bM*cM

			if (determinant != 0) {
				usolved = [(eM*dM - bM*fM)/determinant, (aM*fM - cM*eM)/determinant]
				if ((usolved[0] <= 0 || usolved[0] >= 1) || (usolved[1] <= 0 || usolved[1] >= 1)) {
					return false
				}
				else {
					return true
				}
			}
			else {
				return false
			}				
		}

		function findallEdges() {
			edgesToReturn = {}
			for (ptindex = 0; ptindex < polyPoints.length; ptindex++) {
				edgesToReturn[ptindex] = [polyPoints[ptindex], polyPoints[(ptindex + 1) % polyPoints.length]]
			}
			return edgesToReturn
		}

		function allEdgesCombinations() {
			edgesOfBoundary = findallEdges()
			edgeCombo = []
			for (bdedgeindex1 = 0; bdedgeindex1 < polyPoints.length; bdedgeindex1++) {
				for (bdedgeindex2 = bdedgeindex1 + 1; bdedgeindex2 < polyPoints.length; bdedgeindex2++) {
					if (bdedgeindex1 != bdedgeindex2) {
						edgeCombo.push([edgesOfBoundary[bdedgeindex1], edgesOfBoundary[bdedgeindex2]])
					}
				}
			}
			return edgeCombo
		}

		function checkIntersections() {
			edgeCombinations = allEdgesCombinations()
			foundInteresection = false
			for (edgeComboIndex = 0; edgeComboIndex < edgeCombinations.length; edgeComboIndex++) {
				edgeSeg1 = edgeCombinations[edgeComboIndex][0]
				edgeSeg2 = edgeCombinations[edgeComboIndex][1]
				if (checkIfSegmentsMeet(edgeSeg1, edgeSeg2)) {
					foundInteresection = true
					break
				}
			}
			return foundInteresection
		}

		function checkNewPointIntersectionChange(newlocationV) {
			newptnumber = currentMovingPoint.id.split('@')[1]
			temppolyPoints = polyPoints.slice()
			polyPoints.splice(newptnumber - 1, 1, newlocationV);
			possibleMove = checkIntersections()
			if (possibleMove) {
				possibleMove = false
			}
			else {
				possibleMove = true
			}
			polyPoints = temppolyPoints.slice()
			return possibleMove
		}

		function adjustPolyBoundary(newlocationV) {
			newptnumber = currentMovingPoint.id.split('@')[1]
			polyPoints.splice(newptnumber - 1, 1, newlocationV);
			updatePolyPath()
			updatePointXY('labG', 'polypointknob@' + newptnumber, newlocationV[0],newlocationV[1])
			document.getElementById('polypointBXv@' + newptnumber).value = newlocationV[0]
			document.getElementById('polypointBYv@' + newptnumber).value = newlocationV[1]
		}

		function polypointInput(event) {
			newptnumber = event.target.id.split('@')[1]
			coordinateType = event.target.id.split('@')[0][10]
			currentMovingPoint = graphData['labG'].pointData['polypointknobBack@' + newptnumber][0]
			if (coordinateType == 'X') {
				newptLocation = [event.target.value, polyPoints[newptnumber - 1][1]]
				if (checkNewPointIntersectionChange(newptLocation)) {
					polyPoints.splice(newptnumber - 1, 1, newptLocation)
					updatePolyPath()
					updatePointXY('labG', 'polypointknob@' + newptnumber, newptLocation[0],newptLocation[1])
					updatePointXY('labG', 'polypointknobBack@' + newptnumber, newptLocation[0],newptLocation[1])
				}
				else {
					event.target.value = polyPoints[newptnumber - 1][0]
				}
			}
			if (coordinateType == 'Y') {
				newptLocation = [polyPoints[newptnumber - 1][0], event.target.value]
				if (checkNewPointIntersectionChange(newptLocation)) {
					polyPoints.splice(newptnumber - 1, 1, newptLocation)
					updatePolyPath()
					updatePointXY('labG', 'polypointknob@' + newptnumber, newptLocation[0],newptLocation[1])
					updatePointXY('labG', 'polypointknobBack@' + newptnumber, newptLocation[0],newptLocation[1])
				}
				else {
					event.target.value = polyPoints[newptnumber - 1][1]
				}
			}
		}

		addCharges(12)

		$("#chargePropsBlocksH").scrollTop(0);

		hideChargeKnobs()

		// randompsn = randomPositionInsideBoundary()
		// addNewChargePoint([randompsn[0],randompsn[1], -1])

		function startConfig(configdata) {
			if (configdata == undefined || configdata == 'default') {
				uid = 0
				graphData = {}

				reverseGraphElementMap = {}
				setUpGraph()

				boundaryoptions = {}
				boundaryoptions.color = 'var(--boundaryorange)'

				options = {}
				options.stroke = 'var(--boundaryorange)'
				updateEllipse('labG', 'simpleEllipticBoundary', options)
				addEllipseKnobs()
				boundaryoptions.semiMajorAxis = 1
				boundaryoptions.semiMinorAxis = 1
				boundaryoptions.radius = 1

				boundaryType = 'circle'
				boundaryTypeCheck()

				chargeDetails = {}
				chargeId = 0
				chargeuidMap = {}
				energyFunc = 'p*q/d'
				lowestEnergy = Infinity
				lowestEnergyPositions = {}
				currentEnergy = Infinity

				handleTangentialForce = true
				useCustomCode = true
				customcodes = ['charge = pickCharge()', 'electrostaticWalk(charge, 0.008)']
				customcodePointer = 0

				errordisplayflag = false

				loopcount = 0
				algorithm = 'Electrostatic'
				runAlgorithm()
				codeblockuid = 2

				usingStepAlgo = false
				currentpanel = 'algorithm'

				polyPoints = []
				addPolygonPoints(6)
				updatePolyPath()

				addCharges(3)
				$("#chargePropsBlocksH").scrollTop(0);

				hideChargeKnobs()
			}
		}


		function handleOpen(event) {
			stopAlgorithm()
			var reader = new FileReader()
			reader.onload = function(){
				// stopAlgorithm()
				configInfo = reader.result
				configblocks = configInfo.split('\n')
				

				removeAllCharges()
				configChnum = parseInt(configblocks[5].split('There were ')[1].split(' charges in the simulation.')[0])
				

				bdconfigStart = 7 + configChnum
				algoconfigStart = bdconfigStart
				if (configblocks[bdconfigStart][21] == 'e') {
					boundaryType = 'polygon'
					toggleBoundaryType(event)
					document.getElementById('semiMajorTileInput').value = parseFloat(configblocks[bdconfigStart + 1].split('with semi major axis length of ')[1])
					document.getElementById('semiMinorTileInput').value = parseFloat(configblocks[bdconfigStart + 2].split('with semi minor axis length of ')[1])

					updateMajorAxis()
					updateMinorAxis()

					boundaryoptions.semiMajorAxis = parseFloat(configblocks[bdconfigStart + 1].split('with semi major axis length of ')[1])
					boundaryoptions.semiMinorAxis = parseFloat(configblocks[bdconfigStart + 2].split('with semi minor axis length of ')[1])

					hideBoundaryKnobs()
					algoconfigStart = bdconfigStart + 5
				}
				else if (configblocks[bdconfigStart][21] == 'o') {
					boundaryType = 'ellipse'
					toggleBoundaryType(event)
					polysidesconfig = parseInt(configblocks[bdconfigStart].split('with ')[1].split(' sides.')[0])
					
					removePolyPoints()
					polyPoints = []

					toDeleteBoxes = document.getElementsByClassName('polypointB')
					toDeleteBoxesC = {...toDeleteBoxes}
					for (var blk in toDeleteBoxesC) {
						toDeleteBoxesC[blk].outerHTML = ''
					}
					toDeleteBoxes = document.getElementsByClassName('pbVspacer')
					toDeleteBoxesC = {...toDeleteBoxes}
					for (var blk in toDeleteBoxesC) {
						toDeleteBoxesC[blk].outerHTML = ''
					}
					bdconfigStart = bdconfigStart + 2
					for (configIndex = 0; configIndex < polysidesconfig; configIndex++) {
						ptconfig = configblocks[bdconfigStart + configIndex].split('[')[1].split(']')[0]
						addNewPolyPoint([parseFloat(ptconfig.split(',')[0]), parseFloat(ptconfig.split(',')[1])])
					}
					updatePolyPath()
					hideBoundaryKnobs()

					document.getElementById('sidesTileInput').value = polysidesconfig

					bdconfigStart = bdconfigStart - 2
					algoconfigStart = bdconfigStart + polysidesconfig + 4
				}


				codeblocksNumConfig = parseInt(configblocks[algoconfigStart - 1].split('the following ')[1].split(' code block')[0])

				removeAllCodeBlocks()
				for (configIndex = 0; configIndex < codeblocksNumConfig; configIndex++) {
					codeconfigStr = configblocks[algoconfigStart + configIndex]
					addNewCodeBlock(codeconfigStr)
				}

				if (configblocks[algoconfigStart + codeblocksNumConfig + 2] == undefined) {

				}
				else {
					energyFunc = configblocks[algoconfigStart + codeblocksNumConfig + 2]
					document.getElementById('energyFInput').value = energyFunc
				}
					

				document.getElementById('fileinputBack').value = ''

				event = {}
				event.target = document.getElementById('algorithmoption')
				handlePanel(event)

				doEnergyComputation = false

				for (configIndex = 0; configIndex < configChnum; configIndex++) {
					ptconfig = configblocks[6 + configIndex].split('located at [')[1].split(']')[0]
					configWt = parseFloat(configblocks[6 + configIndex].split('located at [')[1].split(']')[1].split('charge of ')[1])
					toaddCh = [parseFloat(ptconfig.split(',')[0]), parseFloat(ptconfig.split(',')[1]), configWt]
					addNewChargePoint(toaddCh)
				}

				doEnergyComputation = true

				lowestEnergy = Infinity
				checkEnergy()

				hideChargeKnobs()

			};
			reader.readAsText(event.target.files[0]);
		};

		function handleSave(event) {
			stopAlgorithm()

			var d = new Date();
			dateStr = d.toLocaleString()
			dateStr = dateStr.replace(' ','-').replace(' ','-').replace('/','-').replace('/','-').replace(',','-').replace(':','-').replace(':','-')

			chargeDetailsString = 'There were ' + Object.keys(chargeDetails).length + ' charges in the simulation. \n'
			for (var chargedet in chargeDetails) {
				chargeDetailsString = chargeDetailsString + 'Particle ' + chargedet + ' located at [' + chargeDetails[chargedet].loc[0] + ',' + chargeDetails[chargedet].loc[1] + '] with charge of ' + chargeDetails[chargedet].weight + '\n'
			}

			boundaryDetailsString = ''
			if (boundaryType == 'ellipse' || boundaryType == 'circle') {
				boundaryDetailsString = boundaryDetailsString + 'Boundary Type was an ellipse\n'
				boundaryDetailsString = boundaryDetailsString + 'with semi major axis length of ' + boundaryoptions.semiMajorAxis + '\n'
				boundaryDetailsString = boundaryDetailsString + 'with semi minor axis length of ' + boundaryoptions.semiMinorAxis + '\n'
			}
			else {
				boundaryDetailsString = boundaryDetailsString + 'Boundary Type was a polygon '
				boundaryDetailsString = boundaryDetailsString + 'with ' + document.getElementById('sidesTileInput').value + ' sides.\n'
				boundaryDetailsString = boundaryDetailsString + 'The polygon boundary is formed by the following points. \n'
				for (polypointind = 0; polypointind < polyPoints.length; polypointind++) {
					boundaryDetailsString = boundaryDetailsString + '[' + polyPoints[polypointind][0] + ',' + polyPoints[polypointind][1] + ']\n'
				}
			}

			algoDetailsString = 'The algorithm loaded then had the following ' + customcodes.length + ' code blocks. \n'
			for (codeblockids = 0; codeblockids < customcodes.length; codeblockids++) {
				algoDetailsString = algoDetailsString + customcodes[codeblockids] + '\n'
			}

			energyFDetailsString = 'Energy Function (energy between charges p and q separated by distance d) was \n' + energyFunc

			configdataToSave = 'N charges inside a boundary. \nThis is a configuration file for the simulation at https://prajwalsouza.github.io/Experiments/N-charges-inside-a-boundary.html\nIt was recorded on ' + d.toLocaleString() + '.\nYou can open this file as it is, in the simulator.\n\n' + chargeDetailsString + '\n' + boundaryDetailsString + '\n' + algoDetailsString + '\n' + energyFDetailsString + '\n\n' + 'The configuration had an energy of ' + currentEnergy + '.'

			fileName = Object.keys(chargeDetails).length + '-charges-configuration-' + dateStr +'.txt'

			downloadConfig(fileName, configdataToSave);

		}

		function handleHome() {
			minMaxXYs = getXYMinMaxOfElements()
			// console.log(minMaxXYs)
			xMinMax = minMaxXYs[0][0] - minMaxXYs[1][0]
			yMinMax = minMaxXYs[0][1] - minMaxXYs[1][1]
			if (xMinMax < yMinMax) {
				options = {}
				options.xmin = minMaxXYs[1][0] - (yMinMax - xMinMax)/2
				options.xmax = minMaxXYs[0][0] + (yMinMax - xMinMax)/2
				options.ymin = minMaxXYs[1][1]
				options.ymax = minMaxXYs[0][1]
				updateGraphZoom('labG', options)
			}
			else {
				options = {}
				options.xmin = minMaxXYs[1][0]
				options.xmax = minMaxXYs[0][0]
				options.ymin = minMaxXYs[1][1] - (xMinMax - yMinMax)/2
				options.ymax = minMaxXYs[0][1] + (xMinMax - yMinMax)/2
				updateGraphZoom('labG', options)
			}
			
		}

		function downloadConfig(filename, text) {
			var pom = document.createElement('a');
			pom.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
			pom.setAttribute('download', filename);
			if (document.createEvent) {
				var event = document.createEvent('MouseEvents');
				event.initEvent('click', true, true);
				pom.dispatchEvent(event);
			}
			else {
				pom.click();
			}
		}

		// downloadConfig('test.txt', 'Hello world!');

		function getXYMinMaxOfElements() {
			returnXmax = -Infinity
			returnYmax = -Infinity
			returnXmin = Infinity
			returnYmin = Infinity
			if (boundaryType == 'ellipse' || boundaryType == 'circle') {
				elppoints = [[boundaryoptions.semiMajorAxis, 0], [0, boundaryoptions.semiMinorAxis], [(-1)*boundaryoptions.semiMajorAxis, 0], [0, (-1)*boundaryoptions.semiMinorAxis]]
				// console.log(elppoints)
				for (bindex = 0; bindex < elppoints.length;bindex++) {
					if (elppoints[bindex][0] > returnXmax) {
						returnXmax = elppoints[bindex][0]
					}
					if (elppoints[bindex][0] < returnXmin) {
						returnXmin = elppoints[bindex][0]
					}
					if (elppoints[bindex][1] > returnYmax) {
						returnYmax = elppoints[bindex][1]
					}
					if (elppoints[bindex][1] < returnYmin) {
						returnYmin = elppoints[bindex][1]
					}
				}
					
			}
			else if (boundaryType == 'polygon'){
				for (bindex = 0; bindex < polyPoints.length;bindex++) {
					if (polyPoints[bindex][0] > returnXmax) {
						returnXmax = polyPoints[bindex][0]
					}
					if (polyPoints[bindex][0] < returnXmin) {
						returnXmin = polyPoints[bindex][0]
					}
					if (polyPoints[bindex][1] > returnYmax) {
						returnYmax = polyPoints[bindex][1]
					}
					if (polyPoints[bindex][1] < returnYmin) {
						returnYmin = polyPoints[bindex][1]
					}
				}
			}

			for (var chargep in chargeDetails) {
				if (chargeDetails[chargep].loc[0] > returnXmax) {
					returnXmax = chargeDetails[chargep].loc[0]
				}
				if (chargeDetails[chargep].loc[0] < returnXmin) {
					returnXmin = chargeDetails[chargep].loc[0]
				}
				if (chargeDetails[chargep].loc[1] > returnYmax) {
					returnYmax = chargeDetails[chargep].loc[1]
				}
				if (chargeDetails[chargep].loc[1] < returnYmin) {
					returnYmin = chargeDetails[chargep].loc[1]
				}
			}

			return [[returnXmax, returnYmax], [returnXmin, returnYmin]]
		}

		// handleLayout()

		function spacebarPlayPause(event) {
			if (currentpanel == 'algorithm' && event.keyCode == 32 && $('input:focus')[0] == undefined) {
				event.preventDefault()
				dummyE = {}
				playpauseAlgo(dummyE)
			}
		}

		window.addEventListener("keypress", spacebarPlayPause);

// 		stopAlgorithm()



		function testfunc(testPoints) {
			edgesToReturn = {}
			for (ptindex = 0; ptindex < testPoints.length; ptindex++) {
				edgesToReturn[ptindex] = [testPoints[ptindex], testPoints[(ptindex + 1) % testPoints.length]]
			}
			edgesOfBoundary = edgesToReturn
			edgeCombo = []
			for (bdedgeindex1 = 0; bdedgeindex1 < testPoints.length; bdedgeindex1++) {
				for (bdedgeindex2 = bdedgeindex1 + 1; bdedgeindex2 < testPoints.length; bdedgeindex2++) {
					if (bdedgeindex1 != bdedgeindex2) {
						edgeCombo.push([edgesOfBoundary[bdedgeindex1], edgesOfBoundary[bdedgeindex2]])
					}
				}
			}

			
			edgeCombinations = edgeCombo
			foundInteresection = false
			for (edgeComboIndex = 0; edgeComboIndex < edgeCombinations.length; edgeComboIndex++) {
				edgeSeg1 = edgeCombinations[edgeComboIndex][0]
				edgeSeg2 = edgeCombinations[edgeComboIndex][1]
				if (checkIfSegmentsMeet(edgeSeg1, edgeSeg2)) {
					console.log("conflictedge",edgeSeg1, edgeSeg2)
					foundInteresection = true
					break
				}
			}

			console.log(foundInteresection)
			return foundInteresection

			
			
		}

		</script>


	</body>
<html>

